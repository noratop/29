
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt,args){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve(args);},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){if(typeof callback==='function'){callback(event,args);}
Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{contextMenu:'EVENT.MENU.contextMenu',contextMenuOpen:'EVENT.MENU.contextMenuOpen',contextMenuClose:'EVENT.MENU.contextMenuClose',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted',closeAllPanels:'EVENT.MENU.closeAllPanels',openPanel:'EVENT.MENU.openPanel',togglePanel:'EVENT.MENU.togglePanel'},user:{initialized:'DEFERRED.USER.initialized',loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark',addPersonalSong:'EVENT.USER.addPersonalSong',updatePersonalSong:'EVENT.USER.updatePersonalSong',sendPersonalSong:'EVENT.USER.sendPersonalSong',progressPersonalSong:'EVENT.USER.progressPersonalSong'},genre:{loaded:'EVENT.GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',trackListUpdated:'EVENT.PLAYLIST.trackListUpdated',seen:'EVENT.PLAYLIST.seen',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',modal_close:'EVENT.NAVIGATION.modal_close',context_menu_close:'EVENT.NAVIGATION.context_menu_close',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',allTracksSelected:'EVENT.DATAGRID.allTracksSelected',removedTrack:'EVENT.DATAGRID.removedTrack',replacedTrack:'EVENT.DATAGRID.replacedTrack'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'},tooltip:{show:'EVENT.TOOLTIP.show',hide:'EVENT.TOOLTIP.hide'}};};
(function(){var _dzPlayer={trackList:[],trackListOriginal:[],trackListIndex:0,trackListDuration:0,lyrics:{}};var _dzPlayerEvents={queue:[],delayed:null,trigger:function(evt_name,arg){if(_dzPlayerEvents.delayed!==null){window.clearTimeout(_dzPlayerEvents.delayed);}
_dzPlayerEvents.queue.push({evt_name:evt_name,arg:arg});_dzPlayerEvents.delayed=window.setTimeout(_dzPlayerEvents.triggerAll,0);},triggerAll:function(){for(var i=0;i<_dzPlayerEvents.queue.length;i++){Events.trigger(_dzPlayerEvents.queue[i].evt_name,_dzPlayerEvents.queue[i].arg);}
_dzPlayerEvents.queue=[];window.clearTimeout(_dzPlayerEvents.delayed);_dzPlayerEvents.delayed=null;}};var _trackList={setIndex:function(index){if(index<0||index>_dzPlayer.trackList.length-1){index=0;}
_dzPlayer.trackListIndex=index;},calculeDuration:function(){try{_dzPlayer.trackListDuration=0;for(var t=0;t<_dzPlayer.trackList.length;t++){_dzPlayer.trackListDuration+=parseInt(_dzPlayer.trackList[t].data.DURATION,10);}
return _dzPlayer.trackListDuration;}catch(e){error.log(e);}},reIndexWithSngId:function(sng_id){var i;for(i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID===sng_id){_dzPlayer.trackListIndex=i;break;}}
return i<_dzPlayer.trackList.length;},getOriginalIndexWithSngId:function(sng_id){var index=0;for(var i=0;i<_dzPlayer.trackListOriginal.length;i++){if(_dzPlayer.trackListOriginal[i].data.SNG_ID===sng_id){index=i;break;}}
return index;},order:function(order){if(_dzPlayer.trackList.length!==order.length){return false;}
var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var newTrackList=[];for(var o=0;o<order.length;o++){var sng_id=order[o];for(var i=0;i<_dzPlayer.trackList.length;i++){if(_dzPlayer.trackList[i].data.SNG_ID==sng_id){newTrackList.push(_dzPlayer.trackList[i]);}}}
if(newTrackList.length!==_dzPlayer.trackList.length){return false;}
_dzPlayer.trackList=newTrackList.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'order'});return true;},remove:function(index){if(index<0||index>_dzPlayer.trackList.length-1){return false;}
if(index<_dzPlayer.trackListIndex){_dzPlayer.trackListIndex--;}
var removed_track=_dzPlayer.trackList.splice(index,1);if(removed_track.length!==0){var removed_track_id=removed_track[0].data.SNG_ID;var original_index=_trackList.getOriginalIndexWithSngId(removed_track_id);_dzPlayer.trackListOriginal.splice(original_index,1);}
_trackList.calculeDuration();_trackList.emitChange({type:'remove',song:removed_track});return true;},shuffle:function(index_first_track){index_first_track=typeof index_first_track==='number'?index_first_track:_dzPlayer.trackListIndex;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();var current_song_id=dzPlayer.getCurrentSong('SNG_ID');var first_track=null;if(index_first_track!==-1){first_track=_dzPlayer.trackList.splice(index_first_track,1);first_track=first_track.length===0?null:first_track[0];}
shuffle(_dzPlayer.trackList);if(first_track!==null){_dzPlayer.trackList.unshift(first_track);}
_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'shuffle'});return true;},unShuffle:function(){var current_song_id=dzPlayer.getCurrentSong('SNG_ID');_dzPlayer.trackList=_dzPlayer.trackListOriginal.slice();_trackList.reIndexWithSngId(current_song_id);_trackList.emitChange({type:'unShuffle'});return true;},addNext:function(new_tracklist){if(new_tracklist.length===0){return false;}
if(dzPlayer.isRadio()){return false;}
Array.prototype.splice.apply(_dzPlayer.trackList,[_dzPlayer.trackListIndex+1,0].concat(new_tracklist));var current_song_id=dzPlayer.getCurrentSong('SNG_ID');if(current_song_id===0){_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();}else{var tracklistoriginal_index=_trackList.getOriginalIndexWithSngId(current_song_id);Array.prototype.splice.apply(_dzPlayer.trackListOriginal,[tracklistoriginal_index+1,0].concat(new_tracklist));}
_trackList.calculeDuration();_trackList.emitChange({type:'addNext',song:new_tracklist});return true;},addToQueue:function(new_tracklist){if(new_tracklist.length===0){return false;}
_dzPlayer.trackList=_dzPlayer.trackList.concat(new_tracklist);_dzPlayer.trackListOriginal=_dzPlayer.trackListOriginal.concat(new_tracklist);_trackList.calculeDuration();var change_evt={type:'addToQueue',song:new_tracklist};if(dzPlayer.isRadio()){change_evt.type='lazyLoad';}
_trackList.emitChange(change_evt);return true;},set:function(new_tracklist,options){options=typeof options==='undefined'?{}:options;if(typeof options.addNext==='boolean'&&options.addNext){return _trackList.addNext(new_tracklist);}
if(typeof options.addQueue==='boolean'&&options.addQueue){return _trackList.addToQueue(new_tracklist);}
_dzPlayer.trackList=new_tracklist;_dzPlayer.trackListOriginal=_dzPlayer.trackList.slice();_trackList.calculeDuration();_trackList.emitChange({type:'set'});return true;},save:function(options){if(options.addQueue||options.addNext){return false;}
if(options.id==dzPlayer.getContext('ID')&&options.type===LOG_CONTEXT[dzPlayer.getContext('TYPE')]){return false;}
_trackList.backup={trackList:dzPlayer.getTrackList(false),trackListIndex:_dzPlayer.trackListIndex,trackOffset:dzPlayer.position,radio:dzPlayer.getPlayerType()==='radio',context:dzPlayer.getContext()};},restore:function(){if(countObject(_trackList.backup)===0){return false;}
if(dzPlayer.getPlayerType()==='ads'){Events.subscribeOnce(Events.player.finishAds,dzPlayer.restoreTrackList);return false;}
dzPlayer.play({data:_trackList.backup.trackList,index:_trackList.backup.trackListIndex,offset:_trackList.backup.trackOffset,context:_trackList.backup.context,autoplay:_trackList.backup.trackOffset>0,radio:_trackList.backup.radio,saveCurrentTrackList:false});_trackList.backup={};},first_list_already_set:false,emitChange:function(data){if(data.type==='set'&&!_trackList.first_list_already_set){_trackList.first_list_already_set=true;data.first=true;}
_dzPlayerEvents.trigger(Events.player.tracklist_changed,data);}};var dzPlayer={MEDIA_TYPE_TALK:'talk',MEDIA_TYPE_SONG:'song',MEDIA_TYPE_EXTERNAL:'external',MEDIA_TYPE_LIVE_STREAM:'live_stream',minimumFlashVersion:10.1,volume:0.5,cover:'',songId:0,muted:false,paused:false,playing:false,loading:false,lastPosition:0,position:0,duration:0,fade:0,repeat:0,shuffle:false,pourcentLoaded:0,nextSongInfo:[],playerType:'mod',previousPlayerType:'mod',fadeOutProgress:false,fadeInProgress:false,hq:false,numSong:-1,nbSongs:-1,playerLoaded:false,audioAds:null,previousSkipAction:'',appId:0,appType:'',radioType:'',radioSkipInterval:3600000,radioSkipIntervalId:0,radioSkipCounter:0,cached:{},context:{},logTrackTemplate:{media:{id:0,type:0},type:0,stat:{seek:0,pause:0},lt:0,ctxt:{},dev:{v:STATIC_VERSION,t:0},ls:[]},logTrack:{},user_status:{},_play:function(autoPlay,naturalEnd){try{if(dzPlayer.getCurrentSong()===null){return false;}
if(dzPlayer.getAudioAds()!=null&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.isAdvertisingAllowed()&&USER.OPTIONS.ads_audio){_dzPlayer.trackListIndex--;dzPlayer._playAudioAds();return false;}
if(dzPlayer.getCurrentSong('TYPE')=='JINGLE'){dzPlayer._playAudioJingle();return false;}
if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){var mark=bookmark.getEpisodeBookmark(_dzPlayer.trackList[_dzPlayer.trackListIndex].data.EPISODE_ID);if(typeof naturalEnd!=='undefined'&&mark.IS_HEARD==='1'){if(dzPlayer.isLastSong()){dzPlayer.control.pause();}else{dzPlayer.control.nextSong();}}
_dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET=mark.OFFSET;}
if(dzPlayer.getNbSongs()===0){return false;}
if(typeof autoPlay!=='boolean'){autoPlay=true;}
if(typeof naturalEnd!=='boolean'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='ads'||dzPlayer.getPlayerType()==='jingle'||dzPlayer.getPlayerType()==='chromecast'){return false;}
if(autoPlay){dzPlayer.logManager();dzPlayer.trigger('audioPlayer_'+((naturalEnd&&dzPlayer.fade>0)?'appendTracks':'playTracks'),[[dzPlayer.getCurrentSong()],0,autoPlay]);Events.trigger(Events.player.notify,'start');Events.trigger(Events.player.play,{value:dzPlayer.getCurrentSong()});dzPlayer.duration=(dzPlayer.isLimited())?30:dzPlayer.getCurrentSong('DURATION');Events.trigger(Events.player.duration,dzPlayer.duration);}else{dzPlayer.trigger('audioPlayer_stop',[]);}
delete _dzPlayer.trackList[_dzPlayer.trackListIndex].data.OFFSET;_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());if(dzPlayer.isRadio()&&_dzPlayer.trackList.length-_dzPlayer.trackListIndex==4&&_dzPlayer.trackListIndex>0){dzPlayer.loadTracks({id:dzPlayer.getContext('ID'),type:dzPlayer.getRadioType(),radio:true,addQueue:true,context:dzPlayer.getContext()});}}catch(e){error.log(e);}},_playAudioJingle:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioJingle',[{audio:{url:SETTING_STATIC+'/'+dzPlayer.getCurrentSong('URL'),duration:dzPlayer.getCurrentSong('DURATION')},format:{formatType:'',formatType:''},content:{urlContent:''},tracking:{clickCommand:'',clickTagMethod:'',pixelAgence:''},textlink:{text:''}}]);_dzPlayerEvents.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong());dzPlayer.setPlayerType('jingle');}catch(e){error.log(e);}},_playAudioAds:function(){try{dzPlayer.previousPlayerType=dzPlayer.getPlayerType();dzPlayer.trigger('setAudioAds',[dzPlayer.getAudioAds()]);dzPlayer.setPlayerType('ads');}catch(e){error.log(e);}},initSoPlayer:function(div_id){try{var path='swf/coreplayer3-v'+STATIC_VERSION+'.swf';if(typeof RESSOURCES==='object'){path=RESSOURCES.coreplayer3;}
var so;so=new SWFObject(SETTING_STATIC+'/'+path,'audioPlayerSWF','1','1',dzPlayer.minimumFlashVersion.toString(),'#3a3a3a');so.addVariable('host_stream_cdn',HOST_STREAM_CDN);so.addVariable('host_stream',HOST_STREAM);so.addVariable('host_preview',HOST_PREVIEW);so.addVariable('cdn_ratio',CDN_RATIO);so.addVariable('range_qs','x-bits-range');so.addVariable('allow_range','true');so.addVariable('offline',OFFLINE);so.addVariable('token',PLAYER_TOKEN);so.addVariable('server_timestamp',SERVER_TIMESTAMP);so.addParam('wmode','transparent');so.addParam('allowScriptAccess','always');so.addParam('menu','false');so.addParam('hasPriority','true');so.write(div_id);return true;}catch(e){error.log(e);}},initRestriction:function(){try{dzPlayer.setOffline(OFFLINE);return true;}catch(e){error.log(e);}},setUserLogged:function(userId,md5,blogName,sid,gender,age,player_token){try{dzPlayer.trigger('audioPlayer_setToken',[player_token]);return true;}catch(e){error.log(e);}},setUserUnlogged:function(){try{dzPlayer.trigger('audioPlayer_setToken',['']);return true;}catch(e){error.log(e);}},setEmptyPlayer:function(){try{if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
_dzPlayer.trackList=[];_dzPlayer.trackListOriginal=[];_dzPlayer.trackListIndex=0;dzPlayer.trigger('audioPlayer_playTracks',[[],0,false]);_dzPlayerEvents.trigger(Events.player.displayEmptyPlayer);return false;}catch(e){error.log(e);}},play:function(options){try{if(dzPlayer.getPlayerType()==='chromecast'){if(typeof options.data==='undefined'||options.data.length===0){return dzPlayer.loadTracks(options);}
if(options.context.TYPE==='suggest_track'||options.context.TYPE.length===0){options.context.TYPE='album_page';options.context.ID=parseInt(options.data[0].ALB_ID,10);}
return chromecast.doAction('playFromList',{track_id:parseInt(options.id||0,10),type:(options.type||'').toString(),data:(options.data||[]),context:options.context,index:options.index});}
options=$.extend(true,{},{type:'',id:0,radio:false,index:0,autoplay:true,context:{ID:'',TYPE:'',CONTEXT_ID:''},data:[],offset:0,addNext:false,addQueue:false,saveCurrentTrackList:true,callbackTrack:function(){}},options);if(dzPlayer.getPlayerType()=='ads'||dzPlayer.getPlayerType()=='jingle'){return false;}
if(options.data.length===0){dzPlayer.loadTracks(options);return false;}
if(Number(dzPlayer.appId)>0&&dzPlayer.appType==='inapp'){options.context.ID=dzPlayer.appId;options.context.TYPE=dzPlayer.appType;}
if(options.saveCurrentTrackList){_trackList.save(options);}
if(options.index>options.data.length){options.index=0;}
dzPlayer.setPlayerType(options.radio?'radio':'mod');if(options.radio===true&&options.addQueue===false){dzPlayer.radioStartListen(options.id,options.type);}
dzPlayer.radioSkipSetTimer();dzPlayer.setTrackList(options,options.addQueue,options.addNext);}catch(e){error.log(e);}},loadTracks:function(options){try{if(options.id===0){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without id (=== 0)'});}
if(options.type===''){throw new dzError({name:'DZPLAYER',message:'Player error - dzplayer.loadTracks: play without type (=== "")'});}
if(options.type==='track'&&!$.isArray(options.id)){options.id=[options.id];}
var loader={playlist:{api_method:'playlist.getSongs',api_param:{playlist_id:options.id,start:0,nb:1000}},album:{api_method:'song.getListByAlbum',api_param:{alb_id:options.id,start:0,nb:500}},track:{api_method:'song.getListData',api_param:{sng_ids:options.id}},radio:{api_method:'radio.getSongs',api_param:{radio_id:options.id}},artist:{api_method:options.radio===true?'smart.getSmartRadio':'song.getTopArtist',api_param:{art_id:options.id}},user:{api_method:'radio.getUserRadio',api_param:{user_id:options.id}},show:{api_method:'episode.getListByShow',api_param:{show_id:options.id}},episode:{api_method:'episode.getData',api_param:{episode_id:options.id}},loved:{api_method:'favorite_song.getList',api_param:{user_id:options.id,start:0,nb:1000}},history:{api_method:'user.getSongsHistory',api_param:{start:0,nb:1000}},personal_song:{api_method:'personal_song.getList',api_param:{start:0,nb:1000}},downloads:{api_method:'store.getList',api_param:{start:0,nb:1000,order:7}},search:{api_method:'search.music',api_param:{query:options.id,start:0,nb:1000,filter:/^\/tags\//.test(window.location.pathname)?'TAG':'ALL',output:'TRACK'}},artistTopTracks:{api_method:'artist.getTopTrack',api_param:{art_id:options.id,start:0,nb:100}}};loader.talkShow=loader.show;loader.personalPlaylist=loader.playlist;if(options.type==='talkEpisodes'){var latestEpisodes=userData.data.FAVORITES_SHOWS.data.map(function(show){return show.LATEST_EPISODE.data[0];});dzPlayer.onLoadedTracks({data:latestEpisodes},options);}else if(typeof loader[options.type]==='object'){api.call(loader[options.type].api_method,loader[options.type].api_param,dzPlayer.onLoadedTracks,options);}}catch(e){error.log(e);}},onLoadedTracks:function(result,options){try{options.data=result.data||[result];if(options.offset>0&&options.data.length>0){options.data[0].OFFSET=options.offset;}
dzPlayer.play(options);}catch(e){error.log(e);}},playTrackAtIndex:function(index){try{_trackList.setIndex(index);dzPlayer._play(true);}catch(e){error.log(e);}},setIndexSong:function(index){try{_trackList.setIndex(index);}catch(e){error.log(e);}},restoreTrackList:function(){_trackList.restore();},setTrackList:function(options,addQueue,addNext){try{addQueue=addQueue||false;addNext=addNext||false;var futur_index=(options.index===-1)?0:options.index;if(options.chromecast===true){_trackList.set(options.data);_trackList.setIndex(0);return true;}
var filteredTrack=[];for(var d=0;d<options.data.length;d++){if(typeof options.data[d]!=='object'){continue;}
if(dzPlayer.getMediaType(options.data[d])===dzPlayer.MEDIA_TYPE_TALK){options.data[d].OFFSET=parseInt(bookmark.getEpisodeBookmark(options.data[d].EPISODE_ID).OFFSET,10);filteredTrack.push({data:options.data[d],context:options.context});continue;}
var is_readable=false;var songAvailable=right.checkSongAvailable(options.data[d]);if(songAvailable==right.READABLE||(dzPlayer.isRadio()&&songAvailable!=right.EXPLICIT_LYRICS)){filteredTrack.push({data:options.data[d],context:options.context});is_readable=true;}else if(typeof options.data[d].FALLBACK==='object'&&right.checkSongAvailable(options.data[d].FALLBACK)==right.READABLE){options.data[d].SNG_ID_ORIGIN=options.data[d].SNG_ID;filteredTrack.push({data:$.extend({},options.data[d],options.data[d].FALLBACK),context:options.context});is_readable=true;}
if(d==futur_index){futur_index=is_readable?(filteredTrack.length-1):filteredTrack.length;}}
if(typeof options.callbackTrack==='function'){options.callbackTrack(filteredTrack);}
if(filteredTrack.length===0){return false;}
if(addQueue||addNext){_trackList.set(filteredTrack,{addQueue:addQueue,addNext:addNext});return true;}
_trackList.set(filteredTrack);_trackList.setIndex(futur_index);options.index=futur_index;if(options.offset>0){options.data[options.index].OFFSET=options.offset;}
if(dzPlayer.isShuffle()&&dzPlayer.getPlayerType()==='mod'){var index_first_track=options.index;if(index_first_track===-1){index_first_track=Math.round(Math.random()*(_dzPlayer.trackList.length-1));_trackList.setIndex(index_first_track);}
_trackList.shuffle(index_first_track);}
if(dzPlayer.isMuted()){dzPlayer.control.mute(false);}
dzPlayer._play(options.autoplay);return true;}catch(e){error.log(e);}},getTrackList:function(with_ctx){try{if(with_ctx===true){return _dzPlayer.trackList;}
var data=[];for(var t=0;t<_dzPlayer.trackList.length;t++){data.push(_dzPlayer.trackList[t].data);}
return data;}catch(e){error.log(e);}},getTrackListIndex:function(){return _dzPlayer.trackListIndex;},getTrackListDuration:function(){return _dzPlayer.trackListDuration;},enqueueTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},true,false);}catch(e){error.log(e);}},addNextTracks:function(songs,context){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.setTrackList({data:songs,context:context},false,true);}catch(e){error.log(e);}},setAudioAds:function(data){try{dzPlayer.audioAds=data;}catch(e){error.log(e);}},getAudioAds:function(){try{if(typeof ads!=='undefined'&&ads.allow_audio===false){return null;}
return dzPlayer.audioAds;}catch(e){error.log(e);}},isStoreTrack:function(isrc){try{if(typeof userData==='object'&&typeof userData.dataStore==='object'){return(typeof userData.dataStore[isrc]==='boolean'&&isrc!='');}
return false;}catch(e){error.log(e);}},isRadio:function(){return(dzPlayer.getPlayerType()==='radio');},getIndexSong:function(){return _dzPlayer.trackListIndex;},getNbSongs:function(){return _dzPlayer.trackList.length;},isLastSong:function(){if(dzPlayer.getRepeat()>0){return false;}
if(_dzPlayer.trackListIndex>=dzPlayer.getNbSongs()-1){return true;}
return false;},getTotalDuration:function(){var totalDuration=0;for(var j=0;j<_dzPlayer.trackList.length;j++){if(!isNaN(_dzPlayer.trackList[j].data.DURATION)){totalDuration+=parseInt(_dzPlayer.trackList[j].data.DURATION,10);}}
return totalDuration;},getNextSong:function(){if(dzPlayer.repeat==0||dzPlayer.isRadio()){return(_dzPlayer.trackListIndex+1<dzPlayer.getNbSongs())?_dzPlayer.trackList[_dzPlayer.trackListIndex+1].data:null;}else if(dzPlayer.repeat==1){var index=(_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1)?0:_dzPlayer.trackListIndex+1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.repeat==2){return dzPlayer.getCurrentSong();}},getPrevSong:function(){if(dzPlayer.getRepeat()==0||dzPlayer.isRadio()){return _dzPlayer.trackListIndex!=0?_dzPlayer.trackList[_dzPlayer.trackListIndex-1].data:null;}else if(dzPlayer.getRepeat()==1){var index=(_dzPlayer.trackListIndex==0)?_dzPlayer.trackList.length-1:_dzPlayer.trackListIndex-1;return _dzPlayer.trackList[index].data;}else if(dzPlayer.getRepeat()==2){return dzPlayer.getCurrentSong();}},getCurrentSong:function(prop){try{if(typeof prop==='string'&&prop==='MEDIA_ID'){if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){prop='EPISODE_ID';}else if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_EXTERNAL||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_LIVE_STREAM){return 0;}else{prop='SNG_ID';}}
var trackList=_dzPlayer.trackList[_dzPlayer.trackListIndex];var playerType=dzPlayer.getPlayerType();if(typeof trackList!=='undefined'&&typeof trackList.data!=='undefined'&&playerType!=='ads'&&playerType!=='jingle'){return(typeof prop!=='string')?new Track(trackList.data):trackList.data[prop];}
var defaut={SNG_ID:0,ART_ID:0,ALB_ID:0,ALB_PICTURE:'',URL:'',DURATION:0};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},isAdvertisingAllowed:function(){if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK&&!Number(dzPlayer.getCurrentSong('SHOW_IS_ADVERTISING_ALLOWED'))){return false;}
return true;},getMediaType:function(data){data=data||dzPlayer.getCurrentSong();if(data===null){return false;}
if(typeof data.EPISODE_ID!=='undefined'){return dzPlayer.MEDIA_TYPE_TALK;}
if(data.LIVE_STREAM){return dzPlayer.MEDIA_TYPE_LIVE_STREAM;}
if(data.EXTERNAL){return dzPlayer.MEDIA_TYPE_EXTERNAL;}
return dzPlayer.MEDIA_TYPE_SONG;},getContext:function(prop){try{if(typeof _dzPlayer.trackList[_dzPlayer.trackListIndex]!='undefined'&&typeof _dzPlayer.trackList[_dzPlayer.trackListIndex].context!='undefined'&&dzPlayer.getPlayerType()!=='ads'&&dzPlayer.getPlayerType()!=='jingle'){return(typeof prop!=='string')?_dzPlayer.trackList[_dzPlayer.trackListIndex].context:_dzPlayer.trackList[_dzPlayer.trackListIndex].context[prop];}
var defaut={ID:'',TYPE:'',CONTEXT_ID:''};return(typeof prop!=='string')?null:defaut[prop];}catch(e){error.log(e);}},getRepeat:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return 0;}
if(typeof dzPlayer.repeat==='string'&&dzPlayer.repeat.length>1){dzPlayer.repeat=0;}
return parseInt(dzPlayer.repeat,10);},getPosition:function(){return dzPlayer.position;},getExactPosition:function(){return dzPlayer.trigger('audioPlayer_getPosition',[]);},getDuration:function(){return dzPlayer.duration;},getVolume:function(){return dzPlayer.volume;},isShuffle:function(){if(dzPlayer.isRadio()||dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
return dzPlayer.shuffle;},removeTracks:function(index){if(dzPlayer.getIndexSong()==index){if(_dzPlayer.trackList.length===1){return false;}
dzPlayer.playTrackAtIndex(index+((_dzPlayer.trackList.length-1==index)?-1:1));}
return _trackList.remove(index);},orderTracks:function(order){return _trackList.order(order);},isMuted:function(){return dzPlayer.muted;},isPlaying:function(){return dzPlayer.playing;},isPaused:function(){return dzPlayer.paused;},getArtistName:function(){return dzPlayer.getCurrentSong('ART_NAME');},getAlbumTitle:function(){return dzPlayer.getCurrentSong('ALB_TITLE');},getSongTitle:function(){return dzPlayer.getCurrentSong('SNG_TITLE');},getPlayerType:function(){return dzPlayer.playerType;},getPlayerTypeId:function(){if(dzPlayer.playerType=='radio'){return 1;}
return 0;},setPlayerType:function(type){if(dzPlayer.getPlayerType()!=type){dzPlayer.playerType=type;dzPlayer.trigger('audioPlayer_setType',[type]);}
_dzPlayerEvents.trigger(Events.player.changePlayerType,dzPlayer.playerType);},getSongId:function(){return dzPlayer.getCurrentSong('MEDIA_ID');},isLoading:function(){return dzPlayer.loading;},getCover:function(){return dzPlayer.getCurrentSong('ALB_PICTURE');},isFadeInProgress:function(){return dzPlayer.fadeInProgress;},isFadeOutProgress:function(){return dzPlayer.fadeOutProgress;},isHq:function(){return dzPlayer.hq;},setOffline:function(status){dzPlayer.trigger('audioPlayer_setOffline',[status]);},sendFile:function(file){dzPlayer.trigger('audioPlayer_sendFile',[file]);},isLimited:function(){if(countObject(dzPlayer.user_status)>0){return dzPlayer.user_status.limited;}
return false;},getRadioType:function(){return dzPlayer.radioType;},skipRadioAllowed:function(){if(dzPlayer.user_status.radio_skips===0){return true;}
if(dzPlayer.helper.isPlayingFlow()&&USER.OPTIONS.web_hq){return true;}
return(dzPlayer.radioSkipCounter<dzPlayer.user_status.radio_skips);},radioStartListen:function(id,type){dzPlayer.radioType=type;_dzPlayerEvents.trigger(Events.radio.start,{type:type,id:id});},radioSkipSetTimer:function(){clearTimeout(dzPlayer.radioSkipIntervalId);dzPlayer.radioSkipIntervalId=0;dzPlayer.radioSkipCounter=0;if(dzPlayer.isRadio()){dzPlayer.radioSkipIntervalId=window.setTimeout(dzPlayer.radioSkipSetTimer,dzPlayer.radioSkipInterval);}},helper:{isPlayingFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&(context.TYPE==='home_user_radio'||context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio');},isPlayingUserFlow:function(){var context=dzPlayer.getContext();return(context!==null)&&(context.TYPE==='home_user_radio'||context.TYPE==='feed_user_radio'||context.TYPE==='profile_user_radio')&&(dzPlayer.getContext().ID==USER.USER_ID);}},control:{canSeek:function(){if(dzPlayer.isRadio()&&USER.OPTIONS.web_hq){return true;}
if(dzPlayer.getPlayerType()==='chromecast'&&!chromecast.isRadio()){return true;}
if(dzPlayer.getPlayerType()==='mod'){return true;}
return false;},play:function(){try{if(dzPlayer.isPlaying()===false&&dzPlayer.isPaused()===false){if(dzPlayer.getCurrentSong('SNG_ID')!==0){dzPlayer._play(true);}}else{_dzPlayerEvents.trigger(Events.player.resume,{value:dzPlayer.getCurrentSong()});dzPlayer.trigger('audioPlayer_play');}}catch(e){error.log(e);}},pause:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
dzPlayer.trigger('audioPlayer_pause');if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0&&dzPlayer.logTrack.stat){dzPlayer.logTrack.stat.pause++;}}catch(e){error.log(e);}},stop:function(){if(dzPlayer.getPlayerType()==='ads'){return false;}
if(dzPlayer.getMediaType()!==dzPlayer.MEDIA_TYPE_LIVE_STREAM){return false;}
dzPlayer.trigger('audioPlayer_stop');dzPlayer.logManager(false);},nextSong:function(naturalEnd){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(typeof naturalEnd==='undefined'){naturalEnd=false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('next');}
if(dzPlayer.isRadio()&&!dzPlayer.skipRadioAllowed()&&!naturalEnd){return false;}
if(!naturalEnd){if(countObject(dzPlayer.logTrack)===0){dzPlayer.logManager(false);}
dzPlayer.logTrack.stat.next=true;if(dzPlayer.isRadio()){dzPlayer.radioSkipCounter++;}}
dzPlayer.previousSkipAction='next';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex<_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex++;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==_dzPlayer.trackList.length-1){_dzPlayer.trackListIndex=0;}else if(dzPlayer.getRepeat()!=2){dzPlayer.playing=false;dzPlayer.logManager(false);_dzPlayer.trackListIndex=0;dzPlayer._play(false,true);_dzPlayerEvents.trigger(Events.player.finishTrackList);return false;}
var autoPlay=true;if(naturalEnd&&dzPlayer.playerType=='mod'){autoPlay=!dzPlayer.isLimited();}
dzPlayer._play(autoPlay,naturalEnd);}catch(e){error.log(e);}},prevSong:function(){try{if(dzPlayer.getPlayerType()==='ads'){return false;}
if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.isRadio()?false:chromecast.doAction('prev');}
if(dzPlayer.isRadio()){return false;}
if(typeof dzPlayer.logTrack.stat!=='undefined'){dzPlayer.logTrack.stat.prev=true;}
dzPlayer.previousSkipAction='prev';if(dzPlayer.getRepeat()==0&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex>0){_dzPlayer.trackListIndex--;}else if(dzPlayer.getRepeat()==1&&_dzPlayer.trackListIndex==0){_dzPlayer.trackListIndex=_dzPlayer.trackList.length-1;}else if(dzPlayer.getRepeat()==2){_dzPlayer.trackListIndex=_dzPlayer.trackListIndex;}else{return false;}
dzPlayer._play(true);}catch(e){error.log(e);}},togglePause:function(){try{if(dzPlayer.isPlaying()){dzPlayer.control.pause();}else{dzPlayer.control.play();}}catch(e){error.log(e);}},setRepeat:function(repeat){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
dzPlayer.repeat=repeat;Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction('setRepeat',{value:dzPlayer.repeat});}
userSetting.set({site:{player_repeat:dzPlayer.repeat}});}catch(e){error.log(e);}},setVolume:function(volume,save){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
if(dzPlayer.isMuted()&&volume>0){dzPlayer.control.mute(false);}
save=save||false;dzPlayer.volume=volume;dzPlayer.trigger('audioPlayer_setVolume',[volume]);Events.trigger(Events.player.volume_changed,Math.round(volume*100));if(dzPlayer.getPlayerType()==='chromecast'&&chromecast.isOwner()===false){save=false;}
if(save){storage.set('volume',dzPlayer.volume);}}catch(e){error.log(e);}},setShuffle:function(status){try{if(dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_TALK){return false;}
if(_dzPlayer.trackList.length===0){return false;}
dzPlayer.shuffle=status;var save=true;if(dzPlayer.getPlayerType()==='chromecast'){chromecast.doAction('setShuffle',{value:dzPlayer.isShuffle()});if(!chromecast.isOwner()){save=false;}}else{if(dzPlayer.shuffle){_trackList.shuffle();}else{_trackList.unShuffle();}}
if(save){userSetting.set({site:{player_shuffle:dzPlayer.shuffle}});}
_dzPlayerEvents.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);}catch(e){error.log(e);}},mute:function(bMute){try{if(dzPlayer.getPlayerType()=='ads'){return false;}
dzPlayer.muted=!dzPlayer.muted;dzPlayer.trigger('audioPlayer_mute',[bMute]);Events.trigger(Events.player.mute_changed,dzPlayer.muted);}catch(e){error.log(e);}},setSmartNotLike:function(){try{api.call('smart_notLikeSong',{sng_id:dzPlayer.getCurrentSong('SNG_ID')});dzPlayer.control.nextSong();}catch(e){error.log(e);}},seek:function(position){try{if(!dzPlayer.control.canSeek()){return false;}
dzPlayer.trigger('audioPlayer_seek',[position]);if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(countObject(dzPlayer.logTrack)>0){dzPlayer.logTrack.stat.seek++;}
Events.trigger(Events.player.seek,position);}catch(e){error.log(e);}},changeFadeValue:function(fade){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
dzPlayer.trigger('audioPlayer_changeFadeValue',[fade]);dzPlayer.fade=fade;userSetting.set({site:{player_fade:dzPlayer.fade}});Events.trigger(Events.player.fade,dzPlayer.fade);return true;}catch(e){error.log(e);}},setHq:function(status){try{dzPlayer.hq=status;dzPlayer.trigger('audioPlayer_setHq',[status]);userSetting.set({site:{player_hq:dzPlayer.hq}});Events.trigger(Events.player.hq,dzPlayer.hq);}catch(e){error.log(e);}},loadLyrics:function(){if(!dzPlayer.hasLyrics()){return;}
if(dzPlayer.hasLoadedLyrics()){Events.trigger(Events.lyrics.load);}else{var sngID=dzPlayer.getCurrentSong('SNG_ID');var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');api.call({method:'song.getLyrics',data:{SNG_ID:sngID},success:function(data){if(data.LYRICS_TEXT){data.LYRICS_TEXT=data.LYRICS_TEXT.split(/\r\n|\r|\n/g);}
_dzPlayer.lyrics['LYRICS_'+lyricsID]=data;Events.trigger(Events.lyrics.load);}});}}},getLyrics:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');if(dzPlayer.hasSyncLyrics()){return _dzPlayer.lyrics[key].LYRICS_SYNC_JSON;}
var textLyrics=_dzPlayer.lyrics[key].LYRICS_TEXT;if(textLyrics&&textLyrics.length){return textLyrics;}}
return null;},getLyricsMetadata:function(){if(dzPlayer.hasLoadedLyrics()){var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return{copyrights:_dzPlayer.lyrics[key].LYRICS_COPYRIGHTS,writers:_dzPlayer.lyrics[key].LYRICS_WRITERS};}
return null;},hasLyrics:function(){var lyricsID=dzPlayer.getCurrentSong('LYRICS_ID');return typeof lyricsID!=='undefined'&&lyricsID!==0;},hasLoadedLyrics:function(){if(!dzPlayer.hasLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');return(typeof _dzPlayer.lyrics[key]!=='undefined');},hasSyncLyrics:function(){if(!dzPlayer.hasLoadedLyrics()){return false;}
var key='LYRICS_'+dzPlayer.getCurrentSong('LYRICS_ID');var syncLyrics=_dzPlayer.lyrics[key].LYRICS_SYNC_JSON;return(typeof syncLyrics!=='undefined'&&syncLyrics.length!==0);},logManager:function(sendNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
if(typeof sendNextSong=='undefined'){sendNextSong=true;}
if(countObject(dzPlayer.logTrack)>0){if(OFFLINE){dzPlayer.logTrack.force_timestamp=SERVER_TIMESTAMP;Events.trigger(Events.player.log_offline,dzPlayer.logTrack);}else{var logNextSong={};if(sendNextSong&&countObject(dzPlayer.logStartedTrack())>0){logNextSong=dzPlayer.logStartedTrack();}
if(typeof dzPlayer.user_status.timestamp!='undefined'){dzPlayer.logTrack.timestamp=dzPlayer.user_status.timestamp;}
if(dzPlayer.logTrack.sng_id>0&&dzPlayer.getPlayerType()=='mod'){Events.trigger(Events.player.updateRestrictTime,dzPlayer.logTrack.lt);}
dzPlayer.sendLog(dzPlayer.logTrack,logNextSong);if(!sendNextSong){dzPlayer.logTrack={};return false;}}}else{if(countObject(dzPlayer.logStartedTrack())&&sendNextSong){dzPlayer.sendLog(dzPlayer.logTrack,dzPlayer.logStartedTrack());}}
dzPlayer.logTrack=$.extend(true,{},dzPlayer.logTrackTemplate);if(dzPlayer.isLimited()){dzPlayer.logTrack.l_30sec=1;}
dzPlayer.logTrack.media.id=dzPlayer.getCurrentSong('MEDIA_ID');dzPlayer.logTrack.media.type=dzPlayer.getMediaType();if(dzPlayer.getContext('TYPE')==='inapp'){dzPlayer.logTrack.app={id:dzPlayer.getContext('ID'),t:dzPlayer.getContext('TYPE')};}
if(dzPlayer.getContext('TYPE')!=''){dzPlayer.logTrack.ctxt.t=dzPlayer.getContext('TYPE');}
if(dzPlayer.getContext('ID')!=''){dzPlayer.logTrack.ctxt.id=dzPlayer.getContext('ID');}
if(dzPlayer.getContext('CONTEXT_ID')!=''){dzPlayer.logTrack.ctxt.c=dzPlayer.getContext('CONTEXT_ID');}
dzPlayer.logTrack.type=dzPlayer.getPlayerTypeId();}catch(e){error.log(e);}},logStartedTrack:function(){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
var liveTrack={};if(dzPlayer.getCurrentSong()!==null&&USER.USER_ID>0){liveTrack={id:dzPlayer.getCurrentSong('MEDIA_ID'),type:dzPlayer.getMediaType()};}
return liveTrack;}catch(e){error.log(e);}},sendLog:function(logSong,logNextSong){try{if(dzPlayer.getPlayerType()==='chromecast'){return false;}
Events.trigger(Events.player.setBookmark,$.extend(false,logSong,{offset:dzPlayer.getPosition(),duration:dzPlayer.getDuration()}));var songsParams={};if(countObject(logSong)>0){songsParams.params=logSong;}
if(countObject(logNextSong)>0){songsParams.next_media={media:logNextSong};}
api.call('log.listen',songsParams,function(result){dzPlayer.token=result;if(dzPlayer.token!==false){dzPlayer.trigger('audioPlayer_setToken',[dzPlayer.token]);}});return true;}catch(e){error.log(e);}},restoreSetting:function(settings){try{if(countObject(settings)==0){return false;}
dzPlayer.hq=(typeof settings.site.player_hq=='undefined'||settings.site.player_hq==null)?(typeof USER!='undefined'&&USER.OPTIONS.web_hq):(settings.site.player_hq&&DZPS);dzPlayer.volume=storage.get('volume',0.5);if(typeof settings.site.player_fade!=='undefined'){dzPlayer.fade=settings.site.player_fade;}
if(typeof settings.site.player_repeat!=='undefined'){dzPlayer.repeat=settings.site.player_repeat;}
if(typeof settings.site.player_shuffle!=='undefined'){dzPlayer.shuffle=(typeof settings.site.player_shuffle==='string')?Boolean(parseInt(settings.site.player_shuffle,10)):settings.site.player_shuffle;}
Events.trigger(Events.player.hq,dzPlayer.hq);Events.trigger(Events.player.volume,dzPlayer.volume);Events.trigger(Events.player.shuffle_changed,dzPlayer.shuffle);Events.trigger(Events.player.repeat_changed,dzPlayer.repeat);dzPlayer.control.changeFadeValue(dzPlayer.fade);dzPlayer.control.setVolume(dzPlayer.volume);dzPlayer.control.setHq(dzPlayer.hq);return true;}catch(e){error.log(e);}},setAppId:function(app_id){try{dzPlayer.appId=app_id;}catch(e){error.log(e);}},setApp:function(app){try{dzPlayer.appId=app.id;dzPlayer.appType=app.type;}catch(e){error.log(e);}},setPropValue:function(propName,value){try{if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='trackList'){return dzPlayer.setTrackList({index:0,data:value,chromecast:true});}}
if(propName=='loadError'){return false;}
if(propName==='preloadComplete'||propName==='preloadAborted'){Events.trigger(Events.player[propName],value);if(propName==='preloadComplete'){dzPlayer.cached[value]=true;}else{delete dzPlayer.cached[value];}
return false;}
if(propName=='duration'&&value==0){return false;}
if(propName=='loadingStats'){if(value.partIndex<=2&&value.sngId>0&&value.sngId==dzPlayer.getCurrentSong('SNG_ID')){dzPlayer.logTrack.ls[value.partIndex]={duration:value.loadingTime,size:value.size,host:value.hostname};}
return false;}
if(dzPlayer.getPlayerType()!=='chromecast'&&propName=='position'&&value>0){if(dzPlayer.lastPosition!=Math.floor(value)){dzPlayer.logTrack.lt+=1;}
dzPlayer.lastPosition=Math.floor(value);if(dzPlayer.getPlayerType()=='ads'){Events.trigger(Events.player.adsVastPlaying,{position:value});}
if(Math.floor(value)==dzPlayer.getDuration()-20&&!dzPlayer.isLimited()&&dzPlayer.getPlayerType()!='ads'&&dzPlayer.getPlayerType()!='jingle'){var nextSong=dzPlayer.getNextSong();if(nextSong!=null&&nextSong.DURATION>60&&typeof dzPlayer.cached[nextSong.SNG_ID]==='undefined'){dzPlayer.cached[nextSong.SNG_ID]=false;dzPlayer.trigger('audioPlayer_preloadTrack',[[dzPlayer.getNextSong()]]);}}}
if(propName=='finish'){Events.trigger(Events.player.track_end,value);}
dzPlayer[propName]=value;if(propName==='user_status'&&dzPlayer.user_status.limited&&USER.USER_ID>0){throw new dzError({name:'DZPLAYER',message:'user_status limited:'+dzPlayer.token});}
if(dzPlayer.getPlayerType()==='chromecast'){if(propName=='repeat'){propName='repeat_changed';}
if(propName==='shuffle'){propName='shuffle_changed';}
if(propName==='volume'){propName='volume_changed';value=Math.round(value*100);}}
if(typeof Events.player[propName]!=='string'){throw new dzError({name:'DZPLAYER',message:'Unknown Event : '+propName});}
Events.trigger(Events.player[propName],value);}catch(e){error.log(e);}},trigger:function(methodName,params){try{if(dzPlayer.user_status.preview===false){return false;}
if(params==null){params=[];}
if(dzPlayer.playerLoaded){if(dzPlayer.getPlayerType()==='chromecast'){return chromecast.doAction(methodName,params);}
executeActionscriptMethod('audioPlayerSWF',methodName,params);}}catch(e){error.log(e);}}};window.dzPlayer=dzPlayer;})();function setDzPlayerProp(prop,value){try{dzPlayer.setPropValue(prop,value);}catch(e){error.log(e);}}
function setDzPlayerProps(keyValueObject){try{for(var key in keyValueObject){if(!keyValueObject.hasOwnProperty(key)){continue;}
dzPlayer.setPropValue(key,keyValueObject[key]);}}catch(e){error.log(e);}}
function executeActionscriptMethod(swfId,method,params){try{if(document.getElementById(swfId)===null||typeof document.getElementById(swfId).callAS!=='function'){error.log({message:'swf not accessible',description:'executeActionscriptMethod: / swfId '+swfId});return false;}
document.getElementById(swfId).callAS(method,params);}catch(e){error.log(e);}};;
if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}
var aArgs=Array.prototype.slice.call(arguments,1);var fToBind=this;var FuncNOOP=function(){};var fBound=function(){return fToBind.apply(this instanceof FuncNOOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)));};FuncNOOP.prototype=this.prototype;fBound.prototype=new FuncNOOP();return fBound;};}
if(typeof console==='undefined'){console=function(){};console.log=function(msg){};}
$(document).ready(function(){if(ENV!=='DEV'&&typeof gatekeeper!=='undefined'&&!gatekeeper.isAllowed('console_log')){console.log=function(){};}});if(typeof window.onerror==='undefined'){window.onerror=function(){};}
document.write=function(){return false;}
document.open=function(){return false;}
document.close=function(){return false;}
function loadFacebox(page){try{dclk_hide();$('.tipsy').remove();$('#hovercard').hide();$('#sharebox').remove();$('#facebox_overlay').fadeOut();param=page.split('?');var query_param='';if(typeof param[1]!='undefined'){var query_param=param[1];}
var url='/'+param[0]+'?checkForm='+encodeURIComponent(checkForm)+'&'+query_param;if(PLATFORM!='web'){$.get(url,function(data){$('body').html(data);});return true;}
var id=util.uniqid();jQuery.facebox({ajax:url});$('#facebox').data('uniqid',id);return id;}catch(e){error.log(e);}}
function loadBox(page,options){return www.navigate(page,options);}
function displayInterstitial(data){try{var content='';var self_close=false;switch(data.type){case'autopromo_img':if(!www.allowAutoPromo(data)){return false;}
if(data.target=='internal'){data.target='_self';data.click='javascript:'+data.click+'; removeInterstitial(); return false';}else{data.target='_'+data.target;}
content='<img src="'+data.url+'"/>';storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'autopromo_video':if(!www.allowAutoPromo(data)){return false;}
content=data.embed;if(data.self_close==='0'){self_close=true;}
storage.set('autopromo_intersticiel',true,true,SERVER_TIMESTAMP+86400);break;case'ads_billboard':if(!USER.OPTIONS.ads_display){return false;}
content='<img src="'+data.url+'"/>';break;case'ads_interstitial':if(!USER.OPTIONS.ads_display){return false;}
var formatSize=data.formatSize.split('x');if(data.format=='image'){content='<img src="'+data.url+'"/>';}else if(data.format=='swf'){ads.setSwf('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],data.clickTagMethod,data.click,'#FFFFFF','opaque');data.click='javascript:void(0)';data.target='_self';}else if(data.format=='redirect'){ads.setRedirect('interstitial_ads',data.redirect.js,data.redirect.clickCommand,formatSize[0],formatSize[1]);data.click='javascript:void(0)';data.target='_self';}else if(data.format=='video'){ads.setVideo('interstitial_ads','interstitial_ads_swf',data.url,formatSize[0],formatSize[1],'','',0,data.click);data.click='javascript:void(0)';data.target='_self';}else if(data.format==='html5'){ads.setHtmlRedirect('interstitial_ads',data.url,data.click,data.formatId,formatSize[0],formatSize[1]);data.target='_self';}
if(data.pixelAgence){ads.setPixelAgence(data.pixelAgence,'ads_pixel');}
if(data.pixelAgenceScript){$('head').append(unescape(data.pixelAgenceScript));}
break;default:return false;}
if(typeof data.duration==='undefined'){data.duration=3;}
if(content!=''){$('#interstitial_ads').append($(content));}
$('#interstitial_ads').attr({href:data.click,target:data.target});$('#interstitial').show();if(!self_close){setTimeout(function(){removeInterstitial();},parseInt(data.duration)*1000);}}catch(e){error.log(e);}}
function removeInterstitial(){try{$('#interstitial').hide();$('#interstitial_ads').removeAttr('href').empty();}catch(e){error.log(e);}}
function show(id){$('#'+id).css('display','block');}
function hide(id){$('#'+id).css('display','none');}
function inline(id){$('#'+id).css('display','inline');}
var last_asynch_request;var async_groups={};function sendRequest(url,response,post,asynchronous,callback,callback_parameters){try{var post_status='GET';if(post!=''&&typeof post!=='undefined'){post_status='POST';}
if(typeof asynchronous!='boolean'){asynchronous=false;}
if(typeof callback_parameters=='undefined'||callback_parameters==null){callback_parameters=false;}
var ajax=$.ajax({url:url,type:post_status,data:post,async:asynchronous,success:function(data,textStatus,xhr){if(typeof callback==='function'){try{callback(xhr,callback_parameters);}catch(e){error.log(e)}}else{return data;}}});if(response=='xml'){result=ajax.responseXML;}else{result=ajax.responseText;}
return result;}catch(e){error.log(e);}}
function setCookie(name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);var cookie_domain=typeof SETTING_DOMAIN_COOKIE==='undefined'?'':(';domain='+SETTING_DOMAIN_COOKIE);document.cookie=name+'='+escape(value)+cookie_domain+'; path=/'+((expiredays==null)?'':';expires='+exdate.toGMTString());}
function getCookie(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+'=');if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(';',c_start);if(c_end==-1){c_end=document.cookie.length;}
return unescape(document.cookie.substring(c_start,c_end));}}
return'';}
function addslashes(string){return string.toString().replace(/([\\"'])/g,'\\$1').replace(/\0/g,'\\0');}
function stripslashes(string){return string.toString().replace(/\\(.?)/g,function(s,n1){switch(n1){case'\\':return'\\';case'0':return'\u0000';case'':return'';default:return n1;}});}
function ucfirst(str){try{var f=str.charAt(0).toUpperCase();return f+str.substr(1);}catch(e){error.log(e);}}
function base64_decode(data){try{var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1;var o2;var o3;var h1;var h2;var h3;var h4;var bits;var i=0;var ac=0;var dec='';var tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return dec;}catch(e){error.log(e);}}
function bin2hex(str){var len=str.length;var rv='';var i=0;var c;while(len-->0){c=str.charCodeAt(i++);rv+=_bin2hex[(c&0xf0)>>4];rv+=_bin2hex[(c&0x0f)];}
return rv;}
function hex2bin(str){var len=str.length;var rv='';var i=0;var c1;var c2;while(len>1){h1=str.charAt(i++);c1=h1.charCodeAt(0);h2=str.charAt(i++);c2=h2.charCodeAt(0);rv+=String.fromCharCode((_hex2bin[c1]<<4)+_hex2bin[c2]);len-=2;}
return rv;}
var _bin2hex=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];var _hex2bin=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function analyticsTrackingEvent(category,action,optional_label){try{date=new Date();timestamp=date.getTime();timestamp=Math.round(timestamp/1000)+315622800;if(typeof _gaq!='undefined'){_gaq.push(['_trackEvent',category,action,optional_label]);}}catch(e){error.log(e);}}
function insertAfter(element,node){try{element.parentNode.insertBefore(node,element.nextSibling);}catch(e){error.log(e);}}
function crontab(){if(typeof crontab_timeout==='undefined'){crontab_timeout=window.setInterval(crontab,999);}
update_server_timestamp();try{if((SESSION_DURATION%10)===0){ads.incrementRefreshCounter();friends.updateOnline();}
if((SESSION_DURATION%30)===0){calculeTime();}}catch(e){}
return true;}
function update_server_timestamp(){SERVER_TIMESTAMP+=1;SESSION_DURATION+=1;return true;}
(function(){'use strict';var defaultDiacriticsRemovalap=[{base:'A',letters:'\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F'},{base:'AA',letters:'\uA732'},{base:'AE',letters:'\u00C6\u01FC\u01E2'},{base:'AO',letters:'\uA734'},{base:'AU',letters:'\uA736'},{base:'AV',letters:'\uA738\uA73A'},{base:'AY',letters:'\uA73C'},{base:'B',letters:'\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181'},{base:'C',letters:'\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E'},{base:'D',letters:'\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779'},{base:'DZ',letters:'\u01F1\u01C4'},{base:'Dz',letters:'\u01F2\u01C5'},{base:'E',letters:'\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E'},{base:'F',letters:'\u0046\u24BB\uFF26\u1E1E\u0191\uA77B'},{base:'G',letters:'\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E'},{base:'H',letters:'\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D'},{base:'I',letters:'\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197'},{base:'J',letters:'\u004A\u24BF\uFF2A\u0134\u0248'},{base:'K',letters:'\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2'},{base:'L',letters:'\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780'},{base:'LJ',letters:'\u01C7'},{base:'Lj',letters:'\u01C8'},{base:'M',letters:'\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C'},{base:'N',letters:'\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4'},{base:'NJ',letters:'\u01CA'},{base:'Nj',letters:'\u01CB'},{base:'O',letters:'\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C'},{base:'OI',letters:'\u01A2'},{base:'OO',letters:'\uA74E'},{base:'OU',letters:'\u0222'},{base:'OE',letters:'\u008C\u0152'},{base:'oe',letters:'\u009C\u0153'},{base:'P',letters:'\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754'},{base:'Q',letters:'\u0051\u24C6\uFF31\uA756\uA758\u024A'},{base:'R',letters:'\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782'},{base:'S',letters:'\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784'},{base:'T',letters:'\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786'},{base:'TZ',letters:'\uA728'},{base:'U',letters:'\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244'},{base:'V',letters:'\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245'},{base:'VY',letters:'\uA760'},{base:'W',letters:'\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72'},{base:'X',letters:'\u0058\u24CD\uFF38\u1E8A\u1E8C'},{base:'Y',letters:'\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE'},{base:'Z',letters:'\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762'},{base:'a',letters:'\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250'},{base:'aa',letters:'\uA733'},{base:'ae',letters:'\u00E6\u01FD\u01E3'},{base:'ao',letters:'\uA735'},{base:'au',letters:'\uA737'},{base:'av',letters:'\uA739\uA73B'},{base:'ay',letters:'\uA73D'},{base:'b',letters:'\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253'},{base:'c',letters:'\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184'},{base:'d',letters:'\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A'},{base:'dz',letters:'\u01F3\u01C6'},{base:'e',letters:'\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD'},{base:'f',letters:'\u0066\u24D5\uFF46\u1E1F\u0192\uA77C'},{base:'g',letters:'\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F'},{base:'h',letters:'\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265'},{base:'hv',letters:'\u0195'},{base:'i',letters:'\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131'},{base:'j',letters:'\u006A\u24D9\uFF4A\u0135\u01F0\u0249'},{base:'k',letters:'\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3'},{base:'l',letters:'\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747'},{base:'lj',letters:'\u01C9'},{base:'m',letters:'\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F'},{base:'n',letters:'\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5'},{base:'nj',letters:'\u01CC'},{base:'o',letters:'\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275'},{base:'oi',letters:'\u01A3'},{base:'ou',letters:'\u0223'},{base:'oo',letters:'\uA74F'},{base:'p',letters:'\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755'},{base:'q',letters:'\u0071\u24E0\uFF51\u024B\uA757\uA759'},{base:'r',letters:'\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783'},{base:'s',letters:'\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B'},{base:'t',letters:'\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787'},{base:'tz',letters:'\uA729'},{base:'u',letters:'\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289'},{base:'v',letters:'\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C'},{base:'vy',letters:'\uA761'},{base:'w',letters:'\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73'},{base:'x',letters:'\u0078\u24E7\uFF58\u1E8B\u1E8D'},{base:'y',letters:'\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF'},{base:'z',letters:'\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763'}];var diacriticsMap={};var diacriticsRegExp=/[^\u0000-\u007E]/g;var diacriticsRegExp2=/[^a-z0-9]/gi;for(var i=0;i<defaultDiacriticsRemovalap.length;i++){var letters=defaultDiacriticsRemovalap[i].letters;for(var j=0;j<letters.length;j++){diacriticsMap[letters[j]]=defaultDiacriticsRemovalap[i].base;}}
window.rewriting=function(str){if(typeof str!=='string'){return'';}
return str.replace(diacriticsRegExp,function(a){return diacriticsMap[a]||a;}).replace(diacriticsRegExp2,'-');};})();String.prototype.trim=function(trimChar){return trim(this,typeof trimChar!='undefined'?trimChar:null);};function trim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');var regexpRight=new RegExp('['+trimChar+']['+trimChar+']*$');}else{var regexpLeft=new RegExp('^\\s\\s*');var regexpRight=new RegExp('\\s\\s*$');}
return myString.replace(regexpLeft,'').replace(regexpRight,'');}
String.prototype.ltrim=function(trimChar){return ltrim(this,typeof trimChar!='undefined'?trimChar:null)};function ltrim(myString,trimChar){if(typeof trimChar=='string'&&trimChar!=''){var regexpLeft=new RegExp('^['+trimChar+']['+trimChar+']*');}else{var regexpLeft=new RegExp('^\\s\\s*');}
return myString.replace(regexpLeft,'');}
function str_replace(haystack,needle,replacement){var temp=haystack.split(needle);return temp.join(replacement);}
function truncateTxt(txt,max_length){if(txt.length>max_length){txt=txt.substr(0,max_length-4)+' ...';}
return txt;}
function shuffle(a){var j=0;var valI;var valJ;var l=a.length-1;if(l===-1){return a;}
while(l>-1){j=Math.floor(Math.random()*l);valI=a[l];valJ=a[j];a[l]=valJ;a[j]=valI;l=l-1;}
return a;}
function calculeTime(){$('.timestamp').each(function(index){if(typeof $(this).data('timestamp')==='undefined'||isNaN($(this).data('timestamp'))){return;}
var data_timestamp=parseInt($(this).data('timestamp'),10);var timestamp=SERVER_TIMESTAMP-data_timestamp;$(this).text((data_timestamp===0)?'-':getAgoTime(timestamp));if($(this).is('[data-display-title="true"]')&&data_timestamp>0){$(this).prop('title',getAgoTime(timestamp))}});return true;}
function localTimeStamp(){return Math.floor(new Date().getTime()/1000);}
function getAgoTime(timer){try{if(isNaN(timer)||timer<0){timer=0;}
if(timer<60){return gettext('Il y a quelques instants');}else if(timer<3600){timer=Math.round(timer/60);return ngettext('Il y a %s minute','Il y a %s minutes',{sprintf:[timer],count:timer});}else if(timer<86400){timer=Math.round(timer/3600);return ngettext('Il y a %s heure','Il y a %s heures',{sprintf:[timer],count:timer});}else if(timer>86400&&timer<172800){return gettext('Hier');}else if(timer<518400){timer=Math.round(timer/86400);return ngettext('Il y a %s jour','Il y a %s jours',{sprintf:[timer],count:timer});}else if(timer<2592000){timer=Math.round(timer/604800);return ngettext('Il y a %s semaine','Il y a %s semaines',{sprintf:[timer],count:timer});}else{timer=Math.round(timer/2592000);if(timer>12){return gettext('Il y a plus d\'un an');}
return ngettext('Il y a %s mois','Il y a %s mois',{sprintf:[timer],count:timer});}}catch(e){error.log(e)}}
function pad(number,length){var str=number.toString();while(str.length<length){str='0'+str;}
return str;}
function secToMin(seconds){if(isNaN(seconds)){return false;}
seconds=Math.floor(seconds);return pad(Math.floor(seconds/60),2)+':'+pad(seconds%60,2);}
function getTotalDuration(seconds){seconds=seconds||0;var minutes=Math.floor(seconds/60);var hours;var result;if(minutes>59){hours=Math.floor(minutes/60);minutes=minutes-(hours*60);result=ngettext('%s h','%s h',{sprintf:[hours],count:hours});if(minutes>0){result+=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}}else{result=' '+ngettext('%s min','%s min',{sprintf:[pad(minutes,2)],count:minutes});}
return result;}
function timestampToDate(timestamp,hours,date_separator,reverse_date){var hours=hours||false;var date_separator=date_separator||'/';var reverse_date=reverse_date||false;var date=new Date();date.setTime(timestamp*1000);var month=parseInt(date.getMonth())+1;var dateString=pad(date.getDate(),2)+date_separator+pad(month,2)+date_separator+date.getFullYear();if(reverse_date){dateString=date.getFullYear()+date_separator+pad(month,2)+date_separator+pad(date.getDate(),2);}
if(hours){dateString+=' '+pad(date.getHours(),2)+':'+pad(date.getMinutes(),2)+':'+pad(date.getSeconds(),2);}
return dateString;}
function serialize(txt){switch(typeof txt){case'string':return's:'+txt.length+':"'+txt+'";';case'number':if(txt>=0&&String(txt).indexOf('.')==-1&&txt<65536){return'i:'+txt+';';}
return'd:'+txt+';';case'boolean':return'b:'+((txt)?'1':'0')+';';case'object':var i=0;var ret='';for(var k in txt){if(!txt.hasOwnProperty(k)){continue;}
if(!isNaN(k)){k=Number(k);}
ret+=serialize(k)+serialize(txt[k]);i++;}
return'a:'+i+':{'+ret+'}';default:return'N;';}}
function unserialize(txt){var level=0;var arrlen=[];var del=0;var result=[];var key=[];var save=txt;while(1){switch(txt.substr(0,1)){case'N':del=2;ret=null;break;case'b':del=txt.indexOf(';')+1;ret=(txt.substring(2,del-1)=='1')?true:false;break;case'i':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case'd':del=txt.indexOf(';')+1;ret=Number(txt.substring(2,del-1));break;case's':del=txt.substr(2,txt.substr(2).indexOf(':'));ret=txt.substr(1+txt.indexOf('"'),del);del=txt.indexOf('"')+1+ret.length+2;break;case'a':del=txt.indexOf(':{')+2;ret=new Array();arrlen[level+1]=Number(txt.substring(txt.indexOf(':')+1,del-2))*2;break;case'O':txt=txt.substr(2);var tmp=txt.indexOf(':"')+2;var nlen=Number(txt.substring(0,txt.indexOf(':')));name=txt.substring(tmp,tmp+nlen);txt=txt.substring(tmp+nlen+2);del=txt.indexOf(':{')+2;ret=new Object();arrlen[level+1]=Number(txt.substring(0,del-2))*2;break;case'}':txt=txt.substr(1);if(arrlen[level]!=0){alert('var missed : '+save);return undefined;};level--;continue;default:if(level==0){return result;}
return undefined;}
if(arrlen[level]%2==0){if(typeof ret=='object'){alert('array index object no accepted : '+save);return undefined;}
if(ret==undefined){alert('syntax invalid(2) : '+save);return undefined;}
key[level]=ret;}else{var ev='';for(var i=1;i<=level;i++){if(typeof key[i]=='number'){ev+='['+key[i]+']';}else{ev+='["'+key[i]+'"]';}}
eval('result'+ev+'= ret;');}
arrlen[level]--;if(typeof ret=='object'){level++;}
txt=txt.substr(del);continue;}}
function countObject(obj){if(typeof obj!=='object'){return false;}
if(typeof Object.keys=='function'){return Object.keys(obj).length;}
var count=0;for(var prop in obj){if(obj.hasOwnProperty(prop)){++count;}}
return count;}
function return_age(date){now=CURRENT_DATE;exp_date=date.split('-');exp_now=now.split('-');date_year=exp_date[0];date_month=exp_date[1];date_day=exp_date[2];now_year=exp_now[0];now_month=exp_now[1];now_day=exp_now[2];years=now_year-date_year;if(now_month<=date_month){if(date_month==now_month){if(date_day>now_day){years-=1;}}else{years-=1;}}
age=years;return age;}
function dateToTimestamp(string_date){if(typeof string_date==='undefined'||typeof string_date!=='string'){return false;}
var rdate=/^\d{4}-\d{1,2}-\d{1,2}$/;var rdatehours=/^\d{4}-\d{1,2}-\d{1,2} \d{2}:\d{2}:\d{2}$/;var total_date=[];if(rdate.exec(string_date)){date=string_date.split('-');time=['0','0','0']}else if(rdatehours.exec(string_date)){full_date=string_date.split(' ');time=full_date[1].split(':');date=full_date[0].split('-');}else{return SERVER_TIMESTAMP;}
return new Date(date[0],date[1]-1,date[2],time[0],time[1],time[2]).getTime()/1000;}
function getShortMonthName(month){var months_name=[gettext('JAN'),gettext('FEV'),gettext('MAR'),gettext('AVR'),gettext('MAI'),gettext('JUIN'),gettext('JUIL'),gettext('AOU'),gettext('SEP'),gettext('OCT'),gettext('NOV'),gettext('DEC')];return months_name[(month.charAt(0)=='0')?(parseInt(month.charAt(1))-1):(parseInt(month)-1)];}
function getScripts(scripts,finalCallback){_getScript(scripts,0,scripts.length,finalCallback);}
function _getScript(scripts,pos,max,finalCallback){if(pos<0||pos>=max){finalCallback();return;}
if(RESSOURCES.cached[scripts[pos][0]]==true){_getScript(scripts,pos+1,max,finalCallback);}else{if(scripts[pos][1]=='js'){$.ajax({cache:true,url:scripts[pos][0],dataType:'script',success:function(){RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}});}
if(scripts[pos][1]=='css'){$('head').append($('<link rel="stylesheet" type="text/css" href="'+scripts[pos][0]+'" />'));RESSOURCES.cached[scripts[pos][0]]=true;_getScript(scripts,pos+1,max,finalCallback);}}}
function getClientHeight(){if(typeof window.innerHeight==='number'){return window.innerHeight;}else if(typeof document.documentElement.clientHeight!=='undefined'){return document.documentElement.clientHeight;}else if(typeof document.body.clientHeight!=='undefined'){return document.body.clientHeight;}else{return 0;}}
function getClientWidth(){if(typeof document.documentElement.clientWidth!=='undefined'){return document.documentElement.clientWidth;}else if(typeof document.body.clientWidth!=='undefined'){return document.body.clientWidth;}else if(typeof window.innerWidth==='number'){return window.innerWidth;}else{return 0;}}
function timestampToIso8601(ts){if(typeof ts==='undefined'){var ts=Math.floor(new Date().getTime()/1000);}
var aDate=new Date();aDate.setTime(ts*1000);return(aDate.getFullYear()+'-'+pad((aDate.getMonth()+1),2)+'-'+pad(aDate.getDate(),2)+'T'+pad(aDate.getHours(),2)+':'+pad(aDate.getMinutes(),2));}
String.prototype.format=function(){var s=this;var i=arguments.length;while(i--){s=s.replace(new RegExp('\\{'+i+'\\}','gm'),arguments[i]);}
return s;};function formatDate(date,delimiter){if(typeof delimiter==='undefined'){delimiter='-';}
var buffer=[];var format=DATE_FORMAT.split('-');if(date.indexOf('-')==-1&&date.length==8){date=date.substring(0,4)+'-'+date.substring(4,6)+'-'+date.substring(6,8);}
var parts=date.split('-');for(var i=0;i<3;i++){switch(format[i]){case'd':buffer.push(parts[2]);break;case'm':buffer.push(parts[1]);break;case'Y':buffer.push(parts[0]);break;}}
return buffer.join(delimiter);}
function formatedTimeToSecond(time){var format=time.split(':');var seconds=0;if(format.length==3){seconds+=parseInt(format[2]);seconds+=parseInt(format[1])*60;seconds+=parseInt(format[0])*(60*60);}
return seconds;}
function formatDuration(duration,display_hours){display_hours=display_hours||false;duration=parseInt(duration,10)||0;if(duration<=0){return'00:00';}
var hour=Math.floor(duration/(60*60));var min=Math.floor(display_hours?(duration%(60*60)/60):(duration/60));var sec=Math.floor(duration%(60*60)%60);if(hour<10){hour='0'+hour;}
return(display_hours?hour+':':'')+((min<10)?'0'+min:min)+':'+((sec<10)?'0'+sec:sec);}
function breakUpThousands(nStr){nStr+='';var x=nStr.split('.');var x1=x[0];var x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+' '+'$2');}
return x1+x2;}
function loadPayment($this){try{var data=$this.data();data.origin=data.origin||0;var url=SETTING_HOST_SITE+'/payment/go.php?';url+=typeof data.offer_id!=='undefined'?'id='+data.offer_id+'&':'';url+=typeof data.change_mop!=='undefined'?'change_mop='+data.change_mop+'&':'';url+=typeof data.gift!=='undefined'?'gift='+data.gift+'&':'';url+='origin='+data.origin+'&';if(typeof data.gift!=='undefined'){url+='gift='+data.gift+'&';}
loadPaymentProgress=true;tracking.track('offers_subscribe_click',{origin:data.origin},function(){window.location=url;});return true;}catch(e){}}
function stripTags(str){var el=document.createElement('div');el.innerHTML=str;return el.textContent?el.textContent:el.innerText;}
function htmle(str){return encodeHTMLEntities(str);}
function encodeHTMLEntities(str){var el=document.createElement('div');el[typeof el.textContent!=='undefined'?'textContent':'innerText']=str;return el.innerHTML;}
function copyToClipboard(target,data,message){if(!window.ZeroClipboard||!target||!data){return false;}
new ZeroClipboard(target).on('ready',function(){this.on('copy',function(zc){zc.clipboardData.setData('text/plain',data);}).on('aftercopy',function(){if(message){Events.trigger(Events.copy.after,{message:message});}});});}
function isPlainObject(obj){return obj&&obj===Object(obj)&&!Array.isArray(obj);}
function getObjDeepKey(obj,keys){if(!isPlainObject(obj)){return null;}
for(var i=0,keys=keys.split('.'),l=keys.length;i<l;++i){if(typeof obj[keys[i]]==='undefined'||(i!==(keys.length-1)&&!isPlainObject(obj[keys[i]]))){return null;}
obj=obj[keys[i]];};return obj;}
String.prototype.convertURLToLink=function(){var RexExpURL=/(https?:\/\/|www\.)([a-z0-9-\.]+\.)?([a-z0-9-]+)\.([a-z0-9-]{2,63})((\?|\/)([^\s\r\n@<>!]*))?/gi;return this.toString().replace(RexExpURL,function(matched){if(matched.indexOf('@')===-1){var urlwithHTTP=matched.indexOf('http')===-1?'http://'+matched:matched;var domain=urlwithHTTP.split('/')[2].split('.').reverse().slice(0,2).reverse().join('.');if(domain==document.domain){return'<a href="/'+arguments[7]+'" class="evt-click">'+matched+'</a>';}
return'<a href="http://'+SETTING_HOST+'/l.php?url='+encodeURIComponent(urlwithHTTP)+'" target="_blank">'+matched+'</a>';}
return matched;});};function intersectObject(o1,o2){var r={};for(var p in o1){if(!o1.hasOwnProperty(p)){continue;}
if(typeof o2[p]!=='undefined'){r[p]=o1[p];}}
return r;}
function compareObject(w,x){var p_in_w={};for(var p in w){if(!w.hasOwnProperty(p)){continue;}
if(typeof w[p]!==typeof x[p]){return false;}
if((w[p]===null)!==(x[p]===null)){return false;}
switch(typeof w[p]){case'undefined':if(typeof x[p]!=='undefined'){return false;}
break;case'object':if(w[p]!==null&&x[p]!==null&&(w[p].constructor.toString()!==x[p].constructor.toString()||!compareObject(w[p],x[p]))){return false;}
break;case'function':if(p!='equals'&&w[p].toString()!=x[p].toString()){return false;}
break;default:if(w[p]!==x[p]){return false;}}
p_in_w[p]=true;}
for(var q in x){if(!x.hasOwnProperty(q)){continue;}
if(!p_in_w.hasOwnProperty(q)){return false;}}
return true;};
require=function e(t,s,a){function i(n,o){if(!s[n]){if(!t[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(r)return r(n,!0);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}var p=s[n]={exports:{}};t[n][0].call(p.exports,function(e){var s=t[n][1][e];return i(s?s:e)},p,p.exports,e,t,s,a)}return s[n].exports}for(var r="function"==typeof require&&require,n=0;n<a.length;n++)i(a[n]);return i}({250:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/get")["default"],i=e("babel-runtime/helpers/inherits")["default"],r=e("babel-runtime/helpers/create-class")["default"],n=e("babel-runtime/helpers/class-call-check")["default"],o=e("./model"),l=function(e){function t(){n(this,t),a(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return i(t,e),r(t,[{key:"getFallback",value:function(){return this.hasFallback()?new t(this.FALLBACK).set({ORIGIN_ID:Number(this.SNG_ID||this.EPISODE_ID),UNSEEN:this.UNSEEN,DATE_ADD:this.DATE_ADD}):void 0}},{key:"hasFallback",value:function(){return this.FALLBACK}},{key:"isUnseen",value:function(e){return this.DATE_ADD?this.DATE_ADD>e:null}}],[{key:"hydrate",value:function(e){for(var t=[],s=0,a=e.length;a>s;++s)t[s]=new this(e[s]);return t}}]),t}(o);t.exports=l},{"./model":249,"babel-runtime/helpers/class-call-check":287,"babel-runtime/helpers/create-class":288,"babel-runtime/helpers/get":291,"babel-runtime/helpers/inherits":292}],292:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/create")["default"],i=e("babel-runtime/core-js/object/set-prototype-of")["default"];s["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=a(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i?i(e,t):e.__proto__=t)},s.__esModule=!0},{"babel-runtime/core-js/object/create":282,"babel-runtime/core-js/object/set-prototype-of":286}],286:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":299}],299:[function(e,t,s){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/$.core").Object.setPrototypeOf},{"../../modules/$.core":304,"../../modules/es6.object.set-prototype-of":320}],320:[function(e,t,s){var a=e("./$.def");a(a.S,"Object",{setPrototypeOf:e("./$.set-proto").set})},{"./$.def":306,"./$.set-proto":314}],314:[function(e,t,s){var a=e("./$").getDesc,i=e("./$.is-object"),r=e("./$.an-object"),n=function(e,t){if(r(e),!i(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,s,i){try{i=e("./$.ctx")(Function.call,a(Object.prototype,"__proto__").set,2),i(t,[]),s=!(t instanceof Array)}catch(r){s=!0}return function(e,t){return n(e,t),s?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:n}},{"./$":312,"./$.an-object":301,"./$.ctx":305,"./$.is-object":311}],305:[function(e,t,s){var a=e("./$.a-function");t.exports=function(e,t,s){if(a(e),void 0===t)return e;switch(s){case 1:return function(s){return e.call(t,s)};case 2:return function(s,a){return e.call(t,s,a)};case 3:return function(s,a,i){return e.call(t,s,a,i)}}return function(){return e.apply(t,arguments)}}},{"./$.a-function":300}],300:[function(e,t,s){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],301:[function(e,t,s){var a=e("./$.is-object");t.exports=function(e){if(!a(e))throw TypeError(e+" is not an object!");return e}},{"./$.is-object":311}],311:[function(e,t,s){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],282:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":295}],295:[function(e,t,s){var a=e("../../modules/$");t.exports=function(e,t){return a.create(e,t)}},{"../../modules/$":312}],291:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/get-own-property-descriptor")["default"];s["default"]=function(e,t,s){for(var i=!0;i;){var r=e,n=t,o=s;i=!1,null===r&&(r=Function.prototype);var l=a(r,n);if(void 0!==l){if("value"in l)return l.value;var c=l.get;return void 0===c?void 0:c.call(o)}var p=Object.getPrototypeOf(r);if(null===p)return void 0;e=p,t=n,s=o,i=!0,l=p=void 0}},s.__esModule=!0},{"babel-runtime/core-js/object/get-own-property-descriptor":284}],284:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/get-own-property-descriptor"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-descriptor":297}],297:[function(e,t,s){var a=e("../../modules/$");e("../../modules/es6.object.get-own-property-descriptor"),t.exports=function(e,t){return a.getDesc(e,t)}},{"../../modules/$":312,"../../modules/es6.object.get-own-property-descriptor":318}],318:[function(e,t,s){var a=e("./$.to-iobject");e("./$.object-sap")("getOwnPropertyDescriptor",function(e){return function(t,s){return e(a(t),s)}})},{"./$.object-sap":313,"./$.to-iobject":315}],315:[function(e,t,s){var a=e("./$.iobject"),i=e("./$.defined");t.exports=function(e){return a(i(e))}},{"./$.defined":307,"./$.iobject":310}],249:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/create-class")["default"],i=e("babel-runtime/helpers/class-call-check")["default"],r=function(){function e(t){i(this,e),this.set(t)}return a(e,[{key:"set",value:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);return this}}]),e}();t.exports=r},{"babel-runtime/helpers/class-call-check":287,"babel-runtime/helpers/create-class":288}],288:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/define-property")["default"];s["default"]=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),a(e,i.key,i)}}return function(t,s,a){return s&&e(t.prototype,s),a&&e(t,a),t}}(),s.__esModule=!0},{"babel-runtime/core-js/object/define-property":283}],283:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":296}],296:[function(e,t,s){var a=e("../../modules/$");t.exports=function(e,t,s){return a.setDesc(e,t,s)}},{"../../modules/$":312}],287:[function(e,t,s){"use strict";s["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s.__esModule=!0},{}],240:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("jquery"),n=e("../components/common/ContextMenu"),o={initialized:!1,init:function(){Events.ready(Events.user.userReady,function(){i.render(a.createElement(n,null),document.getElementById("page_context_menu")),o.initialized=!0}),Events.subscribe(Events.navigation.context_menu_close,o.close)},close:function(e){return o.initialized&&0!==USER.USER_ID?void Events.trigger(Events.menu.contextMenuClose,e):!1},open:function(e){var t=e;return 0===USER.USER_ID?(www.goToConnection(),!1):("object"==typeof e.currentTarget&&(t=r.extend({},e.currentTarget.dataset),t.target=e.currentTarget),void Events.trigger(Events.menu.contextMenuOpen,t))}};t.exports=o},{"../components/common/ContextMenu":58,jquery:"jquery",react:"react","react-dom":"react-dom"}],58:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/keys")["default"],i=e("react"),r=e("classnames"),n=e("jquery"),o=e("../../core/i18n"),l=o.gettext,c=o.ngettext,p=e("../../core/modal"),d=e("../../core/favorite"),u=e("./Thumbnail"),h=e("../_mixins/sort"),m=e("../_mixins/tracking"),_=i.createClass({displayName:"ContextMenu",propTypes:{context:i.PropTypes.string},mixins:[h,m],getInitialState:function(){return{opened:!1,view:"home",playlist_list:this._getPlaylistList(),blocked:profile.data&&profile.data.DATA?profile.data.DATA.HAS_BLOCKED:!1,id:[0],type:"",cover_type:"",image:"",is_thumbnail:!1,excludes:[]}},componentDidMount:function(){Events.subscribe(Events.playlist.created,function(e,t){this.setState({playlist_list:this._getPlaylistList()}),"playlist"===this.state.view&&this._action({type:"add_track_to_playlist",id:t.PLAYLIST_ID})}.bind(this),"panel_playlist"),Events.subscribe(Events.playlist.removed,function(){this.setState({playlist_list:this._getPlaylistList()})}.bind(this),"panel_playlist"),Events.subscribe(Events.playlist.updated,function(){this.setState({playlist_list:this._getPlaylistList()})}.bind(this),"panel_playlist"),Events.subscribe(Events.navigation.page_displayed,function(){this._onClose(),profile.data&&profile.data.DATA&&this.setState({blocked:profile.data.DATA.HAS_BLOCKED})}.bind(this),"panel_playlist"),Events.subscribe(Events.layout.adsBackground,function(){this.state.opened&&this._setPosition()}.bind(this),"panel_playlist"),Events.subscribe(Events.user.blockFriend,function(){this.setState({blocked:!0})}.bind(this)),Events.subscribe(Events.user.unblockFriend,function(){this.setState({blocked:!1})}.bind(this)),Events.subscribe(Events.menu.contextMenuOpen,function(e,t){this._onOpen(t)}.bind(this)),Events.subscribe(Events.menu.contextMenuClose,function(e,t){this._onClose(t)}.bind(this))},getTrackingParams:function(){return{instance:this.state.type}},render:function(){var e,t=this._getFeatureList(),s=r({"menu-main":!0,opened:"home"===this.state.view,closed:"home"!==this.state.view}),n=r({"menu-playlist":!0,opened:"playlist"===this.state.view,closed:"playlist"!==this.state.view}),o=r({"popover-body":!0,"menu-extended":"playlist"===this.state.view});return i.createElement("section",{className:"page-contextmenu"+(this.state.opened?" opened":""),ref:"context_menu"},i.createElement("div",{className:"popover popover-"+this.state.position},this.state.is_thumbnail?"":this._renderHeader(),i.createElement("div",{className:o},i.createElement("div",{className:s},"talk"===this.state.type?i.createElement("div",null,i.createElement("div",{className:"episodes-headings"},i.createElement("h4",{className:"heading-4"},this.state.data.EPISODE_TITLE),i.createElement("h5",{className:"heading-4-sub"},window.secToMin(this.state.data.DURATION)," - ",formatDate(this.state.data.EPISODE_PUBLISHED_TIMESTAMP.split(" ")[0],"/"))),i.createElement("div",{className:"episodes-container nano",ref:"scroll_description"},i.createElement("div",{className:"nano-content"},this.state.data.EPISODE_DESCRIPTION))):!1,i.createElement("ul",null,a(t).map(function(s,a){var n=t[s];return e=r({"menu-item":!0,link:n.link,"no-icon":!n.icon}),this._isAvailableFeature(s)?"modify_avatar"===s||"modify_image"===s?i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},i.createElement("a",{className:"evt-click",href:"#","data-link":"0","data-change-picture":"1","data-type":this.state.type,"data-id":this._getElementId()},i.createElement("span",{className:"label"},n.wording))):"delete_avatar"===s||"delete_image"===s?i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},i.createElement("a",{className:"evt-click",href:"#","data-link":"0","data-delete-picture":"1","data-type":this.state.type,"data-id":this._getElementId()},i.createElement("span",{className:"label"},n.wording))):i.createElement("li",{key:"context_menu_"+s+a,onClick:this._action,"data-type":s,className:e},n.icon?i.createElement("span",{className:"icon icon-"+n.icon}):"",i.createElement("span",{className:"label"},n.wording)):!1}.bind(this)))),i.createElement("div",{className:n},i.createElement("h2",{className:"heading-5"},i.createElement("a",{"data-menu":"main",onClick:this._action,"data-type":"add_to_playlist"},i.createElement("span",{className:"icon icon-before icon-chevron-left"}),l("Retour"))),i.createElement("h3",{className:"heading-5-sub"},l("Slectionner")),i.createElement("ul",{className:"playlists"},i.createElement("li",{className:"menu-item playlist-create",onClick:this._onOpenPlaylistAssistant,role:"button"},i.createElement("span",{className:"icon icon-add"}),i.createElement("span",{className:"label"},l("Nouvelle playlist")))),i.createElement("div",{className:"playlist-container nano",ref:"scroll_playlist"},i.createElement("div",{className:"nano-content"},i.createElement("ul",{className:"playlists"},this.state.playlist_list.map(function(e,t){return i.createElement("li",{className:"menu-item",key:"context_menu_"+e.PLAYLIST_ID+t,onClick:this._action,"data-type":"add_track_to_playlist","data-id":e.PLAYLIST_ID,"data-position":t},i.createElement("span",{className:"icon icon-playlist"}),i.createElement("span",{className:"label ellipsis"},e.TITLE))}.bind(this)))))))))},_renderHeader:function(){var e={type:this.state.type,cover:"",picture_type:"",title1:"",url1:"",title2:"",url2:""};return"song"===this.state.type&&(e.type="track",this.state.id.length>1?e.title1=this.state.id.length+" "+c("titre","titres",{count:this.state.id.length}):(e.cover=this.state.data.SONG.ALB_PICTURE,e.title1=this.state.data.SONG.SNG_TITLE,e.url1=this.state.data.SONG.SNG_ID>0?"/album/"+this.state.data.SONG.ALB_ID:"",e.title2=this._getArtistName(this.state.data.SONG))),"playlist"===this.state.type&&(e.cover=this.state.data.PLAYLIST_PICTURE,e.picture_type=this.state.data.PICTURE_TYPE,e.title1=this.state.data.TITLE,e.url1="/playlist/"+this.state.data.PLAYLIST_ID,e.title2=i.createElement("a",{className:"evt-click",href:"/profile/"+(this.state.data.PARENT_USER_ID||USER.USER_ID)},this.state.data.PARENT_USERNAME||USER.BLOG_NAME)),"album"===this.state.type&&(e.cover=this.state.data.ALB_PICTURE,e.title1=this.state.data.ALB_TITLE,e.url1="/album/"+this.state.data.ALB_ID,e.title2=this._getArtistName(this.state.data)),"artist"===this.state.type&&(e.cover=this.state.data.ART_PICTURE,e.title1=this.state.data.ART_NAME,e.url1="/artist/"+this.state.data.ART_ID),"app"===this.state.type&&(e.cover=this.state.data.APP_PICTURE,e.title1=this.state.data.NAME,e.url1="/app/"+this.state.data.APP_ID),"talk"===this.state.type&&(e.cover=this.state.data.SHOW_ART_MD5,e.url1=this.state.data.SHOW_ID>0?"/show/"+this.state.data.SHOW_ID:"",e.title1=this.state.data.SHOW_NAME),"episode"===this.state.type&&(e.title1=this.state.data.EPISODE.EPISODE_TITLE,e.title2=i.createElement("a",{className:"evt-click",href:"/show/"+this.state.data.EPISODE.SHOW_ID},this.state.data.EPISODE.SHOW_NAME),e.cover=this.state.data.EPISODE.SHOW_ART_MD5,e.picture_type="talk"),i.createElement("div",{className:"popover-header"},!e.type||"song"===this.state.type&&this.state.id.length>1?!1:i.createElement("div",{className:"cell cell-thumbnail"},i.createElement(u,{type:e.type,md5:e.cover,picture_type:e.picture_type,height:56,width:56,onClick:function(){www.navigate(e.url1)}})),i.createElement("div",{className:"cell cell-infos"},i.createElement("h2",{className:"heading-4 ellipsis"},1===this.state.id.length?i.createElement("a",{className:"evt-click",href:e.url1},e.title1):e.title1),""===e.title2?!1:i.createElement("h3",{className:"heading-4-sub ellipsis"},l("par")," ",e.title2)))},_onOpen:function(e){"object"!=typeof e.id&&(e.id=[e.id]),"rtl"!==window.DIRECTION||"left"!==e.position&&"right"!==e.position||(e.position="left"===e.position?"right":"left"),n(this.refs.context_menu).show(),this.setState({id:e.id||[0],view:e.view||"home",target:e.target,position:e.position||"right",type:e.type||"",context:e.context||"",listen_context:e.listen_context||{},data:e.data||{},share_context:e.share_context||null,create_playlist:!1,changed_position:!1,is_thumbnail:e.is_thumbnail,cover_type:e.cover_type,image:e.image,excludes:e.excludes||[],private_status:e.private_status||0,zoom_on_cover:e.zoom_on_cover||!1},function(){this._setPosition(),n(this.refs["talk"===this.state.type?"scroll_description":"scroll_playlist"]).nanoScroller(),n(this.state.target).parents("figure").addClass("has-contextmenu"),this.state.opened===!1&&this.setState({opened:!0})}.bind(this)),n("body").on("click",this._close),n(".page-scroll").on("scroll",this._closeOnScroll)},_onClose:function(e){e&&this.state.context!==e||(this.setState({opened:!1,view:"home"},function(){window.setTimeout(function(){this.state.opened===!1&&n(this.refs.context_menu).css({left:"",top:""}).hide()}.bind(this),150)}.bind(this)),n("body").off("click",this._close),n(".page-scroll").off("scroll",this._closeOnScroll),setTimeout(function(){n(this.state.target).removeClass("has-contextmenu"),n(this.state.target).parents("figure").removeClass("has-contextmenu")}.bind(this),200))},_onOpenPlaylistAssistant:function(){p.open("/lightbox/playlist_assistant?type=create&sng_id="+this.state.id.join("|"))},_onPersonalSongDeleted:function(e,t){e===!0&&userData.removePlaylistSong(window.USER.USER_ID,t.sng_list)},_getPlaylistList:function(){for(var e=userData.data.PLAYLISTS.data.slice(0),t=0,s=userData.data.FAVORITES_PLAYLISTS.data.length;s>t;t++)2===Number(userData.data.FAVORITES_PLAYLISTS.data[t].STATUS)&&e.push(userData.data.FAVORITES_PLAYLISTS.data[t]);return this.sort(e,"DATE_UPDATE")},_getFeatureList:function(){return{play_radio:{icon:"play",wording:l("Lancer le mix")},play_next:{icon:"play-next",wording:l("couter juste aprs")},add_to_queue:{icon:"qlist-add",wording:l("Ajouter  la file d'attente")},add_to_library:{icon:"love",wording:button_multi_state.getWording({type:this.state.type,action:"favorite"},"add","full")},add_to_playlist:{icon:"playlist-add",wording:l("Ajouter  une playlist")+"..."},go_to_lyrics:{icon:"lyrics",wording:l("couter avec les paroles")},share:{icon:"share",wording:l("Partager")},edit_mp3:{icon:"edit",wording:l("Modifier")},edit_tags:{icon:"edit",wording:"Edit tags"},remove_from_queue:{icon:"trash",wording:l("Retirer de la file d'attente")},push_to_mobile:{icon:"phone",wording:l("couter sur mobile")},remove_from_library:{icon:"cancel",wording:button_multi_state.getWording({type:this.state.type,action:"favorite"},"hover","full")},delete_track:{icon:"trash",wording:l("Retirer de la playlist")},delete_mp3:{icon:"trash",wording:l("Retirer de mes MP3")},zoom_on_cover:{icon:"resize-up",wording:l("Zoomer sur la pochette")},promote_album:{wording:l("Mettre en avant")},change_genre:{wording:l("Changer les genres")},go_to_playlist:{link:!0,icon:"arrow-right",wording:l("Page playlist")},go_to_user:{link:!0,icon:"arrow-right",wording:l("Profil utilisateur")},go_to_show:{link:!0,icon:"arrow-right",wording:l("Page show")},edit_profile:{wording:l("Modifier mes informations")},modify_avatar:{wording:l("Modifier mon avatar")},delete_avatar:{wording:l("Supprimer mon avatar")},modify_image:{wording:l("Modifier l'image")},delete_image:{wording:l("Supprimer l'image")},message_user:{wording:l("Message")},block_user:{wording:l("Bloquer")},unblock_user:{wording:l("Dbloquer")}}},_isAvailableFeature:function(e){var t={},s=userData.isFavorite(this.state.type,this._getElementId()),a=dzPlayer.isRadio()||"feed_user_radio"===this.state.context,i=gatekeeper.isAllowed("curator_feature")&&USER.SETTING.curator.push_album_limit&&Number(USER.SETTING.curator.push_album_limit)>0;if("song"===this.state.type){var r=1===this.state.id.length,o="undefined"!=typeof this.state.data.SONG&&"undefined"!=typeof this.state.data.SONG.LYRICS_ID&&0!==this.state.data.SONG.LYRICS_ID;t={play_next:!a,add_to_queue:!a,add_to_playlist:!0,add_to_library:r&&!s,remove_from_library:r&&s,share:r&&this._getElementId()>0&&(0===this.state.private_status||2===this.state.private_status),go_to_lyrics:r&&this._getElementId()>0&&o,push_to_mobile:this.state.is_thumbnail&&!USER.DEVICES_COUNT,edit_tags:gatekeeper.isAllowed("employee_feature"),queuelist:{remove_from_queue:r&&dzPlayer.getTrackList().length>1&&!a},playlist:{delete_track:this.state.data.PLAYLIST_PERSONNAL},player:{go_to_playlist:"playlist"===LOG_CONTEXT[dzPlayer.getContext("TYPE")]&&r&&this._getElementId()>0},personal_song:{edit_mp3:r,delete_mp3:!0,edit_tags:!1},lovedpersonal:{remove_from_library:!0}}}else if("album"===this.state.type)t={play_next:!a,add_to_queue:!a,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status,promote_album:!1,change_genre:!1,edit_tags:gatekeeper.isAllowed("employee_feature")},this.state.is_thumbnail&&(t=n.extend(t,{promote_album:i,change_genre:gatekeeper.isAllowed("employee_feature"),push_to_mobile:!USER.DEVICES_COUNT,zoom_on_cover:this.state.zoom_on_cover}));else if("artist"===this.state.type)t={play_radio:!0,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status,edit_tags:gatekeeper.isAllowed("employee_feature")};else if("radio"===this.state.type)t={play_radio:!0,add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status};else if("playlist"===this.state.type){if(t={play_next:!a,add_to_queue:!a,add_to_library:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID&&!s,remove_from_library:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID&&s,push_to_mobile:(0===this.state.private_status||2===this.state.private_status)&&!USER.DEVICES_COUNT,share:0===this.state.private_status||2===this.state.private_status,go_to_user:Number(this.state.data.PARENT_USER_ID)!==USER.USER_ID},this.state.is_thumbnail){var l="undefined"!=typeof playlist.data&&"undefined"!=typeof playlist.data.PLAYLIST_PICTURE;t=n.extend(t,{modify_image:l&&Number(this.state.data.PARENT_USER_ID)===USER.USER_ID,delete_image:l&&""!==playlist.data.PLAYLIST_PICTURE&&Number(this.state.data.PARENT_USER_ID)===USER.USER_ID})}}else"app"===this.state.type?t={add_to_library:!userData.isFavorite("application",this._getElementId()),remove_from_library:userData.isFavorite("application",this._getElementId())}:"user"===this.state.type?t={edit_profile:null!==profile.data&&profile.data.DATA.IS_PERSONNAL,modify_avatar:null!==profile.data&&profile.data.DATA.IS_PERSONNAL,delete_avatar:null!==profile.data&&profile.data.DATA.IS_PERSONNAL&&""!==profile.data.DATA.USER.USER_PICTURE,block_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL&&!this.state.blocked,unblock_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL&&this.state.blocked,message_user:null!==profile.data&&!profile.data.DATA.IS_PERSONNAL}:"show"===this.state.type?t={add_to_library:!s,remove_from_library:s,share:0===this.state.private_status||2===this.state.private_status}:"episode"===this.state.type&&(t={share:0===this.state.private_status||2===this.state.private_status,go_to_show:"talkShow"!==this.state.context});for(var c=0;c<this.state.excludes.length;c++)if(this.state.excludes[c]===e)return!1;return"object"==typeof t[this.state.context]&&"boolean"==typeof t[this.state.context][e]?t[this.state.context][e]:"boolean"==typeof t[e]?t[e]:!1},_setPosition:function(){var e={top:0,left:0},t=n(this.refs.context_menu),s=n(this.state.target),a=10,i=30,r=t[0].offsetWidth,o=t[0].offsetHeight,l=n.extend({},s.offset(),{width:s[0].offsetWidth,height:s[0].offsetHeight});"right"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-o/2):"right-top"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-o+i):"right-bottom"===this.state.position?(e.left=l.left+l.width+a,e.top=l.top+l.height/2-i):"left"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-o/2):"left-top"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-o+i):"left-bottom"===this.state.position?(e.left=l.left-r-a,e.top=l.top+l.height/2-i):"bottom"===this.state.position?(e.left=l.left+l.width/2-r/2,e.top=l.top+l.height+a):"top"===this.state.position?(e.left=l.left+l.width/2-r/2,e.top=l.top-o-a):"object"==typeof this.state.position&&(e=this.state.position);var c=e.top<0,p=e.top+o>n(window).height(),d=r+e.left-n(window).width()>0;if((c||p||d)&&!this.state.changed_position){if("left"===this.state.position||"right"===this.state.position||"bottom"===this.state.position){var u={left:{isOverTop:"left-bottom",isOverBottom:"left-top",isOverRight:"left"},right:{isOverTop:"right-bottom",isOverBottom:"right-top",isOverRight:"left"},bottom:{isOverTop:"bottom",isOverBottom:"top",isOverRight:"left-bottom"},top:{isOverTop:"top",isOverBottom:"bottom",isOverRight:"left-top"}};if(u[this.state.position]){var h=this.state.position;c?h=u[this.state.position].isOverTop:p&&(h=u[this.state.position].isOverBottom),d&&(h=u[h]?u[h].isOverRight:u[this.state.position].isOverRight),this.setState({position:h,changed_position:!0},function(){this._setPosition()}.bind(this))}return!1}"object"==typeof this.state.position&&(e.top-=e.top+o-n(window).height())}t.css(e)},_getArtistName:function(e){return e.ARTISTS?e.ARTISTS.map(function(e,t){return 0===Number(e.ROLE_ID)||5===Number(e.ROLE_ID)?[t>0?", ":"",i.createElement("a",{className:"evt-click",href:"/artist/"+e.ART_ID},e.ART_NAME)]:void 0}):i.createElement("a",{className:"evt-click",href:"/artist/"+e.ART_ID},e.ART_NAME)},_getSongIdList:function(){for(var e=[],t=0;t<this.state.id.length;t++)e.push([this.state.id[t],this.state.id[t]>0?0:1]);return e},_getElementId:function(){return this.state.id[0]},_action:function(e){var t=e;if("object"==typeof t.currentTarget&&(t=dom.dataset(t.currentTarget)),"string"!=typeof t.type)return void e.preventDefault();var s=!0;switch(t.type){case"play_next":case"play_radio":case"add_to_queue":"queue_list"===this.state.context&&"play"===t.type?dzPlayer.playTrackAtIndex(this.state.data.INDEX):(dzPlayer.play({type:"song"===this.state.type?"track":this.state.type,id:"song"===this.state.type?this.state.id:this._getElementId(),radio:"play_radio"===t.type,addNext:"play_next"===t.type,addQueue:"add_to_queue"===t.type,context:this.state.listen_context}),"artist"===this.state.type&&"play_radio"===t.type&&loadBox("/artist/"+this._getElementId())),("play_next"===t.type||"add_to_queue"===t.type)&&this.tracking("context_menu_click",e.currentTarget);break;case"remove_from_queue":dzPlayer.removeTracks(this.state.data.INDEX);break;case"add_to_library":case"remove_from_library":for(var a=this.state.id,i=0;i<a.length;i++){var r={id:a[i],type:"app"===this.state.type?"application":this.state.type,context:this.state.context};userData.isFavorite(r.type,r.id)?d.remove(r):d.add(r)}break;case"add_to_playlist":this._toggleView(),s=!1;break;case"add_track_to_playlist":userData.addPlaylistSong(t.id,this._getSongIdList(),{context:this.state.context,position:t.position});break;case"share":sharebox.load(this.state.type,this._getElementId(),this.state.share_context);break;case"go_to_lyrics":if("queue_list"===this.props.context)Events.subscribeOnce(Events.player.displayCurrentSong,function(){Events.trigger(Events.menu.togglePanel,"lyrics")}),dzPlayer.playTrackAtIndex(this.state.data.INDEX);else{Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong(),Events.trigger(Events.menu.togglePanel,"lyrics")});var o={type:"track",id:this.state.id,radio:!1,context:this.state.listen_context};"radio"!==dzPlayer.getPlayerType()&&(o.addNext=!0),dzPlayer.play(o)}break;case"go_to_playlist":loadBox("/playlist/"+("playlist"===this.state.type?this._getElementId():this.state.data.PLAYLIST_ID));break;case"go_to_user":"user"===this.state.type?loadBox("/profile/"+this.getElementId()):loadBox("/profile/"+("show"===this.state.type?this.state.data.SHOW_ID:this.state.data.PARENT_USER_ID));break;case"go_to_show":loadBox("/show/"+this.state.data.SHOW_ID);break;case"delete_track":var l=this._getSongIdList();api.call({method:"playlist.deleteSongs",data:{playlist_id:this.state.data.PLAYLIST_ID,songs:l},success:function(e){if(e===!0){userData.removePlaylistSong(this.state.data.PLAYLIST_ID,l);for(var t=0,s=l.length;s>t;t++){var a="object"==typeof l[t]?Number(l[t][0]):Number(l[t]);"loved"===this.state.type&&userData.isFavorite("song",a)&&userData.deleteFavorite({type:"song",id:a})}}}.bind(this)});break;case"delete_mp3":for(var c,u=0;u<this.state.id.length;u++)c={upload_id:this.state.id[u]},api.call("personal_song.delete",c,this._onPersonalSongDeleted,{sng_list:this.state.id[u]});break;case"edit_mp3":p.open("/lightbox/edit_personal_song.php?sng_id="+this._getElementId());break;case"edit_tags":p.open("/lightbox/curators/edit_tag/"+this.state.type+"/"+this._getElementId());break;case"promote_album":p.open("/lightbox/curators/push_album/"+this._getElementId());break;case"change_genre":p.open("/lightbox/curators/update_genre/"+this._getElementId());break;case"edit_profile":loadBox("/account");break;case"modify_avatar":n("#profile_avatar_upload").trigger("click");break;case"modify_image":n("#naboo_playlist_image_upload").trigger("click");break;case"message_user":p.open("/lightbox/instant_messenger.php?friend_id="+this._getElementId());break;case"block_user":user.block(null,this._getElementId());break;case"unblock_user":user.unblock(null,this._getElementId());break;case"zoom_on_cover":p.open("/lightbox/picture_zoom.php?type="+this.state.cover_type+"&md5="+this.state.image);break;case"push_to_mobile":if(USER.DEVICES_COUNT>0)break;p.open("/lightbox/push_mobile?context=ticker&type="+this.state.cover_type+"&id="+this.state.image)}s===!0&&Events.trigger(Events.menu.contextMenuClose)},_toggleView:function(){this.setState({view:"home"===this.state.view?"playlist":"home"},function(){"song"===this.state.type&&this.state.id.length>1&&(this._setPosition(),n(this.refs.scroll_playlist).nanoScroller())})},_close:function(e){return n(e.target).parents("#page_context_menu").length?!0:(e.stopPropagation(),e.preventDefault(),void Events.trigger(Events.menu.contextMenuClose))},_closeOnScroll:function(){this.state.opened&&Events.trigger(Events.menu.contextMenuClose)}});t.exports=_},{"../../core/favorite":241,"../../core/i18n":243,"../../core/modal":245,"../_mixins/sort":42,"../_mixins/tracking":44,"./Thumbnail":129,"babel-runtime/core-js/object/keys":285,classnames:"classnames",jquery:"jquery",react:"react"}],241:[function(e,t,s){"use strict";var a=e("jquery"),i=e("./i18n"),r=i.gettext,n={init:function(){Events.subscribe(Events.user.addFavorite,n.onChangeStatus,"favorite"),Events.subscribe(Events.user.deleteFavorite,n.onChangeStatus,"favorite")},action:function(e,t){try{return 0==USER.USER_ID?(www.goToConnection(),!1):(Events.ready(Events.user.userReady,function(){userData.isFavorite(t.type,t.id)?n.remove(t,e):n.add(t,e)}),!0)}catch(s){error.log(s)}},add:function(e,t){try{if(0===USER.USER_ID)return www.goToConnection(),!1;if(t=t||null,userData.isFavorite(e.type,e.id))return!1;var s={type:e.type,id:e.id,context:e.context||"",additionnal_actions:"undefined"!=typeof e.additionnal_actions?e.additionnal_actions:null};switch(e.type){case"artist":api.call("artist.getData",{ART_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"artist.addFavorite",{art_id:e.id},s)});break;case"radio":api.call("radio.getData",{RADIO_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),n.addCallback(t,"radio.addFavorite",{radio_id:e.id},s)});break;case"album":api.call("album.getData",{ALB_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),n.addCallback(t,"album.addFavorite",{ALB_ID:e.id},s)});break;case"show":api.call("show.getData",{SHOW_ID:e.id,COUNTRY:COUNTRY},function(i){a.extend(s,i),api.call("episode.getListByShow",{SHOW_ID:e.id,COUNTRY:COUNTRY},function(a){s.LATEST_EPISODE=a,n.addCallback(t,"show.addFavorite",{SHOW_ID:e.id},s)})});break;case"application":api.call("application.getPublicData",{APP_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"application.addFavorite",{APP_ID:e.id},s)});break;case"playlist":api.call("playlist.getData",{PLAYLIST_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"playlist.addFavorite",{parent_playlist_id:e.id,title:s.TITLE,parent_user_id:s.PARENT_USER_ID,parent_username:s.PARENT_USERNAME},s)});break;case"song":api.call("song.getData",{SNG_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_song.add",{SNG_ID:e.id},s)});break;case"disliked_song":api.call("song.getData",{SNG_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_dislike.add",{SNG_ID:e.id},s)});break;case"friend":api.call("user.getData",{USER_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"friend.follow",{friend_id:e.id},s)});break;case"genre":api.call("genre_getData",{GENRE_ID:e.id},function(i){a.extend(s,i),n.addCallback(t,"favorite_genre.add",{GENRE_ID:e.id},s)});break;default:return!1}return"undefined"!=typeof window.dataLayer&&window.dataLayer.push({event:"favorite.add="+e.id}),!0}catch(i){error.log(i)}},addCallback:function(e,t,s,a){try{var i=[{method:t,data:s,success:function(t){if(t===!1){switch(a.type){case"playlist":alert(r("Impossible d'ajouter cette playlist  votre musique prfre. Vous avez atteint le nombre maximum de playlists ajoutes."));break;case"album":alert(r("Impossible d'ajouter cet album  votre musique prfre. Vous avez atteint le nombre maximum d'albums ajouts."));break;case"artist":alert(r("Impossible d'ajouter cet artiste  vos favoris. Vous avez atteint le nombre maximum d'artistes favoris."));break;case"radio":alert(r("Impossible d'ajouter ce mix  votre musique prfre. Vous avez atteint le nombre maximum de mix ajouts."))}return!1}null!=e&&(e.is("a")?n.setRemoveState(e,a):e.is("button")&&e.data("cancel_hover",!0)),userData.addFavorite(a),"song"==a.type&&n.remove({type:"disliked_song",id:a.SNG_ID}),"disliked_song"==a.type&&n.remove({type:"song",id:a.SNG_ID})}}];return null!==a.additionnal_actions&&(i=i.concat(a.additionnal_actions)),api.call(i),!0}catch(o){error.log(o)}},remove:function(e,t){try{if(!userData.isFavorite(e.type,e.id))return!1;t=t||null;var s,a;switch(e.type){case"artist":s="artist.deleteFavorite",a={art_id:e.id};break;case"radio":s="radio.deleteFavorite",a={radio_id:e.id};break;case"album":s="album.deleteFavorite",a={ALB_ID:e.id};break;case"show":s="show.deleteFavorite",a={SHOW_ID:e.id};break;case"playlist":s="playlist.deleteFavorite",a={playlist_id:e.id};break;case"application":s="application.deleteFavorite",a={APP_ID:e.id};break;case"song":s="favorite_song.remove",a={SNG_ID:e.id};break;case"disliked_song":s="favorite_dislike.remove",a={SNG_ID:e.id};break;case"friend":s="friend.unfollow",a={FRIEND_ID:e.id};break;case"genre":s="favorite_genre.remove",a={GENRE_ID:e.id};break;default:return!1}"undefined"!=typeof e.additionnal_actions&&api.call(e.additionnal_actions),api.call(s,a,function(s){s===!0&&(null!=t&&t.is("a")&&n.setAddState(t,e),userData.deleteFavorite(e))})}catch(i){error.log(i)}},drawButton:function(e,t){try{if(0===USER.USER_ID)n.setAddState(e,t);else{var s,a=e.data();Events.ready(Events.user.userReady,function(){userData.isFavorite(t.type,t.id)?(s="click_item",n.setRemoveState(e,t)):(s="add_to_favorite",n.setAddState(e,t)),"feed"===a.tracking&&(a.trackingTag=s)})}}catch(i){error.log(i)}},setAddState:function(e,t){try{if(e.data({favorite:1,type:t.type,id:t.id}).addClass("evt-click").removeClass("selected"),1===a(".label",e).length){var s=button_multi_state.getWording(a.extend({action:"favorite"},t),"add","full");a(".label",e).text(s)}return!0}catch(i){error.log(i)}},setRemoveState:function(e,t){try{if(e.data({favorite:1,type:t.type,id:t.id}).addClass("selected evt-click"),1===a(".label",e).length){var s=button_multi_state.getWording(a.extend({action:"favorite"},t),"hover","full");a(".label",e).text(s)}return!0}catch(i){error.log(i)}},display:function(){},onChangeStatus:function(e,t){try{var s=a('body button[data-favorite="1"][data-type="'+t.type+'"][data-id="'+t.id+'"]');s.each(function(){a(this).replaceWith(button_multi_state.draw(a(this).data()))});var i=a('.thumbnail .options[data-type="'+t.type+'"][data-id="'+t.id+'"] .options-favorite');return i.each(function(){var s=a(this).find(".icon-love"),i="USER.addFavorite"===e.namespace?"addClass":"removeClass";s[i]("active");var n=r("USER.addFavorite"===e.namespace?"Retirer de Ma musique":"Ajouter  Ma musique");"song"===t.type&&(n=r("USER.addFavorite"===e.namespace?"Retirer des Coups de cur":"Ajouter aux Coups de cur")),s.attr("title",n)}),!0}catch(n){error.log(n)}}};t.exports=n},{"./i18n":243,jquery:"jquery"}],44:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r={contextTypes:{getTrackingParams:a.PropTypes.func},tags:{player_click:["type"],context_menu_click:["type","instance"],panel_click:["panel","type","id","index","instance"],menu_click:["type"],onboarding_feed_close_click:["context"],lyrics:["ts","action","container","sng","type"],artist_page_click:["type"],discography_click:["type","position","sort","view"]},platform:{lyrics:"deezer_log"},tracking:function(e){function t(t,s){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){if("object"!=typeof this.tags[e])return!1;var s="function"==typeof this.getTrackingParams?this.getTrackingParams():{};"function"==typeof this.context.getTrackingParams&&i.extend(s,this.context.getTrackingParams());var a={};"object"==typeof t&&(a=dom.dataset(t));for(var r=0;r<this.tags[e].length;r++){var n=this.tags[e][r];"ts"!==n?"undefined"!=typeof a[n]&&null!==a[n]&&(s[n]=a[n]):s[n]=SERVER_TIMESTAMP}var o="";return"string"==typeof a.trackingCallback&&(o=this[a.trackingCallback]||""),"string"==typeof this.platform[e]&&"deezer_log"===this.platform[e]?(api.call({method:"log_central.log",data:{BATCH:[{channel:e,params:s}]}}),!0):void tracking.track(e,s,o)})};t.exports=r},{jquery:"jquery",react:"react"}],42:[function(e,t,s){"use strict";var a={sortByUpdateDate:function(e,t){var s=e.DATE_ADD||"0000-00-00 00:00:00",a=t.DATE_ADD||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByCreateDate:function(e,t){var s=e.DATE_FAVORITE||e.DATE_CREATE||"0000-00-00 00:00:00",a=t.DATE_FAVORITE||t.DATE_CREATE||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByDigitalReleaseDate:function(e,t){var s=e.DIGITAL_RELEASE_DATE||"0000-00-00 00:00:00",a=t.DIGITAL_RELEASE_DATE||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},sortByArtName:function(e,t,s){s="boolean"==typeof s?s:!1;var a=e.ART_NAME.toLowerCase().trim(),i=t.ART_NAME.toLowerCase().trim();return a===i?s?0:this.sortByAlbTitle(e,t,!0):a>i?1:-1},sortByAlbTitle:function(e,t,s){s="boolean"==typeof s?s:!1;var a=e.ALB_TITLE.toLowerCase().trim(),i=t.ALB_TITLE.toLowerCase().trim();return a===i?s?0:this.sortByArtName(e,t,!0):a>i?1:-1},sortByAppName:function(e,t){var s=e.NAME.toLowerCase().trim(),a=t.NAME.toLowerCase().trim();return s===a?0:s>a?1:-1},sortByPlaylistTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},sortByPlaylistType:function(e,t){var s=e.PARENT_USER_ID==USER.USER_ID?0:parseInt(e.STATUS,10)+1,a=t.PARENT_USER_ID==USER.USER_ID?0:parseInt(t.STATUS,10)+1,i=e.TITLE.toLowerCase(),r=t.TITLE.toLowerCase();return s===a?i===r?0:i>r?1:-1:s>a?1:-1},sortByAlbRank:function(e,t){var s=Number(e.RANK),a=Number(t.RANK);return s===a?this.sortByAlbTitle(e,t):a>s?1:-1},sortByAlbType:function(e,t){var s=Number(e.ROLE_ID),a=Number(t.ROLE_ID),i=this._getOrderAlbumType(e.TYPE),r=this._getOrderAlbumType(t.TYPE),n=Number(e.HIGHLIGHT),o=Number(t.HIGHLIGHT);return s===a?i===r?n===o?this.sortByDigitalReleaseDate(e,t):n>o?1:-1:i>r?1:-1:s>a?1:-1},sortByTopAlbum:function(e,t){var s=userData.data.TOP_ALBUMS_HASH,a="undefined"!=typeof s[e.ALB_ID]?1/(s[e.ALB_ID]+1):0,i="undefined"!=typeof s[t.ALB_ID]?1/(s[t.ALB_ID]+1):0;return a===i?this.sortByAlbTitle(e,t):i>a?1:-1},sortByTopPlaylist:function(e,t){var s=userData.data.TOP_PLAYLISTS_HASH,a="undefined"!=typeof s[e.PLAYLIST_ID]?1/(s[e.PLAYLIST_ID]+1):0,i="undefined"!=typeof s[t.PLAYLIST_ID]?1/(s[t.PLAYLIST_ID]+1):0;return a===i?this.sortByPlaylistTitle(e,t):i>a?1:-1},sortByShowName:function(e,t){var s=e.SHOW_NAME.toLowerCase().trim(),a=t.SHOW_NAME.toLowerCase().trim();return s===a?0:s>a?1:-1},sort:function i(e,t){e=e.slice(0);var s={ART_NAME:this.sortByArtName,ALB_TITLE:this.sortByAlbTitle,DATE_UPDATE:this.sortByUpdateDate,DATE_CREATE:this.sortByCreateDate,PLAYLIST_TITLE:this.sortByPlaylistTitle,PLAYLIST_TYPE:this.sortByPlaylistType,APP_NAME:this.sortByAppName,TOP_ALBUM:this.sortByTopAlbum,TOP_PLAYLIST:this.sortByTopPlaylist,SHOW_NAME:this.sortByShowName,DATE_FAVORITE:this.sortByCreateDate,DIGITAL_RELEASE_DATE:this.sortByDigitalReleaseDate,ALB_RANK:this.sortByAlbRank,ALB_TYPE:this.sortByAlbType};if("function"==typeof s[t]){var i=e.sort(s[t]);return i}return e},_getOrderAlbumType:function(e){var t={1:0,0:2,3:1,2:3};return t[Number(e)]}};t.exports=a},{}],245:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("jquery"),n=e("./util"),o=e("../components/modal/sharebox/Render"),l=e("../components/modal/playlist_assistant/Render"),c=e("../components/modal/curator/tagging/Render"),p=e("../components/modal/curator/playlist/EditTag"),d=e("../components/modal/curator/playlist/EditTop"),u={ShareBox:o,CuratorTagging:c,PlaylistAssistant:l,CuratorEditPlaylistTag:p,CuratorEditPlaylistTop:d},h={$element:null,$container:null,$overlay:null,opened:!1,ready:!1,react_elem:null,transition:150,init:function(){try{h.$element=r(".modal"),h.$container=r(".modal-wrapper",h.$element),h.$overlay=r(".modal-backdrop",h.$element),h.$element.on("click",function(e){var t=r(e.target);("modal"===t.attr("id")||"modal-wrapper"===t.attr("class"))&&h.close()}),Events.subscribe(Events.navigation.modal_open,function(e,t){var s=document.getElementById("modal_"+t.div);if(s){h.setReactElement(t.div);var r=a.createFactory(u[t.modal_type]);i.render(r(t),s)}}),Events.subscribe(Events.navigation.modal_close,h.close),h.ready=!0}catch(e){error.log(e)}},open:function(e,t,s){try{h.ready!==!0&&h.init(),"/"!==e.charAt(0)&&"http"!==e.substr(0,4)&&(error.log({message:"path not valid",description:"modal.open: / is missing in your path "+e}),e="/"+e),"function"==typeof r.facebox&&r.facebox.close(),"undefined"==typeof t&&(t=!1);var a="GET";if("undefined"!=typeof arguments[2]&&r.isPlainObject(arguments[2])&&(s=arguments[2],a="POST"),h.opened===!0&&t===!1)return!1;h.requesting===!0&&(h.lastRequest.abort(),h.requesting=!1);var i=n.uniqid();return"undefined"!=typeof window.dataLayer&&window.dataLayer.push({event:"modal.open="+e}),LAYOUT.is_standalone||"web"!==PLATFORM?window.location=e:(h.requesting=!0,"GET"===a?h.lastRequest=r.get(e,OFFLINE?{}:{modal:"1"}).done(function(t){h.doneCallback(t,e)}).always(h.alwaysCallback):(e+=(-1===e.indexOf("?")?"?":"&")+"modal=1",h.lastRequest=r.post(e,s).done(function(t){h.doneCallback(t,e)}).always(h.alwaysCallback))),h.$element.data("uniqid",i),i}catch(o){error.log(o)}},close:function(){try{return h.ready!==!0&&h.init(),h.opened===!1&&"web"===PLATFORM?!1:(h.opened=!1,h.$element.removeClass("opened"),window.setTimeout(function(){h.react_elem?i.unmountComponentAtNode(document.getElementById("modal_"+h.react_elem)):h.$container.html(""),h.react_elem=null,h.bindBackButton(!1),h.$element.hide()},h.transition),Events.trigger(Events.modal.close,h.$element.data("uniqid")),!0)}catch(e){error.log(e)}},doneCallback:function(e,t){h.opened=!0,h.$container.html(e),h.$element.show(),h.bindBackButton(!0),window.setTimeout(function(){h.$element.addClass("opened")},0),Events.trigger(Events.navigation.modal_displayed,{modal:t})},alwaysCallback:function(){h.requesting=!1},setReactElement:function(e){h.react_elem=String(e||"")},bindBackButton:function(e){e=Boolean(e),r(document).on("keydown",function(t){e&&8===t.which&&!r(t.target).is("input, textarea")&&t.preventDefault()})}};t.exports=h},{"../components/modal/curator/playlist/EditTag":167,"../components/modal/curator/playlist/EditTop":168,"../components/modal/curator/tagging/Render":169,"../components/modal/playlist_assistant/Render":170,"../components/modal/sharebox/Render":174,"./util":248,jquery:"jquery",react:"react","react-dom":"react-dom"}],248:[function(e,t,s){"use strict";var a=e("jquery"),i={findPos:function(e){var t=0,s=0;if(e&&e.offsetParent)do t+=e.offsetLeft,s+=e.offsetTop,e=e.offsetParent;while(e);return[t,s]},getPageScroll:function(){var e,t;return self.pageYOffset?(t=self.pageYOffset,e=self.pageXOffset):document.documentElement&&document.documentElement.scrollTop?(t=document.documentElement.scrollTop,e=document.documentElement.scrollLeft):document.body&&(t=document.body.scrollTop,e=document.body.scrollLeft),[e,t]},findPosRelativeToViewport:function(e){var t=this.findPos(e),s=this.getPageScroll();return[t[0]-s[0],t[1]-s[1]]},range:function r(e,t){var r=t-e+1;return Math.floor(Math.random()*r+e)},getOuterHTML:function(e){var t=e.attr("outerHTML");if("undefined"==typeof t){var s=a("<p></p>");s.append(e.clone()),t=s.html(),s.remove()}return t},uniqid:function(e){var t;"undefined"==typeof e&&(e=7),e=Math.max(7,Math.floor(e));var s=function(e,t){return e=parseInt(e,10).toString(16),t<e.length?e.slice(e.length-t):t>e.length?Array(1+(t-e.length)).join("0")+e:e};return this.php_js||(this.php_js={}),this.php_js.uniqidSeed||(this.php_js.uniqidSeed=Math.floor(123456789*Math.random())),this.php_js.uniqidSeed+=3,t=s(parseInt((new Date).getTime()/1e3,10),10),t+=s(this.php_js.uniqidSeed,7)},detectFlash:function(e,t){var s,a,i,r,n="not_installed",o="blocking",l="too_old";if(document.hasFocus()===!1){var c=function h(){window.removeEventListener("focus",h),window.util.detectFlash(e,t)};return void window.addEventListener("focus",c)}if(i="ActiveXObject"in window&&"Pan"in new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash"),a="plugins"in window.navigator&&"Shockwave Flash"in window.navigator.plugins||i,!a)return void t(n);if(!e||!("Pan"in e)&&!i)return void t(o);var p=e.style.cssText,d=document.documentElement,u=function(){d.contains(e)?e.style.cssText!==p&&(r=o):r=o,r||(s=deconcept.SWFObjectUtil.getPlayerVersion(),s=parseFloat(s.major+"."+s.minor),(!s||s<dzPlayer.minimumFlashVersion)&&(r=l)),t(r,s)};setTimeout(u,10)}};t.exports=i},{jquery:"jquery"}],174:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../core/i18n"),n=r.gettext,o=e("./_elements/NavTab"),l=e("./_elements/FriendsView"),c=e("./_elements/SocialButton"),p=e("./_elements/ShareButton"),d=e("../../common/Thumbnail"),u=a.createClass({displayName:"ShareBox",propTypes:{id:a.PropTypes.number.isRequired,type:a.PropTypes.number.isRequired,data:a.PropTypes.object.isRequired,options:a.PropTypes.object},getDefaultProps:function(){return{id:null,type:null,data:{},options:{}}},getInitialState:function(){return{tabs:!1,context:"all",message:"",selected:[],friends:[],display:this._getFriendsMaxDisplay()}},componentWillMount:function(){this._setCurrentRefKey(),this._setClipboardUrl()},componentDidMount:function(){this._setTabsDisplay(),this._renderGGPlus(),this._resizeView()},render:function(){if(!this._getCurrentRefKey())return null;var e=this._getTitle(),t=null,s=null,r={type:this._getCurrentRefKey(),md5:this._getPictureMd5(),picture_type:this._getPictureType()};"sradio"===r.type&&(r.type="artist");var c=i({"share-message":!0,"form-control":!0,"form-control-block":!0,open:Boolean(this.state.message)});return this.props.data.SUBTITLE&&(t=a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},n("par")+" "+this.props.data.SUBTITLE)),this._checkOption("standalone")||(s=a.createElement("div",{className:"share-action"},a.createElement("button",{ref:"copyToClipboard",className:"btn btn-default",type:"button",onMouseEnter:this._instantiateZC},a.createElement("span",{className:"label"},n("Copier l'URL Deezer"))),this._checkOption("embed")?a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onEmbedClick},a.createElement("span",{className:"icon icon-embed"})):null)),a.createElement("div",null,a.createElement("div",{className:"modal-header"},e),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"share-content share-infos"},a.createElement("div",{className:"share-thumbnail"},a.createElement(d,{id:Number(this.props.id),type:r.type,md5:r.md5,overlay:!1,picture_type:r.picture_type,multi_cover:!0,height:120,width:120})),a.createElement("div",{className:"share-thumbnail-infos"},a.createElement("div",{className:"heading-2 ellipsis",id:"share-title"},this.props.data.TITLE),t,s)),a.createElement("div",{className:"share-nav clearfix"},this.state.tabs?this._getTabs().map(function(e,t){return a.createElement(o,{key:e.type+"_"+t,type:e.type,text:e.text,context:this.state.context,switchCurrentTab:this._switchCurrentTab})}.bind(this)):null),a.createElement("div",{className:"share-content share-followers"},this.state.tabs?a.createElement(l,{friends:this.state.friends,display:this.state.display,visible:"friends"===this.state.context,selected:this.state.selected,max:this._getSelectedMaxDisplay(),standalone:this._checkOption("standalone"),removeLastFriend:this._removeLastFriend,displayMoreFriends:this._displayMoreFriends,updateFriendsList:this._updateFriendsList,toggleFriend:this._toggleFriend}):null,a.createElement("textarea",{ref:"shareMessage",maxLength:this._getShareMessageMaxLength(),placeholder:n("Ajouter un message..."),className:c,onKeyPress:this._checkMessageInput,onChange:this._updateMessage}))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},this._renderSocialButton()),a.createElement(p,{enabled:this._isShareEnabled(),shareElement:this._shareElement})))},_renderSocialButton:function(){if(!this._hasAllowedPlatforms())return null;var e=[];return this._checkOption("standalone")||e.push(a.createElement("span",{className:"btn btn-label",key:"social-buttons-label"},n("Partager aussi sur :"))),e.push(this._getPlatforms().map(function(e,t){return a.createElement(c,{key:e.name+"_"+t,platform:e.name,allowed:this._isPlatformAllowed(e.name),enabled:this._isPlatformEnabled(e.key),registered:this._isPlatformRegistered(e.name),togglePlatformBtn:this._togglePlatformBtn.bind(this,e)})}.bind(this))),e},_renderGGPlus:function(){this._checkOption("standalone")||"undefined"==typeof gapi||window.gapi.interactivepost.render("share-btn-publish-google",{contenturl:this.props.data.URL,clientid:window.googleplus.getAppData().client_id,cookiepolicy:window.googleplus.getAppData().cookie_policy,calltoactionlabel:"LISTEN",calltoactionurl:this.props.data.URL+"?autoplay",requestvisibleactions:window.googleplus.getAppData().request_visible_actions})},_onEmbedClick:function(){var e=sharebox.idToType(this.props.type);"song"===e&&(e="tracks"),window.open(SETTING_HOST_DEVELOPERS+"/musicplugins/player?type="+encodeURIComponent(e)+"&id="+encodeURIComponent(this.props.id))},_currentRefKey:null,_shareMessageMaxLength:180,_updateMessageTimeoutFn:null,_updateMessageDelayMs:300,_friendsMaxDisplay:24,_selectedMaxDisplay:8,_resizeViewTimeoutFn:null,_resizeViewDelayMs:500,_clipboardUrl:window.SETTING_HOST_SITE,_getCurrentRefKey:function(){return this._currentRefKey},_getTitle:function(){return this._getRefKeys()[this._getCurrentRefKey()].title},_getConfirmationMessage:function(){return this._getRefKeys()[this._getCurrentRefKey()].confirmation},_getPictureMd5:function(){return this.props.data.PICTURE},_getPictureType:function(){return this.props.data.PICTURE_TYPE},_getFriendsMaxDisplay:function(){return this._friendsMaxDisplay},_getSelectedMaxDisplay:function(){return this._selectedMaxDisplay},_getShareMessageMaxLength:function(){return this._shareMessageMaxLength},_getClipboardUrl:function(){return this._clipboardUrl},_getPlatforms:function(){return[{name:"facebook",key:"facebook",fn:"login"},{name:"twitter",key:"twitter",fn:"link"},{name:"googleplus",key:"google",fn:null}]},_getTabs:function(){return[{type:"all",text:n("Tous mes followers")},{type:"friends",text:n("Choisir des followers")}]},_getRefKeys:function(){return{track:{title:n("Partager ce titre"),confirmation:n("Titre partag !"),type:0},album:{title:n("Partager cet album"),confirmation:n("Album partag !"),type:1},artist:{title:n("Partager cette page artiste"),confirmation:n("Page artiste partage !"),type:2},playlist:{title:n("Partager cette playlist"),confirmation:n("Playlist partage !"),type:3},radio:{title:n("Partager ce mix"),confirmation:n("Mix partag !"),type:4},sradio:{title:n("Partager ce mix"),confirmation:n("Mix partag !"),type:6},show:{title:n("Partager ce podcast"),confirmation:n("Podcast partag !"),type:7},episode:{title:n("Partager ce podcast"),confirmation:n("pisode partag !"),type:8}}},_getPlatformsStatus:function(){var e={};return this._getPlatforms().map(function(t){e[t.name]=Boolean(this._isPlatformAllowed(t.name)&&this._isPlatformEnabled(t.key)&&this._isPlatformRegistered(t.name))}.bind(this)),e},_switchCurrentTab:function(e){this.setState({context:e},function(){this._resizeView()}.bind(this))},_checkMessageInput:function(e){if(13===e.which)return void e.preventDefault();var t=this.refs.shareMessage.value.trim();return t.length>=this._getShareMessageMaxLength()?void e.preventDefault():void 0},_updateMessage:function(){clearTimeout(this._updateMessageTimeoutFn);var e=this.refs.shareMessage.value.trim();this.state.message.length&&e.length||this.setState({message:e}),this._updateMessageTimeoutFn=setTimeout(function(){this.setState({message:e})}.bind(this),this._updateMessageDelayMs)},_isShareEnabled:function(){return"all"===this.state.context?this.state.tabs||!this.state.tabs&&this._hasCheckedPlatforms():this.state.selected.length||!this.state.selected.length&&this._hasCheckedPlatforms()},_isPlatformAllowed:function(e){return this._checkOption("standalone")&&("googleplus"===e||"facebook"===e&&!facebook.isScopeAllowed("publish_actions"))?!1:"googleplus"!==e||this._isPlatformRegistered(e)?!0:!1},_isPlatformEnabled:function(e){var t=Boolean(USER.SETTING[e]&&USER.SETTING[e].share_share);return t&&"facebook"===e&&!facebook.isScopeAllowed("publish_actions")?!1:t},_isPlatformRegistered:function(e){var t=Boolean(countObject(USER[e.toUpperCase()]));return"facebook"===e?Boolean(facebook.isScopeAllowed("publish_actions")&&t):t},_hasCheckedPlatforms:function(){var e=this._getPlatformsStatus();for(var t in e)if(e.hasOwnProperty(t)&&e[t]===!0)return!0;return!1},_hasAllowedPlatforms:function(){var e=this._getPlatforms();return this._isPlatformAllowed(e[0].name)},_togglePlatformBtn:function(e){if(!this._isPlatformRegistered(e.name)||"facebook"===e.name&&!facebook.isScopeAllowed("publish_actions")){if("googleplus"===e.name)return;var t={type:"modal",link:"/lightbox/sharebox?type="+this.props.type+"&id="+this.props.id};return"twitter"===e.name?t=this._checkOption("standalone")?t.link+"&standalone=true":www.getCurrentPath()+"?lb="+t.link:"facebook"===e.name&&(t={redirect:t}),window[e.name.toString()][e.fn.toString()](t)}var s={};s[e.key]={share_share:!USER.SETTING[e.key].share_share},userSetting.set(s,!this._checkOption("standalone")),this.forceUpdate()},_removeLastFriend:function(){var e=this.state.selected;e.length&&(e.pop(),this.setState({selected:e}))},_toggleFriend:function(e){var t=this.state.selected.indexOf(e),s=this.state.selected;return-1===t?s.push(e):s.splice(t,1),this.setState({selected:s}),!0},_displayMoreFriends:function(){if(this.state.display!==this.state.friends.length){var e=this.state.display+this._getFriendsMaxDisplay();e>this.state.friends.length&&(e=this.state.friends.length),this.setState({display:e})}},_updateFriendsList:function(e){e.sort(function(e,t){var s=(e.FIRSTNAME||"").toLowerCase(),a=(t.FIRSTNAME||"").toLowerCase();return a>s?-1:s>a?1:0}),this.setState({friends:e})},_shareElement:function(){var e=this._getPlatformsStatus(),t="all"===this.state.context?"*":this.state.selected,s=JSON.parse(JSON.stringify(this.props.options));for(var a in e)e.hasOwnProperty(a)&&(s[a]=e[a]);var i={type:this.props.type,id:this.props.id,message:this.state.message,friend_list:t,options:s};try{api.call("share.add",i,function(){if(this._checkOption("standalone"))return sharebox.close(!0);if(Events.trigger(Events.user.shareClick,{message:this._getConfirmationMessage()}),e.googleplus===!0){var t=document.getElementById("share-btn-publish-google");null!==t&&t.click()}sharebox.close()}.bind(this))}catch(r){error.log(r)}},_setCurrentRefKey:function(){var e=this._getRefKeys();for(var t in e)e.hasOwnProperty(t)&&e[t].type===this.props.type&&(this._currentRefKey=t);return Boolean(this._currentRefKey)},_checkOption:function(e){return Boolean(this.props.options[e])},_setTabsDisplay:function(){api.call("friend.getFollower",{nb:1,user_id:USER.USER_ID},function(){this.isMounted()&&this.setState({tabs:!0})}.bind(this))},_setClipboardUrl:function(){this._checkOption("standalone")||window.clipboard.getUrl(this.props.type,this.props.id,function(e){this._clipboardUrl=e}.bind(this))},_instantiateZC:function(){window.copyToClipboard(this.refs.copyToClipboard,this._getClipboardUrl(),n("L'URL a bien t copie."))},_resizeView:function(){this._checkOption("standalone")&&(clearTimeout(this._resizeViewTimeoutFn),this._resizeViewTimeoutFn=setTimeout(function(){window.resizeTo(450,document.getElementById("modal_sharebox").offsetHeight)},this._resizeViewDelayMs))}});t.exports=u},{"../../../core/i18n":243,"../../common/Thumbnail":129,"./_elements/FriendsView":176,"./_elements/NavTab":177,"./_elements/ShareButton":179,"./_elements/SocialButton":180,classnames:"classnames",react:"react"}],180:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"SocialButton",getInitialState:function(){return{enabled:this.props.enabled}},render:function(){if(!this.props.allowed)return null;var e={btn:!0,"btn-share":!0,active:this.state.enabled&&this.props.registered};e[this.props.platform]=!0;var t=i(e);return a.createElement("button",{className:t,type:"button",onClick:this._togglePlatformBtn})},_togglePlatformBtn:function(){return this.props.registered?void this.setState({enabled:!this.state.enabled},this.props.togglePlatformBtn):this.props.togglePlatformBtn()}});t.exports=r},{classnames:"classnames",react:"react"}],179:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=a.createClass({displayName:"ShareButton",getInitialState:function(){return{shared:!1}},render:function(){var e=i({btn:!0,"btn-large":!0,"btn-primary":!0});return a.createElement("div",{className:"notice"},a.createElement("button",{className:e,disabled:!this.props.enabled||this.state.shared,onClick:this._shareElement},a.createElement("span",{className:"label"},n("Partager"))),a.createElement("button",{id:"share-btn-publish-google",className:"none"}))},_shareElement:function(){this.props.enabled&&this.setState({shared:!0},function(){this.props.shareElement()}.bind(this))}});t.exports=o},{"../../../../core/i18n":243,classnames:"classnames",react:"react"}],177:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"NavTab",render:function(){var e=i({"share-nav-tabs":!0,selected:this.props.context===this.props.type});return a.createElement("a",{className:e,onClick:this._switchCurrentTab},this.props.text)},_switchCurrentTab:function(e){e.preventDefault(),this.props.context!==this.props.type&&this.props.switchCurrentTab(this.props.type)}});t.exports=r},{classnames:"classnames",react:"react"}],176:[function(e,t,s){"use strict";var a=e("react"),i=e("react-dom"),r=e("classnames"),n=e("../../../../core/i18n"),o=n.gettext,l=e("./FriendCell"),c=e("./SelectedCell"),p=a.createClass({displayName:"FriendsView",getInitialState:function(){return{current:0,filter:"",filtered:[],loader:!0}},componentDidUpdate:function(e){this.props.visible&&this.props.visible!==e.visible&&(this.refs.inputFilterFriends.focus(),this.state.filtered.length||this.props.friends.length||!this._isGetFriendsListAllowed()||this._getFriendsList()),this.props.visible!==e.visible||this._isGetFriendsListAllowed()||this.state.filtered.length||!this.props.friends.length||this.state.filter.length||this.setState({filtered:this.props.friends})},render:function(){var e=r({"share-friends-container":!0,visible:this.props.visible}),t=parseInt(this.props.selected.length,10),s=null,i=this.props.max;if(this.props.standalone&&(i/=2),t>=parseInt(i+1,10)){var n=r({"friend-hover friends-more":!0,"cell-limit":Boolean(t-i>=10)});s=a.createElement("div",{className:"friend-thumbnail friend-removable",onClick:this._displaySelectedFriends},a.createElement("span",{className:n},"+"+(t-i>=100?99:t-i)))}return a.createElement("div",{className:e},a.createElement("form",{className:"share-friends-form",autoComplete:"off",onSubmit:this._handleSubmit},a.createElement("div",{className:"share-friends-filter form-control",id:"friends_filter"},a.createElement("div",{className:"share-friends-selected"+(t?" visible":"")},s,this._sliceSelectedFriends(this.props.selected,i).map(function(e,t){var s=this._getSelectedFriendData(e);return s?a.createElement(c,{key:"s_"+e+"_"+t,data:s,standalone:this.props.standalone,toggleFriend:this._toggleFriend}):null}.bind(this))),a.createElement("input",{id:"friends_input",type:"text",ref:"inputFilterFriends",value:this.state.filter,className:"share-friends-input form-control form-control-transparent",placeholder:o("Rechercher")+"...",onKeyUp:this._handleSearchNavigation,onChange:this._handleSearchChanged,autoComplete:"off"})),a.createElement("div",{ref:"friendsList",className:"share-friends-list",onScroll:this._displayMoreFriends},a.createElement("div",{className:"friends-loader",style:{display:this.state.loader?"block":"none"}}),this.state.filtered.slice(0,this.props.display).map(function(e,t){return a.createElement(l,{key:"f_"+e.USER_ID+"_"+t,data:e,selected:this._isFriendSelected(t),checked:this._isFriendChecked(e.USER_ID),toggleFriend:this._toggleFriend})}.bind(this)))))},_allowGetFriendsList:!0,_handleSubmit:function(e){e.preventDefault()},_handleSearchChanged:function(e){var t=e.target.value;return this.setState({current:0,filter:t,filtered:this._filterFriends(this.props.friends,t)},function(){this.refs.friendsList.scrollTop=0}.bind(this)),!0},_handleSearchNavigation:function(e){e.preventDefault();var t=e.keyCode,s=this._getNavKeys()[t],a=0,r=this.refs.friendsList,n=i.findDOMNode(this);if("undefined"!=typeof s){switch(s){case"enter":if(!this.state.filtered.length)return;return this._toggleFriend(this.state.filtered[this.state.current].USER_ID),!0;case"arrowRight":if(a=this.state.current+1,a>this.state.filtered.length-1)return;break;case"arrowLeft":if(a=this.state.current-1,0>a)return;break;case"arrowTop":a=Math.max(0,this.state.current-6);break;case"arrowBottom":a=Math.min(this.state.filtered.length-1,this.state.current+6)}this.setState({current:a},function(){var e=n.querySelector("a.selected");e&&(r.scrollTop=e.getBoundingClientRect().top-n.getBoundingClientRect().top-10)})}},_sliceSelectedFriends:function(e,t){if(e.length<=t)return e;var s=e.length-t,a=e.length-1;return(1===s||a>t&&a<e.length)&&(a=e.length),e.slice(s,a)},_removeLastFriend:function(){this.props.removeLastFriend()},_filterFriends:function(e,t){if(!t)return e;t=t.toLowerCase().trim();for(var s=[],a=-5,i=0,r=e.length;r>i;++i){var n=(e[i].BLOG_NAME||"").toLowerCase().trim(),o=(e[i].FIRSTNAME||"").toLowerCase().trim(),l=(e[i].LASTNAME||"").toLowerCase().trim(),c=n.indexOf(t)+o.indexOf(t)+l.indexOf(t)+(o+" "+l).indexOf(t)+(l+" "+o).indexOf(t);c>a&&s.push(e[i])}return s},_isFriendSelected:function(e){return Boolean(e===this.state.current)},_isFriendChecked:function(e){return Boolean(-1!==this.props.selected.indexOf(e))},_getSelectedFriendData:function(e){for(var t=this.props.friends,s=0,a=t.length;a>s;++s)if(t[s].USER_ID===e)return t[s];return null},_setGetFriendsListAllowStatus:function(e){this._allowGetFriendsList=Boolean(e)},_setFriendsDisplayShareName:function(e){if(!e.length)return e;for(var t=0,s=e.length;s>t;++t)(e[t].FIRSTNAME||"").length+(e[t].LASTNAME||"").length!==0?e[t].DISPLAY_SHARE_NAME=((e[t].FIRSTNAME||"")+" "+(e[t].LASTNAME||"")).trim():e[t].DISPLAY_SHARE_NAME=e[t].BLOG_NAME;return e},_isGetFriendsListAllowed:function(){return this._allowGetFriendsList},_getFriendsList:function(){this._setGetFriendsListAllowStatus(!1),api.call("friend.getList",{start:0,nb:2e3,user_id:USER.USER_ID},function(e){this.isMounted()&&this.setState({loader:!1},function(){e.count&&this.props.updateFriendsList(this._setFriendsDisplayShareName(e.data))})}.bind(this))},_getNavKeys:function(){return{13:"enter",37:"arrowLeft",38:"arrowTop",39:"arrowRight",40:"arrowBottom"}},_displayMoreFriends:function(){var e=this.refs.friendsList;e.scrollHeight===e.scrollTop+e.clientHeight&&this.props.displayMoreFriends();},_displaySelectedFriends:function(e){e.preventDefault()},_toggleFriend:function(e){this.props.toggleFriend(e);var t=this.refs.inputFilterFriends.value,s={filter:"",filtered:this.props.friends};t.length&&(s.current=0),this.setState(s,function(){0===s.current&&(this.refs.friendsList.scrollTop=0)}.bind(this))}});t.exports=p},{"../../../../core/i18n":243,"./FriendCell":175,"./SelectedCell":178,classnames:"classnames",react:"react","react-dom":"react-dom"}],178:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../common/Thumbnail"),n=a.createClass({displayName:"SelectedCell",componentDidMount:function(){this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID]).tipsy({gravity:"s",delayIn:10,delayOut:10,z_index:1e4})},render:function(){return a.createElement("a",{role:"button",className:"friend-thumbnail friend-removable",title:this.props.data.DISPLAY_SHARE_NAME,ref:"tipsyFriend_"+this.props.data.USER_ID,onClick:this._toggleFriend},a.createElement(r,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:22,width:22}),a.createElement("div",{className:"friend-hover"},a.createElement("span",{className:"icon icon-cancel"})))},_toggleFriend:function(e){e.preventDefault(),this.props.standalone||i(this.refs["tipsyFriend_"+this.props.data.USER_ID]).tipsy("hide"),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=n},{"../../../common/Thumbnail":129,jquery:"jquery",react:"react"}],175:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../common/Thumbnail"),n=a.createClass({displayName:"FriendsCell",render:function(){var e=i({"friend-item":!0,selected:this.props.selected}),t=i({"friend-hover":!0,check:this.props.checked});return a.createElement("a",{className:e,onClick:this._toggleFriend},a.createElement("span",{className:"friend-thumbnail"},a.createElement(r,{id:Number(this.props.data.USER_ID),md5:this.props.data.USER_PICTURE,overlay:!1,rounded:!0,type:"user",height:44,width:44}),a.createElement("span",{className:t},a.createElement("span",{className:"icon icon-add"}),a.createElement("span",{className:"icon icon-check"}),a.createElement("span",{className:"icon icon-cancel"}))),a.createElement("p",{className:"friend-infos ellipsis"},this.props.data.DISPLAY_SHARE_NAME))},_toggleFriend:function(e){e.preventDefault(),this.props.toggleFriend(this.props.data.USER_ID)}});t.exports=n},{"../../../common/Thumbnail":129,classnames:"classnames",react:"react"}],170:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../core/i18n"),n=r.gettext,o=r.ngettext,l=e("./_elements/Create"),c=e("./_elements/Remove"),p=e("./_elements/Suggest"),d=a.createClass({displayName:"PlaylistAssistant",propTypes:{type:a.PropTypes.string.isRequired,playlist_id:a.PropTypes.number,sng_id:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:null,sng_id:[],type:null,playlist_data:{},song_data:{}}},getInitialState:function(){return{creation:"create"===this.props.type,suggest:"suggest"===this.props.type,remove:!1,suggest_empty:!1,playlist_id:this.props.playlist_id,submit_disabled:!1,close_action:!1,addedTrack:0}},componentDidMount:function(){Events.trigger(Events.tips.close,"playlist_assistant"),Events.trigger(Events.navigation.context_menu_close),Events.subscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.subscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.subscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},componentWillUnmount:function(){Events.trigger(Events.tips.close,"playlist_assistant_suggest"),Events.unsubscribe(Events.playlist.assistantToggleValidation,this._toggleButtonStatus),Events.unsubscribe(Events.playlist.assistantSuggestEmpty,this._emptySuggest),Events.unsubscribe(Events.playlist.assistantAddedTrack,this._setAddedTrack)},render:function(){return a.createElement("div",{className:"modal-playlist-assistant",role:"dialog","aria-labelledby":"playlist-assistant-header"},a.createElement("div",{className:"modal-header",id:"playlist-assistant-header"},this._getTitle()),this._renderBody(),a.createElement("div",{className:"modal-footer"},this._renderCancelButton(),this._renderAddedTracks(),this._renderRemoveButton(),this._renderSubmitButton()))},_renderCancelButton:function(){return this.state.creation&&0===this.state.playlist_id||this.state.remove?a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onCancel},a.createElement("span",{className:"label"},n("Annuler"))):!1},_renderAddedTracks:function(){return this.state.creation||this.state.remove||this.state.suggest_empty?null:a.createElement("h5",{className:"heading-5 notice"},this.state.addedTrack+" ",o("titre slectionn","titres slectionns",{count:this.state.addedTrack}))},_renderSubmitButton:function(){var e=i({"btn pull-right":!0,"btn-primary":!this.state.remove,"btn-danger":this.state.remove,disabled:this.state.submit_disabled}),t=n("Termin !");if(this.state.creation&&(t=n("Crer"),this.props.playlist_id>0&&(t=n("Enregistrer"))),this.state.remove&&(t=n("Supprimer")),this.state.suggest_empty){if(!this.state.close_action)return!1;t=n("Fermer")}return a.createElement("button",{id:"modal_playlist_assistant_submit",type:"button",className:e,onClick:this._onSubmit},a.createElement("span",{className:"label"},t))},_renderRemoveButton:function(){return this.state.creation&&0!==this.props.playlist_id?a.createElement("button",{type:"button",className:"btn btn-default",onClick:this._onRemove},a.createElement("span",{className:"label"},n("Supprimer cette playlist"))):null},_renderBody:function(){return this.state.creation?a.createElement(l,{playlist_data:this.props.playlist_data,song_data:this.props.song_data,playlist_id:this.props.playlist_id,sng_id:this.props.sng_id}):this.state.remove?a.createElement(c,{playlist_data:this.props.playlist_data,playlist_id:this.props.playlist_id}):a.createElement(p,{playlist_id:this.state.playlist_id,cold_start:0===this.props.playlist_data.NB_SONG})},_onSubmit:function(e){return this.state.submit_disabled?void e.preventDefault():void Events.trigger(Events.playlist.assistantValidation,{})},_onRemove:function(){this.setState({remove:!0,creation:!1})},_onCancel:function(){return this.state.remove?void this.setState({remove:!1,creation:!0}):void Events.trigger(Events.navigation.modal_close)},_getTitle:function(){return n(this.state.creation?0===this.props.playlist_id?"Crer une playlist":"diter la playlist":this.state.remove?"Vous tes sr ?":"Suggestions de titres")},_setAddedTrack:function(e,t){this.setState({addedTrack:t.nb})},_toggleButtonStatus:function(){this.setState({submit_disabled:!this.state.submit_disabled})},_emptySuggest:function(e,t){this.setState({suggest_empty:!0,close_action:t.close})}});t.exports=d},{"../../../core/i18n":243,"./_elements/Create":171,"./_elements/Remove":172,"./_elements/Suggest":173,classnames:"classnames",react:"react"}],173:[function(e,t,s){"use strict";var a=e("react"),i=e("../../../../core/i18n"),r=i.gettext,n=e("../../../common/Thumbnail"),o=a.createClass({displayName:"Suggest",propTypes:{playlist_id:a.PropTypes.number.isRequired,cold_start:a.PropTypes.bool},getDefaultProps:function(){return{playlist_id:0,cold_start:!1}},getInitialState:function(){return{track_list:null,track_index:0,loading:!1,playing_ads:"ads"===dzPlayer.getPlayerType()}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.player.tracklist_changed,this._onPlaySuggest),USER.OPTIONS.ads_audio&&(Events.subscribe(Events.player.finishAds,this._onAdsFinish),Events.subscribe(Events.player.changePlayerType,this._onChangePlayerType)),this._displaySong()},componentWillUnmount:function(){(this._dislikedSong.length>0||this._likedSong.length>0)&&api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong,nb:0}}),this._playedSuggest&&dzPlayer.restoreTrackList(),Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.player.tracklist_changed,this._onPlaySuggest),USER.OPTIONS.ads_audio&&(Events.unsubscribe(Events.player.finishAds,this._onAdsFinish),Events.unsubscribe(Events.player.changePlayerType,this._onChangePlayerType))},render:function(){if(null===this.state.track_list||this.state.loading)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"});if(0===this.state.track_list.length)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content suggest-empty"},a.createElement("div",{className:"placeholders-img nocontent"}),a.createElement("div",{className:"placeholders-title"},r("Dsol..."),a.createElement("div",{className:"placeholders-title"},r(0===this._trackListGroup?"Nous n'avons pas encore de suggestions pour vous. coutez de la musique et revenez plus tard !":"Nous n'avons plus de suggestions en stock, revenez plus tard !")),this._trackListGroup>0&&this._nbAddedTrack>0?a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onPlayPlaylist},a.createElement("span",{className:"label"},r("couter la playlist"))):!1)));if(this.state.playing_ads)return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content suggest-empty"},a.createElement("div",{className:"placeholders-img nocontent"}),a.createElement("div",{className:"placeholders-title"},r("Merci de patienter")),a.createElement("div",{className:"placeholders-title"},r("Publicit"))));var e=this.state.track_list[this.state.track_index];return a.createElement("div",{className:"modal-body playlist-assistant-suggest"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement("div",{className:"thumbnail-bg"},a.createElement(n,{type:"track",height:250,width:250,id:Number(e.SNG_ID),play_data:[e],md5:e.ALB_PICTURE,overlay:!1,play:!0,play_force:!0,cover_link:!1,context:"track_assistant"})),a.createElement("div",{className:"playlist-info"},this._renderTrackSource(e),a.createElement("h2",{className:"heading-2 ellipsis",title:e.SNG_TITLE},e.SNG_TITLE),a.createElement("h3",{className:"heading-2-sub ellipsis"},r("par")+" "+e.ART_NAME),a.createElement("a",{className:"suggest-action",onClick:this._dislike,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-hover icon-stack-cancel"},a.createElement("span",{className:"icon icon-cancel"}))),a.createElement("a",{className:"suggest-action",onClick:this._like,role:"button"},a.createElement("span",{className:"icon-64 icon-stack icon-stack-circle icon-stack-hover icon-stack-check"},a.createElement("span",{className:"icon icon-check-light"}))))))},_renderTrackSource:function(e){var t=r("Recommand pour cette playlist");return"USER_HISTORY"===e.DATA_SOURCE?t=r("cout rcemment"):"USER_FAVORITE"===e.DATA_SOURCE&&(t=r("Choisi dans vos coups de cur")),a.createElement("div",{className:"suggest-source"},t)},_onSubmit:function(){this._nbAddedTrack>0&&Events.trigger(Events.playlist.assistantSuggestFinish,{count:this._nbAddedTrack}),Events.trigger(Events.navigation.modal_close)},_onPlayPlaylist:function(){dzPlayer.play({type:"playlist",id:this.props.playlist_id})},_onPlaySuggest:function(){"track_assistant"===dzPlayer.getContext("TYPE")&&(this._playedSuggest=!0)},_onAdsFinish:function(){this.setState({playing_ads:!1})},_onChangePlayerType:function(e,t){this.setState({playing_ads:"ads"===t})},_likedSong:[],_dislikedSong:[],_nbAddedTrack:0,_trackListGroup:0,_playedSuggest:!1,_like:function(){var e=this.state.track_list[this.state.track_index];this._likedSong.push({SNG_ID:e.SNG_ID,PRODUCT_TRACK_ID:e.PRODUCT_TRACK_ID,DATA_SOURCE:e.DATA_SOURCE,ALGO_VERSION:e.ALGO_VERSION}),userData.addPlaylistSong(this.props.playlist_id,[[this.state.track_list[this.state.track_index].SNG_ID,0]],{notify:!1}),this.props.cold_start===!0&&0===this._nbAddedTrack?this._loadSong():this._displaySong(),this._nbAddedTrack++,Events.trigger(Events.playlist.assistantAddedTrack,{nb:this._nbAddedTrack})},_dislike:function(){var e=this.state.track_list[this.state.track_index];this._dislikedSong.push({SNG_ID:e.SNG_ID,PRODUCT_TRACK_ID:e.PRODUCT_TRACK_ID,DATA_SOURCE:e.DATA_SOURCE,ALGO_VERSION:e.ALGO_VERSION}),this._displaySong()},_displaySong:function(){null===this.state.track_list||this.state.track_list.length-1===this.state.track_index?this._loadSong():this.setState({track_index:this.state.track_index+1},this._displaySongCallback)},_loadSong:function(){this.setState({loading:!0},function(){api.call({method:"deezer.playlist_assistant",data:{playlist_id:this.props.playlist_id,liked_tracks:this._likedSong,banned_tracks:this._dislikedSong},error:function(){Events.trigger(Events.navigation.modal_close)},success:function(e){this.isMounted()&&(this._likedSong=[],this._dislikedSong=[],this._trackListGroup++,0===e.data.length&&Events.trigger(Events.playlist.assistantSuggestEmpty,{close:0===this._trackListGroup}),this.setState({track_index:0,track_list:e.data,loading:!1},this._displaySongCallback))}.bind(this)})}.bind(this))},_displaySongCallback:function(){4===this.state.track_index&&Events.trigger(Events.tips.draw,{name:"playlist_assistant_suggest",check:!0});var e=this.state.track_list[this.state.track_index];this._playedSuggest&&dzPlayer.play({type:"track",autoplay:dzPlayer.playing,id:e.SNG_ID,saveCurrentTrackList:!1,context:{ID:e.SNG_ID,TYPE:"track_assistant"},data:[e]})}});t.exports=o},{"../../../../core/i18n":243,"../../../common/Thumbnail":129,react:"react"}],172:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Thumbnail"),l=a.createClass({displayName:"Remove",propTypes:{playlist_id:a.PropTypes.number.isRequired,playlist_data:a.PropTypes.object.isRequired},getDefaultProps:function(){return{playlist_id:0,playlist_data:{}}},getInitialState:function(){return{error:!1}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit)},render:function(){var e=i({"form-group":!0,"has-error":this.state.error!==!1});return a.createElement("div",{className:"modal-body playlist-assistant-create"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement(o,{id:this.props.playlist_id,type:"playlist",md5:this.props.playlist_data.PLAYLIST_PICTURE,picture_type:this.props.playlist_data.PICTURE_TYPE,height:200,width:200,height_img:200,width_img:200,bordered:!0,cover_link:!1,overlay:!1,multi_cover:!0}),a.createElement("div",{className:"playlist-info"},a.createElement("h2",{className:"heading-4"},n("Entrez le nom de votre playlist, nous voulons juste vrifier que vous n'allez pas faire une btise.")),a.createElement("div",{className:e},a.createElement("input",{className:"form-control",ref:"confirm_playlist_title",type:"text",placeholder:n("Nom de la playlist")}),this.state.error?a.createElement("label",{className:"control-label"},n("Le nom saisi ne correspond pas  celui de votre playlist.")):null))))},_onSubmit:function(){return this.refs.confirm_playlist_title.value.toLowerCase()!==this.props.playlist_data.TITLE.toLowerCase()?void this.setState({error:!0}):(userData.removePlaylist({id:this.props.playlist_data.PLAYLIST_ID}),void Events.trigger(Events.navigation.modal_close))}});t.exports=l},{"../../../../core/i18n":243,"../../../common/Thumbnail":129,classnames:"classnames",react:"react"}],171:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Thumbnail"),l=a.createClass({displayName:"Create",propTypes:{playlist_id:a.PropTypes.number.isRequired,sng_id:a.PropTypes.array,tags:a.PropTypes.array,playlist_data:a.PropTypes.object,song_data:a.PropTypes.object},getDefaultProps:function(){return{playlist_id:0,sng_id:[],tags:[],playlist_data:{},song_data:{}}},getInitialState:function(){return{is_private:1===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),is_collab:2===Number(this.props.playlist_data.STATUS)||3===Number(this.props.playlist_data.STATUS),title:this.props.playlist_data.TITLE||this._getDefaultTitle(),description:this.props.playlist_data.DESCRIPTION||"",playlist_picture:this.props.playlist_data.PLAYLIST_PICTURE,playlist_picture_type:this.props.playlist_data.PICTURE_TYPE,playlist_picture_data:!1,title_error:!1}},componentDidMount:function(){Events.subscribe(Events.playlist.assistantValidation,this._onSubmit),Events.subscribe(Events.playlist.updatePicture,this._onUpdatePicture)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.assistantValidation,this._onSubmit),Events.unsubscribe(Events.playlist.updatePicture,this._onUpdatePicture)},render:function(){var e=i({"form-control form-control-block playlist-description":!0,open:""===this.state.description?!1:this.state.description.length>0}),t=i({"playlist-info":!0,"has-error":this.state.title_error});return a.createElement("div",{className:"modal-body playlist-assistant-create"},a.createElement("div",{className:"playlist-content clearfix"},a.createElement(o,{id:this.props.playlist_id,type:"playlist",md5:this.state.playlist_picture,picture_type:this.state.playlist_picture_type,height:200,width:200,height_img:200,width_img:200,bordered:!0,upload_cover:!0,multi_cover:!0,overlay_force:!0,data_uri:this.state.playlist_picture_data}),a.createElement("input",{className:"hide",accept:"image/*",id:"naboo_playlist_image_upload",name:"file",type:"file"}),a.createElement("div",{className:t},a.createElement("h2",{className:"heading-4"},n(0===this.props.playlist_id?"Pour lui donner un nom, c'est par ici :":"Pour changer son nom, c'est par ici :")),a.createElement("input",{className:"form-control form-control-block",type:"text",maxLength:"50",placeholder:n("Nom de la playlist"),onChange:this._onChangeTitle,value:this.state.title}),this.state.title_error?a.createElement("div",{className:"alert alert-danger"},n("Votre playlist mrite d'avoir un nom !")):!1,a.createElement("div",{className:"form-inline"},a.createElement("div",{className:"form-group"},a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"private"},a.createElement("input",{id:"private",type:"checkbox",checked:this.state.is_private,onChange:this._onChangePrivate}),a.createElement("span",null,n("Prive")," "),a.createElement("span",{className:"playlist-option-help"},n("(cette playlist ne sera visible que par vous)")))))),a.createElement("div",{className:"form-inline"},a.createElement("div",{className:"form-group"},this.props.playlist_id>0?a.createElement("span",{className:"form-checkbox playlist-option"},a.createElement("label",{htmlFor:"collab"},a.createElement("input",{id:"collab",type:"checkbox",checked:this.state.is_collab,onChange:this._onChangeCollab}),n("Collaborative")),this.state.is_collab&&0!==this.props.playlist_id?a.createElement("input",{className:"form-control form-collab",type:"text",readOnly:"readonly",onClick:this._onSelectInput,value:SETTING_HOST_SITE+"/sharedplaylist-"+this.props.playlist_id+"-"+this.props.playlist_data.COLLAB_KEY}):!1):!1)))),a.createElement("div",{className:"playlist-content"},a.createElement("h2",{className:"heading-4"},n("Parlez-nous un peu de cette playlist...")),a.createElement("textarea",{name:"playlist-description",maxLength:"200",className:e,placeholder:n("Saisir une description (optionnel)"),onChange:this._onChangeDescription,value:this.state.description})))},_onUpdatePicture:function(e,t){return"base64"===t.type?(this.setState({playlist_picture_data:t.data}),!0):0===this.props.playlist_id?(www.navigate("/playlist/"+t.element_id),Events.trigger(Events.navigation.modal_close),!0):void this.setState({playlist_picture:t.md5,playlist_picture_type:t.type})},_onChangePrivate:function(e){this.setState({is_private:e.target.checked})},_onChangeCollab:function(e){this.setState({is_collab:e.target.checked})},_onChangeTitle:function(e){this.setState({title:e.target.value})},_onChangeDescription:function(e){this.setState({description:e.target.value})},_onSelectInput:function(e){e.target.select()},_onSubmit:function(){if(this.setState({title_error:""===window.trim(this.state.title)}),""===window.trim(this.state.title))return!1;Events.trigger(Events.playlist.assistantToggleValidation);var e=0;this.state.is_collab&&(e+=2),this.state.is_private&&(e+=1);var t="";this.state.description&&(t+=this.state.description);var s={title:window.trim(this.state.title),description:t,status:e};if(0===this.props.playlist_id){if(s.tags=this.props.tags,this.props.sng_id.length>0){s.songs=[];for(var a=0;a<this.props.sng_id.length;a++)s.songs[a]=[this.props.sng_id[a],this.props.sng_id[a]>0?0:1]}userData.createPlaylist(s,this._validateCallback)}else s.playlist_id=this.props.playlist_id,userData.updatePlaylist(s,this._validateCallback)},_getDefaultTitle:function(){var e="";if(1===this.props.tags.length){for(var t=this.props.tags[0],s=t.split("_"),a=0;a<s.length;a++)s[a]=window.ucfirst(s[a]);e=s.join(" ")}return this.props.sng_id.length>0&&(e=this.props.song_data.ART_NAME),e},_validateCallback:function(e){if("string"==typeof e){if(this.state.playlist_picture_data!==!1)return Events.trigger(Events.playlist.uploadPicture,{id:e}),!1;www.navigate("/playlist/"+e)}return Events.trigger(Events.navigation.modal_close),!1}});t.exports=l},{"../../../../core/i18n":243,"../../../common/Thumbnail":129,classnames:"classnames",react:"react"}],169:[function(e,t,s){"use strict";var a=e("react"),i=e("../../../common/Thumbnail"),r=e("../../../common/TagList"),n=a.createClass({displayName:"CuratorTagging",propTypes:{item:a.PropTypes.object.isRequired,type:a.PropTypes.oneOf(["song","artist","album"]).isRequired,itemTags:a.PropTypes.array.isRequired,allTags:a.PropTypes.arrayOf(a.PropTypes.shape({TAG_ID:a.PropTypes.string.isRequired,TAG_NAME:a.PropTypes.string.isRequired,TAG_TYPE:a.PropTypes.string.isRequired})).isRequired,hiddenCategories:a.PropTypes.array},getDefaultProps:function(){return{hiddenCategories:["audio_content"]}},getInitialState:function(){return{itemTags:this.props.itemTags,filter:"",category:""}},componentDidMount:function(){Events.subscribe(Events.tag.select,this._onSelect)},componentWillUnmount:function(){Events.unsubscribe(Events.tag.select,this._onSelect)},render:function(){return a.createElement("section",{id:"modal_edit_tag"},this._renderHeader(),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},this._renderItemInfos(),this._renderSelected(),this._renderForm())),this._renderFooter())},_renderHeader:function(){return a.createElement("header",null,a.createElement("h1",{className:"modal-header"},"Edit tags"))},_renderFooter:function(){return a.createElement("footer",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default",type:"button",role:"button",onClick:this._onCancelClick},a.createElement("span",{className:"label"},"Cancel")),a.createElement("button",{className:"btn btn-primary",type:"button",role:"button",onClick:this._onSaveClick},a.createElement("span",{className:"label"},"Save"))))},_renderItemInfos:function(){var e=this._getPictureInfo();return a.createElement("div",{className:"wrapper-table track-infos"},a.createElement("div",{className:"cell cell-thumbnail"},a.createElement(i,{id:e.id,type:e.type,md5:e.md5,height:120,width:120})),a.createElement("div",{className:"cell cell-infos"},a.createElement("div",{className:"heading-2"},a.createElement("div",{className:"ellipsis"},this._getTitle())),a.createElement("div",{className:"heading-2-sub ellipsis",id:"share-subtitle"},this._getSubTitle()),a.createElement(r,{tags:this._getTrackInfosTags(),link:!1,max:1/0,type:"text"})))},_renderSelected:function(){return 0===this.state.itemTags.length?null:[a.createElement("div",{key:"header",className:"heading-3"},"Selected tags"),a.createElement("div",{key:"header-sub",className:"heading-3-sub"},"(may not yet be visible on the site)"),a.createElement("div",{key:"list",className:"wrapper"},a.createElement("div",{className:"selected-tag-list"},this._renderSelectedList()))]},_renderForm:function(){return a.createElement("form",{className:"form-horizontal",role:"form"},a.createElement("div",{className:"heading-3"},"Add tags"),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_filter"},"Filter"),a.createElement("input",{id:"modal_edit_tag_filter",type:"search",className:"form-control",onChange:this._onFilterChange,value:this.state.filter})),a.createElement("div",{className:"form-group"},a.createElement("label",{className:"control-label",htmlFor:"modal_edit_tag_categories"},"Category"),a.createElement("div",{className:"form-controls"},this._renderCategoryList())),a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"full-tag-list"},this._renderTagList())))},_renderCategoryList:function(){var e=this.props.allTags.map(function(e){return e.TAG_TYPE});return e=e.reduce(function(e,t){return-1===e.indexOf(t)?e.concat([t]):e},[]),e=e.filter(function(e){return-1===this.props.hiddenCategories.indexOf(e)}.bind(this)),e=e.map(function(e){return a.createElement("option",{key:e,value:e},e)}),e.unshift(a.createElement("option",{key:"all",value:""},"All categories")),a.createElement("select",{id:"modal_edit_tag_categories",className:"form-control",value:this.state.category,onChange:this._onCategoryChange},e)},_renderSelectedList:function(){for(var e,t=[],s=0,i=this.state.itemTags.length;i>s;s++)e=this._getTagFromLabel(this.state.itemTags[s]),"undefined"!=typeof e&&t.push({LABEL:e.TAG_NAME});return a.createElement(r,{tags:t,max:1/0,link:!1,selected:!0,onRemove:this._onRemove})},_renderTagList:function(){for(var e=this._filterTags(this.props.allTags),t=[],s=0,i=e.length;i>s;s++)t.push({LABEL:e[s].TAG_NAME});return a.createElement(r,{tags:t,max:1/0,link:!1,selectable:!0})},_onCategoryChange:function(e){this.setState({category:e.target.value})},_onFilterChange:function(e){this.setState({filter:e.target.value})},_onSelect:function(e,t){"text"!==t.source.props.type&&this._selectTag(t.tag)},_onRemove:function(e){this._deselectTag(e)},_onCancelClick:function(e){e.preventDefault(),Events.trigger(Events.navigation.modal_close)},_onSaveClick:function(e){e.preventDefault();for(var t,s={},a=0,i=this.state.itemTags.length;i>a;a++)this.state.itemTags.hasOwnProperty(a)&&(t=this.state.itemTags[a],s[t]=this._getTagFromLabel(t).TAG_ID);api.call({method:"tag_edito.updateAll",data:{ELEM_ID:this._getId(),TAG_LIST:s,TYPE:this.props.type+"s"}}),Events.trigger(Events.navigation.modal_close)},_selectTag:function(e){var t=this.state.itemTags.slice();t.push(e.replace(/ |-/g,"_")),this.setState({itemTags:t})},_deselectTag:function(e){var t=this.state.itemTags.filter(function(t){return t!==e.replace(/ |-/g,"_")});this.setState({itemTags:t})},_filterTags:function(e){var t=window.rewriting(this.state.filter.toLowerCase()),s=this.state.itemTags.map(function(e){return e}),a=e.filter(function(e){return-1!==s.indexOf(e.TAG_NAME.replace(/ |-/g,"_"))||""!==this.state.category&&this.state.category!==e.TAG_TYPE||-1!==this.props.hiddenCategories.indexOf(e.TAG_TYPE)||""!==this.state.filter&&-1===window.rewriting(e.TAG_NAME.toLowerCase()).indexOf(t)?!1:!0}.bind(this));return a},_getTagFromLabel:function(e){for(var t=0,s=this.props.allTags.length;s>t;t++)if(this.props.allTags[t].TAG_NAME.replace(/ |-/g,"_")===e)return this.props.allTags[t]},_getTrackInfosTags:function(){var e=this.props.item.TAGS.filter(function(e){return-1!==this.props.item.BANNED_TAGS.indexOf(e)?!1:!0}.bind(this));return e=e.map(function(e){return{LABEL:this._getTagFromLabel(e).TAG_NAME}}.bind(this)),e=e.concat(this.props.item.BANNED_TAGS.map(function(e){return{LABEL:a.createElement("del",null,this._getTagFromLabel(e).TAG_NAME)}}.bind(this)))},_getTitle:function(){return"song"===this.props.type?this.props.item.SNG_TITLE:"artist"===this.props.type?this.props.item.ART_NAME:"album"===this.props.type?this.props.item.ALB_TITLE:""},_getSubTitle:function(){return"song"===this.props.type||"album"===this.props.type?"by "+this.props.item.ART_NAME:""},_getPictureInfo:function(){return"song"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:"artist"===this.props.type?{id:this._getId(),type:"artist",md5:this.props.item.ART_PICTURE}:"album"===this.props.type?{id:this._getId(),type:"cover",md5:this.props.item.ALB_PICTURE}:{}},_getId:function(){return"song"===this.props.type?Number(this.props.item.SNG_ID):"artist"===this.props.type?Number(this.props.item.ART_ID):"album"===this.props.type?Number(this.props.item.ALB_ID):0}});t.exports=n},{"../../../common/TagList":128,"../../../common/Thumbnail":129,react:"react"}],129:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("classnames"),n=e("../../core/i18n"),o=n.gettext,l=e("./Blur"),c=e("./FileUploader"),p=e("./Tooltip/Tooltip"),d=a.createClass({displayName:"Thumbnail",propTypes:{id:a.PropTypes.number,play_data:a.PropTypes.array,type:a.PropTypes.oneOf(["album","track","artist","radio","user","playlist","show","talk","app","generic","episode"]),md5:a.PropTypes.string,height:a.PropTypes.number,width:a.PropTypes.number,height_img:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.number]),width_img:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.number]),play:a.PropTypes.bool,play_force:a.PropTypes.bool,play_link:a.PropTypes.bool,preview:a.PropTypes.bool,preview_only:a.PropTypes.bool,bordered:a.PropTypes.bool,rounded:a.PropTypes.bool,sticker:a.PropTypes.bool,release_date:a.PropTypes.string,radio:a.PropTypes.bool,context:a.PropTypes.string,picture_type:a.PropTypes.string,play_index:a.PropTypes.oneOfType([a.PropTypes.oneOf([null]),a.PropTypes.number]),private_status:a.PropTypes.number,multi_cover:a.PropTypes.bool,cover_play:a.PropTypes.bool,cover_link:a.PropTypes.bool,context_menu:a.PropTypes.object,display_size:a.PropTypes.bool,title:a.PropTypes.string,overlay:a.PropTypes.bool,overlay_force:a.PropTypes.bool,upload_cover:a.PropTypes.bool,data_uri:a.PropTypes.oneOfType([a.PropTypes.oneOf([!1]),a.PropTypes.string]),target:a.PropTypes.string,onClick:a.PropTypes.func,lyrics_opened:a.PropTypes.bool,duplicate_picture:a.PropTypes.bool,blur:a.PropTypes.number},getDefaultProps:function(){return{id:0,play_data:[],type:"album",md5:"",height:55,width:55,height_img:!1,width_img:!1,play:!1,preview:!1,preview_only:!1,play_force:!1,play_link:!1,bordered:!1,rounded:!1,sticker:!1,release_date:"",radio:!1,context:"",picture_type:"",play_index:null,private_status:0,multi_cover:!1,cover_play:!1,cover_link:!0,context_menu:null,display_size:!0,title:"",overlay:!0,overlay_force:!1,upload_cover:!1,data_uri:!1,duplicate_picture:!1,blur:0}},getInitialState:function(){var e,t,s=!1;return this.props.context_menu&&(e="user"===this.props.type?this.props.context_menu.__TYPE__:this.props.type,t="user"===this.props.type?this.props.context_menu.SNG_ID:this.props.id,s=userData.isFavorite(e,t)),{context_menu_type:"track"===e?"song":e,context_menu_id:t,context_type:dzPlayer.getContext("TYPE"),is_favorite:s,playing:this._getPlayingStatus(),preview_active:!1}},componentDidMount:function(){Events.ready(Events.user.userReady,this._onFavoriteToggle),Events.subscribe(Events.player.finish,this._updateOnAir),Events.subscribe(Events.player.playing,this._updateOnAir),Events.subscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.subscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.subscribe(Events.player.finishPreview,this._onNaturalPreviewEnd),this.props.preview&&setTimeout(function(){this.refs.playIcon&&i(this.refs.playIcon).tipsy({fallback:o("Cliquer longuement pour couter un extrait"),delayIn:700,delayOut:0,gravity:"s"})}.bind(this),0)},shouldComponentUpdate:function(e,t){return this.props.id!==e.id||this.props.md5!==e.md5||this.props.type!==e.type||this.state.playing!==t.playing||this.state.is_favorite!==t.is_favorite||this.state.preview_active!==t.preview_active},componentDidUpdate:function(){this._updateOnAir(),this.props.preview&&this[this.state.preview_active?"_previewPlay":"_previewStop"]()},componentWillUnmount:function(){Events.unsubscribe(Events.player.finish,this._updateOnAir),Events.unsubscribe(Events.player.playing,this._updateOnAir),Events.unsubscribe(Events.user.addFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.user.deleteFavorite,this._onFavoriteToggle),Events.unsubscribe(Events.player.finishPreview,this._onNaturalPreviewEnd)},render:function(){var e=this.props.onClick?this.props.onClick:this._link;return a.createElement("figure",{className:this._getFigureStyle()},a.createElement("div",{className:"picture-link",onClick:e},this._renderDuplicateImage(),this._renderImage(),this._renderOverlay()),this._renderPlayIcon(),this._renderSticker(),this._renderContextMenu(),this._renderMixTitle(),this._renderUploadIcon())},_renderImage:function(){var e={className:"picture",src:this._getPicturePath(),height:this.props.height,width:this.props.width};return 0===this.props.blur?a.createElement("img",e):a.createElement(l,e)},_renderDuplicateImage:function(){if(!this.props.duplicate_picture)return null;var e={className:"picture-blur active",src:this._getPicturePath(),height:this.props.height,width:this.props.width,blur:5};return a.createElement(l,e)},_renderUploadIcon:function(){return this.props.upload_cover&&c?a.createElement(c,{element_id:this.props.id},a.createElement("span",{className:"play play-force"},a.createElement("span",{className:"icon icon-camera"}))):null},_renderPlayIcon:function(){if(this.props.play){var e=this.props.height<80&&this.props.width<80,t=r({"play evt-click":!0,"play-force":this.props.play_force,"play-32":e,"play-52":!e,active:this.state.playing,preview:this.state.preview_active}),s=r({"icon-stack icon-stack-circle icon-stack-hover":!0,"icon-32":e,"icon-52":!e,active:this.props.lyrics_opened});return a.createElement("span",{className:t,ref:"playIcon",onMouseDown:this._togglePreview.bind(this,!0),onMouseUp:this._togglePreview.bind(this,!1),onMouseLeave:this._togglePreview.bind(this,!1),onClick:this._play},a.createElement("span",{className:s},a.createElement("span",{className:"play-icon play-default"},a.createElement("span",{className:"icon icon-play"})),a.createElement("span",{className:"play-icon play-hover"},a.createElement("span",{className:"icon icon-pause"})),a.createElement("span",{className:"play-icon play-active"},a.createElement("span",{className:"equalizer equalizer-inverse equalizer-16"},a.createElement("span",{className:"equalizer-bar equalizer-bar-1"}),a.createElement("span",{className:"equalizer-bar equalizer-bar-2"}),a.createElement("span",{className:"equalizer-bar equalizer-bar-3"})))))}},_renderSticker:function(){if(this.props.sticker){var e,t=new Date(this.props.release_date).getTime();return t/1e3+2592e3>window.SERVER_TIMESTAMP&&(e="NEW"),a.createElement("span",{className:"sticker sticker-small sticker-red"},e)}},_renderContextMenu:function(){if(!this.props.context_menu)return null;var e=r({"options-item options-favorite":!0,"action-active":this.state.is_favorite});return a.createElement("ul",{className:"options options-react","data-link":"0","data-favorite":"1"},a.createElement("li",{className:e,onClick:this._onFavoriteClick},a.createElement("span",{className:"icon icon-love","data-action":"favorite"})),"track"===this.props.type?a.createElement(p,{text:o("couter avec les paroles")},a.createElement("li",{className:"options-item",onClick:this._onLyricsClick},a.createElement("span",{className:"icon icon-lyrics"}))):null,a.createElement("li",{className:"options-item pull-right",onClick:this._onContextMenuClick},a.createElement("span",{className:"icon icon-options","data-action":"options"})))},_renderMixTitle:function(){return this.props.radio?a.createElement("span",{className:"mix-title"},this.props.title):void 0},_renderOverlay:function(){if(this.props.overlay===!1)return null;var e=r({"options-overlay":!0,"options-overlay-force":this.props.overlay_force});return a.createElement("div",{className:e})},_onFavoriteToggle:function(){if(null!==this.props.context_menu){var e=userData.isFavorite(this.state.context_menu_type,this.state.context_menu_id);e!==this.state.is_favorite&&this.setState({is_favorite:e})}},_onFavoriteClick:function(){var e=this.state.is_favorite?"remove":"add";favorite[e]({type:this.state.context_menu_type,id:this.state.context_menu_id,context:this.props.context})},_onContextMenuClick:function(e){var t=this.props.context_menu;return"song"===this.state.context_menu_type&&(t={SONG:t}),0===USER.USER_ID?void www.goToConnection():void Events.trigger(Events.menu.contextMenuOpen,{is_thumbnail:!0,target:e.currentTarget,id:this.state.context_menu_id,type:this.state.context_menu_type,data:t,position:"bottom",context:this.props.context,listen_context:{ID:this.state.context_menu_id,TYPE:this.props.context}})},_onNaturalPreviewEnd:function(){this.props.preview&&this.state.preview_active&&this._updatePreviewState(!1,!0)},_onLyricsClick:function(){Events.subscribeOnce(Events.player.tracklist_changed,function(){dzPlayer.control.nextSong(),Events.trigger(Events.menu.togglePanel,"lyrics")});var e={type:"track",id:this.props.id,radio:!1,context:{TYPE:this.props.context,ID:this.props.id}};"radio"!==dzPlayer.getPlayerType()&&(e.addNext=!0),dzPlayer.play(e)},_previewTimer:null,_previewTimeout:500,_naturalPreviewEnd:!1,_togglePreview:function(e){this.props.preview&&(clearTimeout(this._previewTimer),e=Boolean(e),e&&this.state.preview_active||OFFLINE||"ads"===dzPlayer.getPlayerType()||"jingle"===dzPlayer.getPlayerType()||(this._previewTimer=setTimeout(function(){this._updatePreviewState(e)}.bind(this),this._previewTimeout)))},_previewPlay:function(){var e=this._previewTypeToMethodData();api.call({method:e.method,data:e.data,success:function(e){var t=this._extractPreviewMd5(e);return t?dzPlayer.trigger("audioPlayer_startPreview",[t]):this._updatePreviewState(!1,!0),!0}.bind(this),error:function(){return this._updatePreviewState(!1,!0),!0}.bind(this)})},_previewStop:function(){dzPlayer.trigger("audioPlayer_endPreview")},_updatePreviewState:function(e,t){this.isMounted()&&this.setState({preview_active:e},function(){this.state.preview_active&&this.refs.playIcon&&i(this.refs.playIcon).tipsy("hide"),this._naturalPreviewEnd=Boolean(t)}.bind(this))},_previewTypeToMethodData:function(){var e={album:{method:"song.getListByAlbum",data:{ALB_ID:this.props.id,NB:1}},track:{method:"song.getData",data:{SNG_ID:this.props.id}},playlist:{method:"playlist.getSongs",data:{PLAYLIST_ID:this.props.id,NB:1}},radio:{method:"radio.getSongs",data:{RADIO_ID:this.props.id,NB:1}},artist:{method:"smart.getSmartRadio",data:{ART_ID:this.props.id,LIMIT:1}},show:{method:"episode.getListByShow",data:{SHOW_ID:this.props.id,LIMIT:1}}};return e[this.props.type]},_extractPreviewMd5:function(e){return"track"===this.props.type?e===Object(e)&&e.MD5_ORIGIN&&Number(right.checkSongAvailable(e))===Number(right.READABLE)?e.MD5_ORIGIN:null:e===Object(e)&&Array.isArray(e.data)&&e.data[0].MD5_ORIGIN&&Number(right.checkSongAvailable(e.data[0]))===Number(right.READABLE)?e.data[0].MD5_ORIGIN:null},_getFigureStyle:function(){var e=["thumbnail"];return this.props.bordered&&e.push("thumbnail-bordered"),this.props.rounded&&e.push("thumbnail-rounded"),this.props.radio&&e.push("thumbnail-mix"),e.join(" ")},_getPicturePath:function(){if(this.props.data_uri)return this.props.data_uri;var e=SETTING_DOMAIN_IMG,t=this.props.multi_cover?this.props.md5:this.props.md5.split("-")[0];if(""!==this.props.picture_type&&""!==t)e+="/"+this.props.picture_type;else if(""!==this.props.type){var s={track:"cover",album:"cover",radio:"misc",playlist:""===t?"playlist":"cover",show:"talk",app:"misc"};e+="/"+("string"==typeof s[this.props.type]?s[this.props.type]:this.props.type)}else e+="/misc";var a=(this.props.height_img===!1?this.props.height:this.props.height_img)+"x"+(this.props.width_img===!1?this.props.width:this.props.width_img);return e+"/"+t+"/"+a+"-000000-80-0-0.jpg"},_getPlayingStatus:function(){if("track"===this.props.type&&this.props.id===Number(dzPlayer.getCurrentSong("MEDIA_ID"))&&null!==this.props.play_index&&Number(this.props.play_index)===dzPlayer.getIndexSong())return dzPlayer.isPlaying();var e=dzPlayer.getContext();if(null!==e){var t="track"===this.props.type?Number(dzPlayer.getCurrentSong("MEDIA_ID")):e.ID;return dzPlayer.isPlaying()&&LOG_CONTEXT[e.TYPE]===LOG_CONTEXT[this.props.context]&&Number(t)===Number(this.props.id)}return!1},_updateOnAir:function(){this.setState({playing:this._getPlayingStatus()})},_play:function(e){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(this.props.preview&&this.state.preview_active||!this.props.play)return void e.stopPropagation();if(!this.props.preview_only){var t=dzPlayer.getContext();if(null!==t&&LOG_CONTEXT[t.TYPE]===LOG_CONTEXT[this.props.context]&&Number(t.ID)===Number(this.props.id)||"queue_list"===this.props.context&&Number(this.props.play_index)===dzPlayer.getTrackListIndex())return void dzPlayer.control.togglePause();if(this.props.onClick&&this.props.onClick(),this.props.play_link&&this._link(),"queue_list"===this.props.context)return void dzPlayer.playTrackAtIndex(this.props.play_index);var s={type:this.props.type,id:this.props.id,radio:this.props.radio,context:{ID:this.props.id,TYPE:this.props.context},data:this.props.play_data};null!==this.props.play_index&&(s.index=this.props.play_index),this.props.play_data.length>0&&(s.data=this.props.play_data),dzPlayer.play(s)}},_link:function(){if(this.props.preview&&this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(!(this.props.preview&&this.state.preview_active||!this.props.cover_link&&!this.props.cover_play)){if(this.props.cover_play)return void this._play();var e="";if(this.props.target)e=this.props.target;else{var t={user:"profile/"+this.props.id,radio:"mixes/genre/"+this.props.id};e="/"+("string"==typeof t[this.props.type]?t[this.props.type]:this.props.type+"/"+this.props.id)}loadBox(e)}}});t.exports=d},{"../../core/i18n":243,"./Blur":57,"./FileUploader":119,"./Tooltip/Tooltip":131,classnames:"classnames",jquery:"jquery",react:"react"}],131:[function(e,t,s){"use strict";var a,i=e("babel-runtime/helpers/extends")["default"],r=e("react"),n=e("react-dom"),o=e("react-addons-pure-render-mixin"),l=e("./Portal"),c=r.createClass({displayName:"Tooltip",propTypes:{text:r.PropTypes.string.isRequired,html:r.PropTypes.bool,position:r.PropTypes.oneOf(["top","bottom","left","right"]),relativeTo:r.PropTypes.string,children:r.PropTypes.oneOfType([r.PropTypes.element,r.PropTypes.string]).isRequired},mixins:[o],getDefaultProps:function(){return{html:!1,position:"top"}},componentDidMount:function(){"undefined"==typeof a&&(a=document.createElement("div"),document.body.appendChild(a),n.render(r.createElement(l,null),a))},componentWillUnmount:function(){Events.trigger(Events.tooltip.hide)},render:function(){var e={onMouseEnter:this._onEnter,onMouseLeave:this._onLeave,"aria-describedby":"tooltip-portal"};return"string"==typeof this.props.children.type?r.cloneElement(this.props.children,e):r.createElement("div",i({className:"tooltip-wrapper"},e),this.props.children)},_onEnter:function(){this.props.children.props&&"function"==typeof this.props.children.props.onMouseEnter&&this.props.children.props.onMouseEnter.apply(this.props.children,arguments),Events.trigger(Events.tooltip.show,{text:this.props.text,html:this.props.html,position:this._getPosition(),element:this._getElement()})},_onLeave:function(){this.props.children.props&&"function"==typeof this.props.children.props.onMouseLeave&&this.props.children.props.onMouseLeave.apply(this.props.children,arguments),Events.trigger(Events.tooltip.hide)},_getElement:function(){var e=n.findDOMNode(this);return"string"==typeof this.props.relativeTo&&(e=e.querySelector(this.props.relativeTo)||e),e},_getPosition:function(){return"rtl"===window.DIRECTION&&"right"===this.props.position?"left":"rtl"===window.DIRECTION&&"left"===this.props.position?"right":this.props.position}});t.exports=c},{"./Portal":130,"babel-runtime/helpers/extends":290,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin","react-dom":"react-dom"}],130:[function(e,t,s){"use strict";var a=e("babel-runtime/helpers/extends")["default"],i=e("react"),r=e("classnames"),n=i.createClass({displayName:"Portal",getInitialState:function(){return{displayed:!1}},componentDidMount:function(){Events.subscribe(Events.tooltip.show,this._onShow),Events.subscribe(Events.tooltip.hide,this._onHide)},componentWillUnmount:function(){Events.unsubscribe(Events.tooltip.show,this._onShow),Events.unsubscribe(Events.tooltip.hide,this._onHide)},render:function(){var e={className:r({tooltip:!0,"tooltip-top":"top"===this.state.position,"tooltip-bottom":"bottom"===this.state.position,"tooltip-left":"left"===this.state.position,"tooltip-right":"right"===this.state.position,show:this.state.displayed}),style:this._getPosition(),role:"tooltip",id:"tooltip-portal","aria-hidden":this.state.displayed===!1};return this.state.html===!0?i.createElement("div",a({},e,{dangerouslySetInnerHTML:{__html:this.state.text}})):i.createElement("div",e,this.state.text)},_onShow:function(e,t){this.setState(a({},t,{displayed:!0}))},_onHide:function(){this.setState({displayed:!1})},_getPosition:function(){var e={top:0,left:0};if(!this.state.element)return e;var t=this.state.element.getBoundingClientRect();switch(this.state.position){case"top":e.top=t.top,e.left=t.left+t.width/2;break;case"bottom":e.top=t.top+t.height,e.left=t.left+t.width/2;break;case"left":e.top=t.top+t.height/2,e.left=t.left;break;case"right":e.top=t.top+t.height/2,e.left=t.left+t.width}return e}});t.exports=n},{"babel-runtime/helpers/extends":290,classnames:"classnames",react:"react"}],290:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/assign")["default"];s["default"]=a||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},s.__esModule=!0},{"babel-runtime/core-js/object/assign":281}],281:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":294}],294:[function(e,t,s){e("../../modules/es6.object.assign"),t.exports=e("../../modules/$.core").Object.assign},{"../../modules/$.core":304,"../../modules/es6.object.assign":317}],317:[function(e,t,s){var a=e("./$.def");a(a.S+a.F,"Object",{assign:e("./$.assign")})},{"./$.assign":302,"./$.def":306}],302:[function(e,t,s){var a=e("./$"),i=e("./$.to-object"),r=e("./$.iobject");t.exports=e("./$.fails")(function(){var e=Object.assign,t={},s={},a=Symbol(),i="abcdefghijklmnopqrst";return t[a]=7,i.split("").forEach(function(e){s[e]=e}),7!=e({},t)[a]||Object.keys(e({},s)).join("")!=i})?function(e,t){for(var s=i(e),n=arguments,o=n.length,l=1,c=a.getKeys,p=a.getSymbols,d=a.isEnum;o>l;)for(var u,h=r(n[l++]),m=p?c(h).concat(p(h)):c(h),_=m.length,f=0;_>f;)d.call(h,u=m[f++])&&(s[u]=h[u]);return s}:Object.assign},{"./$":312,"./$.fails":308,"./$.iobject":310,"./$.to-object":316}],312:[function(e,t,s){var a=Object;t.exports={create:a.create,getProto:a.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:a.getOwnPropertyDescriptor,setDesc:a.defineProperty,setDescs:a.defineProperties,getKeys:a.keys,getNames:a.getOwnPropertyNames,getSymbols:a.getOwnPropertySymbols,each:[].forEach}},{}],310:[function(e,t,s){var a=e("./$.cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==a(e)?e.split(""):Object(e)}},{"./$.cof":303}],303:[function(e,t,s){var a={}.toString;t.exports=function(e){return a.call(e).slice(8,-1)}},{}],119:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"FileUploader",propTypes:{element_id:a.PropTypes.number,children:a.PropTypes.object,accept:a.PropTypes.string,type:a.PropTypes.string,directory:a.PropTypes.string},getDefaultProps:function(){return{element_id:0,children:"",accept:"image/*",type:"picture",directory:"playlist"}},componentDidMount:function(){Events.subscribe(Events.playlist.uploadPicture,this._uploadFile)},componentWillUnmount:function(){Events.unsubscribe(Events.playlist.uploadPicture,this._uploadFile)},render:function(){return window.FileReader?a.createElement("div",{onClick:this._onSelectFileClick},a.createElement("input",{type:"file",className:"hide",multiple:!1,ref:"fileInput",accept:this.props.accept,onChange:this._onChangeFile}),this.props.children):!1},_selectedFile:null,_onSelectFileClick:function(){this.refs.fileInput.click()},_onChangeFile:function(e){if(this._selectedFile=e.target.files[0],-1===this._selectedFile.type.indexOf(this.props.accept.split("/")[0]))return!1;if(this.props.element_id>0)return this._uploadFile(null,{id:this.props.element_id});var t=new FileReader;t.onload=function(e){Events.trigger(Events.playlist.updatePicture,{type:"base64",data:e.target.result})},t.readAsDataURL(this._selectedFile)},_uploadFile:function(e,t){if(null===this._selectedFile)return!1;var s="%1/?sid=%2&id=%3&resize=1&directory=%4&type=%5&referer=%6&file=%7",a=s.replace("%1",SETTING_HOST_UPLOAD).replace("%2",SESSION_ID).replace("%3",t.id).replace("%4",this.props.directory).replace("%5",this.props.type).replace("%6",SETTING_REFERER_UPLOAD).replace("%7",this._selectedFile.name),i=new FormData;i.append("file",this._selectedFile);var r=new XMLHttpRequest;return r.addEventListener("load",function(e){if(200===e.target.status){var s=JSON.parse(e.target.response);0===s.error.length&&Events.trigger(Events.playlist.updatePicture,{element_id:t.id,type:this.props.directory,md5:s.results})}}.bind(this),!1),r.addEventListener("error",function(){},!1),r.open("POST",a,!0),r.send(i)}});t.exports=i},{react:"react"}],57:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"Blur",propTypes:{className:a.PropTypes.string,width:a.PropTypes.number.isRequired,height:a.PropTypes.number.isRequired,src:a.PropTypes.string.isRequired,blur:a.PropTypes.number},getDefaultProps:function(){return{blur:3}},componentDidMount:function(){var e=this.refs.canvas;e.height=this.props.height,e.width=this.props.width;var t=new Image;t.crossOrigin="Anonymous",t.onload=function(){var s=e.getContext("2d");s.drawImage(t,this.props.width/2-t.width/2,this.props.height/2-t.height/2),s.globalAlpha=.5;for(var a=-this.props.blur;a<=this.props.blur;a+=2)for(var i=-this.props.blur;i<=this.props.blur;i+=2)s.drawImage(e,i,a),i>=0&&a>=0&&s.drawImage(e,-(i-2.5),-(a-2.5));s.globalAlpha=1}.bind(this),t.src=this.props.src},render:function(){return a.createElement("canvas",{className:this.props.className,ref:"canvas"})}});t.exports=i},{react:"react"}],128:[function(e,t,s){"use strict";var a=e("react"),i=e("../../core/i18n"),r=i.gettext,n=e("./Tag"),o=a.createClass({displayName:"TagList",propTypes:{tags:a.PropTypes.array.isRequired,max:a.PropTypes.number,min:a.PropTypes.number,showLabel:a.PropTypes.bool,query:a.PropTypes.string,type:a.PropTypes.oneOf(["button","text"]),link:a.PropTypes.bool,selected:a.PropTypes.bool,selectable:a.PropTypes.bool,colorScale:a.PropTypes.array,onRemove:a.PropTypes.func},getDefaultProps:function(){return{max:15,min:0,showLabel:!1,query:"",link:!0,selected:!1,selectable:!1,colorScale:["400","600","800"]}},getInitialState:function(){return{tags:this.props.tags,onRemove:this.props.onRemove||this._onRemove}},componentWillReceiveProps:function(e){this.setState({tags:e.tags,onRemove:e.onRemove||this._onRemove})},render:function(){var e,t=this.state.tags.slice(0,this.props.max);if(!t.length)return null;var s=this.props.selected?r("Rsultats de recherche pour")+" ":r("Combiner avec :");return a.createElement("ul",{className:"tag-list clearfix"+(this.props.selected?" selected":""),"aria-live":"polite"},this.props.showLabel?a.createElement("li",null,a.createElement("div",{className:"tag"},a.createElement("span",{className:"btn btn-label tag-title"},s))):"",t.map(function(t,s){return e=this.props.colorScale[s%this.props.colorScale.length],a.createElement("li",{key:"panel-tag-"+t.LABEL+s},a.createElement(n,{label:t.LABEL,query:this.props.query,link:this.props.link,type:this.props.type,color:e,selectable:this.props.selectable,selected:this.props.selected,onRemove:this.state.onRemove}))}.bind(this)))},_onRemove:function(e){if(e){var t=this.state.tags;t.length>this.props.min?(t=t.filter(function(t){return t.LABEL!==e}),this.setState({tags:t},this._navigate)):this._openSearchPanel()}},_navigate:function(){if(this.props.link){var e="";this.state.tags.forEach(function(t){e+=t.LABEL.substr(1)+" "}),www.navigate("/tags/"+e.trim())}},_openSearchPanel:function(){if(this.props.link){var e=document.getElementById("menu_search");e.click(),e.focus()}}});t.exports=o},{"../../core/i18n":243,"./Tag":127,react:"react"}],127:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=a.createClass({displayName:"Tag",propTypes:{label:a.PropTypes.node.isRequired,query:a.PropTypes.string,color:a.PropTypes.string,link:a.PropTypes.bool,type:a.PropTypes.oneOf(["button","text"]),selected:a.PropTypes.bool,selectable:a.PropTypes.bool,onRemove:a.PropTypes.func},getDefaultProps:function(){return{color:"400",link:!0,type:"button",selected:!1,selectable:!1,onRemove:function(){}}},shouldComponentUpdate:function(e){return this.props.selected!==e.selected},render:function(){var e={"btn btn-tag":"button"===this.props.type,"txt-tag":"text"===this.props.type,"txt-tag-hover":"text"===this.props.type&&this.props.link,selected:this.props.selected,selectable:this.props.selectable};e["btn-tag-"+this.props.color]="button"===this.props.type?!0:!1;var t=i(e);return this.props.selectable||this.props.selected?a.createElement("div",{className:t},a.createElement("span",{className:"tag-label"},this.props.label),this.props.selectable?this._renderSelectableButton():null,this.props.selected?this._renderSelectedButton():null):this.props.link?a.createElement("a",{className:t,onClick:this._onClick,role:"button"},a.createElement("span",{className:"tag-label"},this.props.label)):a.createElement("span",{className:t,onClick:this._onClick,role:"button"},a.createElement("span",{className:"tag-label"},this.props.label))},_renderSelectableButton:function(){return a.createElement("a",{className:"tag-action",role:"button",onClick:this._onClick},a.createElement("span",{className:"icon icon-add"}))},_renderSelectedButton:function(){return a.createElement("a",{className:"tag-action",role:"button",onClick:this._onRemoveClick},a.createElement("span",{className:"icon icon-cancel"}))},_onRemoveClick:function(e){e.stopPropagation(),this.props.onRemove(this.props.label)},_onClick:function(){if(this.props.link){var e=this.props.label.replace(/^#/,"");this.props.query&&(e=this.props.query+" "+e),www.navigate("/tags/"+e)}Events.trigger(Events.tag.select,{source:this,tag:this.props.label})}});t.exports=r},{classnames:"classnames",react:"react"}],168:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../../core/i18n"),n=r.gettext,o=e("@deezer/components/common/Selectbox"),l=a.createClass({displayName:"CuratorEditPlaylistTop",propTypes:{data:a.PropTypes.object.isRequired},getDefaultProps:function(){return{data:{}}},getInitialState:function(){var e=window.storage.isset("playlist_genre_curator")?Number(window.storage.get("playlist_genre_curator").data):0,t=window.storage.isset("playlist_country_curator")?window.storage.get("playlist_country_curator").data:this.props.data.country[0],s=window.storage.isset("playlist_source_curator")?window.storage.get("playlist_source_curator").data:"charts_playlist";return{available_playlist:[],selected_playlist:[],searched_playlist:[],source_playlist:s,filter:"",genre:e,country:t,sort:"sortTitle",selected_order:!1,load_more:!0}},componentDidMount:function(){this._getPlaylist(),window.setTimeout(function(){this._refreshScrollbar()}.bind(this),0)},componentDidUpdate:function(e,t){(this.state.available_playlist.length!==t.available_playlist.length||this.state.selected_playlist.length!==t.selected_playlist.length)&&this._refreshScrollbar()},render:function(){return a.createElement("div",null,a.createElement("div",{className:"modal-header"},n("Organiser le Top Playlists")),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"columns"},a.createElement("div",{className:"column column-left"},a.createElement("div",{className:"curator-title"},n("Playlists disponibles")),a.createElement("div",{className:"curator-table-search"},a.createElement("div",{className:"form-horizontal",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Rechercher"),onChange:this._onFilter,value:this.state.filter}),a.createElement(o,{type:"playlist_curator",position:"",saveOrder:!1,onChange:this._onChangeSort})),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-radio"},a.createElement("label",null,a.createElement("input",{type:"radio",name:"playlist_source",value:"charts_playlist",onChange:this._onSelectPlaylistSource,checked:"charts_playlist"===this.state.source_playlist}),a.createElement("span",null,n("Afficher les Top playlists"))))),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-radio"},a.createElement("label",null,a.createElement("input",{type:"radio",name:"playlist_source",value:"user_playlist",onChange:this._onSelectPlaylistSource,checked:"user_playlist"===this.state.source_playlist}),a.createElement("span",null,n("Afficher mes playlists"))))))),a.createElement("div",{className:"curator-table nano",ref:"available_scroll"},a.createElement("div",{className:"nano-content"},this._filterPlaylistSource().map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.filter.toLowerCase())>-1?a.createElement("div",{key:"playlist_available_"+e.PLAYLIST_ID+"_"+t,className:"line line-blue ellipsis",onClick:this._onMove.bind(this,e,"left",t)},a.createElement("span",{className:"icon icon-add pull-right"}),a.createElement("span",null,e.TITLE)):!1}.bind(this)),"charts_playlist"===this.state.source_playlist&&""!==this.state.filter&&this.state.load_more?a.createElement("button",{className:"btn btn-primary pull-right",type:"button",onClick:this._onSearchPlaylist},a.createElement("span",{className:"label"},n("Chercher dans toutes les playlists"))):null))),a.createElement("div",{className:"column column-right"},a.createElement("div",{className:"curator-title"},n("Top Playlists")+" ("+this.state.selected_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-horizontal form-select-genre"},a.createElement("div",{className:"form-group",role:"form"},a.createElement("span",{className:"control-label"},n("Choisis un pays :")),a.createElement("select",{className:"form-control",onChange:this._onChangeTopPlaylist.bind(this,"country"),value:this.state.country},this.props.data.country.map(function(e,t){return a.createElement("option",{key:"country_"+t,value:e},e)}))),a.createElement("div",{className:"form-group form-select-genre",role:"form"},a.createElement("span",{className:"control-label"},n("Choisis un genre :")),a.createElement("select",{className:"form-control",onChange:this._onChangeTopPlaylist.bind(this,"genre"),value:this.state.genre},this.props.data.genre.map(function(e,t){return a.createElement("option",{key:"genre_"+t,value:Number(e.GENRE_ID)},e.GENRE_NAME)}))))),a.createElement("div",{className:"curator-table-search table-order-playlist"},a.createElement("div",{className:"curator-table nano",ref:"selected_scroll"},a.createElement("div",{className:"nano-content"},this.state.selected_playlist.map(function(e,t){return a.createElement("div",{key:"playlist_selected_"+e.PLAYLIST_ID+"_"+t,className:"line"},a.createElement("span",{className:"icon icon-cancel pull-right",onClick:this._onMove.bind(this,e,"right",t)}),a.createElement("div",{className:"form-radio"},a.createElement("label",{htmlFor:e.PLAYLIST_ID,className:"ellipsis"},a.createElement("input",{type:"radio",name:"order",id:e.PLAYLIST_ID,value:e.PLAYLIST_ID,onChange:this._onSelectElement.bind(this,t),checked:t===this.state.selected_order}),e.TITLE)))}.bind(this)))),this.state.selected_order!==!1?a.createElement("div",{className:"order-playlist-actions"},a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onOrder.bind(this,"up")},a.createElement("span",{className:"icon icon-arrow-up-long"})),a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onOrder.bind(this,"down")},a.createElement("span",{className:"icon icon-arrow-down-long"}))):null))))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n("Fermer"))))))},_onSelectPlaylistSource:function(e){this.setState({source_playlist:e.target.value,searched_playlist:[]},this._getPlaylist),window.storage.set("playlist_source_curator",{data:e.target.value})},_onOrder:function(e){if(this.state.selected_order!==!1&&!(0===this.state.selected_order&&"up"===e||this.state.selected_order===this.state.selected_playlist.length-1&&"down"===e)){var t=this.state.selected_playlist.slice(0),s=this.state.selected_order+("up"===e?-1:1);t.splice(s,0,t.splice(this.state.selected_order,1)[0]),this.setState({selected_playlist:t,selected_order:s},this._onSave)}},_onSelectElement:function(e,t){t.stopPropagation(),this.setState({selected_order:e})},_onMove:function(e,t,s){var a=this.state.selected_playlist.slice(0);"left"===t?(this._hashSelectedPlaylist[e.PLAYLIST_ID]=!0,a.unshift(e)):"right"===t&&(delete this._hashSelectedPlaylist[e.PLAYLIST_ID],a.splice(s,1)),this.setState({selected_order:!1,selected_playlist:a},this._onSave)},_onFilter:function(e){this.setState({filter:e.target.value.toLowerCase(),searched_playlist:[],load_more:!0},function(){this._refreshScrollbar()}.bind(this))},_onSearchPlaylist:function(){0!==this.state.filter.length&&api.call({method:"deezer.getPlaylistByName",data:{query:this.state.filter,country:this.state.country},success:function(e){if(this.isMounted()){var t=[];e:for(var s=0,a=e.data.length;a>s;s++){for(var i=0,r=this.state.available_playlist.length;r>i;i++)if(e.data[s].PLAYLIST_ID===this.state.available_playlist[i].PLAYLIST_ID)continue e;t.push(e.data[s])}if(0===t.length)return this.setState({load_more:!1}),void alert(n("Aucun rsultat"));if(0!==this.state.genre){for(var o=!1,l=0,c=t.length;c>l;l++)t[l].GENRE.indexOf(String(this.state.genre))>-1&&(o=!0);o===!1&&alert(n("Aucun rsultat dans ce genre"))}this.setState({searched_playlist:t,load_more:!1})}}.bind(this)})},_onChangeTopPlaylist:function(e,t){var s={};s[e]="genre"===e?Number(t.target.value):t.target.value,s.selected_order=!1,s.filter="",this.setState(s,function(){this._getPlaylist(),this._refreshScrollbar()}.bind(this)),window.storage.set("playlist_"+e+"_curator",{data:t.target.value})},_onChangeSort:function(e){this.setState({sort:e})},_onSave:function(){for(var e=[],t=0,s=this.state.selected_playlist.length;s>t;t++)e.push(this.state.selected_playlist[t].PLAYLIST_ID);api.call({method:"deezer.setPlaylistTopCurated",data:{country:this.state.country,genre_id:this.state.genre,playlist:e}})},_onClose:function(){Events.trigger(Events.navigation.modal_close)},_hashSelectedPlaylist:{},_filterPlaylistSource:function(){for(var e=[],t=this.state.available_playlist.concat(this.state.searched_playlist),s=0,a=t.length;a>s;s++){var i=t[s].GENRE.length>0&&t[s].GENRE.indexOf(String(this.state.genre))>-1||0===this.state.genre;this._hashSelectedPlaylist[t[s].PLAYLIST_ID]!==!0&&i&&e.push(t[s])}return e.sort(this["_"+this.state.sort])},_getPlaylist:function(){api.call({method:"deezer.getPlaylistTopCurated",data:{genre_id:this.state.genre,country:this.state.country,top_charts:"charts_playlist"===this.state.source_playlist},success:function(e){if(this.isMounted()){this._hashSelectedPlaylist={};for(var t=0,s=e.PLAYLIST_EDITO.length;s>t;t++)this._hashSelectedPlaylist[e.PLAYLIST_EDITO[t].PLAYLIST_ID]=!0;for(var a=0,i=e.PLAYLIST_ADMIN.length;i>a;a++)this._hashSelectedPlaylist[e.PLAYLIST_ADMIN[a].PLAYLIST_ID]=!0;this.setState({available_playlist:"charts_playlist"===this.state.source_playlist?e.PLAYLIST_CHARTS:this._getUserPlaylist(),selected_playlist:e.PLAYLIST_EDITO})}}.bind(this)})},_getUserPlaylist:function(){var e=userData.data.PLAYLISTS.data.slice(0);return e.concat(userData.data.FAVORITES_PLAYLISTS.data)},_refreshScrollbar:function(){i(this.refs.available_scroll).nanoScroller(),i(this.refs.selected_scroll).nanoScroller()},_sortTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},_sortDate:function(e,t){var s=e.DATE_ADD||"",a=t.DATE_ADD||"";return s===a?0:a>s?1:-1}});t.exports=l},{"../../../../core/i18n":243,"@deezer/components/common/Selectbox":125,jquery:"jquery",react:"react"}],167:[function(e,t,s){"use strict";var a=e("react"),i=e("jquery"),r=e("../../../../core/i18n"),n=r.gettext,o=e("../../../common/Selectbox"),l=a.createClass({displayName:"CuratorEditPlaylistTag",propTypes:{data:a.PropTypes.array},getDefaultProps:function(){return{data:[]}},getInitialState:function(){var e=this._getDefaultGenre(),t=this._splitPlaylistData(e);return{available_playlist:t.available,selected_playlist:t.selected,available_filter:"",selected_filter:"",genre:e,sort:"sortTitle"}},componentDidMount:function(){this._idList={},window.setTimeout(function(){this._refreshScrollbar("available"),this._refreshScrollbar("selected")}.bind(this),0)},componentDidUpdate:function(e,t){this.state.available_playlist.length!==t.available_playlist.length&&this._refreshScrollbar("available"),this.state.selected_playlist.length!==t.selected_playlist.length&&this._refreshScrollbar("selected")},componentWillUnmount:function(){this._idList={}},render:function(){return a.createElement("div",null,a.createElement("div",{className:"modal-header"},n("Taguer par genre et moods")),a.createElement("div",{className:"modal-body"},a.createElement("div",{className:"wrapper"},a.createElement("div",{className:"wrapper-table"},a.createElement("div",{className:"cell"},n("Choisis un genre :")),a.createElement("div",{className:"cell"},a.createElement("select",{onChange:this._onChangeGenre,value:this.state.genre},this.props.data.map(function(e,t){return a.createElement("option",{key:"genre_"+t,value:Number(e.GENRE_ID)},e.GENRE_NAME)}),a.createElement("option",{key:"private",value:"private"},n("Playlist prive"))),a.createElement(o,{type:"playlist_curator",position:"center",saveOrder:!1,onChange:this._onChangeSort}))),a.createElement("div",{className:"columns"},a.createElement("div",{className:"column column-left"},a.createElement("div",{className:"curator-title"},n("Playlists disponibles")+" ("+this.state.available_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Filtrer"),onKeyUp:this._onFilter.bind(this,"available")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"available_scroll"},a.createElement("div",{className:"nano-content"},this.state.available_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.available_filter)>-1?a.createElement("div",{key:"playlist_available_"+t,className:"line line-blue ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"left",t)},a.createElement("span",{className:"icon icon-add pull-right"}),a.createElement("span",null,e.TITLE)):!1}.bind(this))))),a.createElement("div",{className:"column column-right"},a.createElement("div",{className:"curator-title"},n("Playlists par genre")+" ("+this.state.selected_playlist.length+")"),a.createElement("div",{className:"curator-table-search"},a.createElement("form",{className:"form-inline",role:"form"},a.createElement("div",{className:"form-group"},a.createElement("input",{className:"form-control",type:"text",placeholder:n("Filtrer"),onKeyUp:this._onFilter.bind(this,"selected")})),a.createElement("div",{className:"form-group"},a.createElement("span",{className:"icon icon-search"})))),a.createElement("div",{className:"curator-table nano",ref:"selected_scroll"},a.createElement("div",{className:"nano-content"},this.state.selected_playlist.map(function(e,t){return e.TITLE.toLowerCase().indexOf(this.state.selected_filter)>-1?a.createElement("div",{key:"playlist_selected_"+t,className:"line line-gray ellipsis",onClick:this._onMove.bind(this,e.PLAYLIST_ID,"right",t)},a.createElement("span",{className:"icon icon-add pull-right icon-cancel"}),a.createElement("span",null,e.TITLE)):!1}.bind(this)))))))),a.createElement("div",{className:"modal-footer"},a.createElement("div",{className:"action"},a.createElement("button",{className:"btn btn-default pull-left",type:"button",onClick:this._onClose},a.createElement("span",{className:"label"},n("Annuler"))),a.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._onSave.bind(this,!0)},a.createElement("span",{className:"label"},n("Valider"))))))},_onMove:function(e,t,s){var a="left"===t?"available_playlist":"selected_playlist",i="right"===t?"available_playlist":"selected_playlist",r=this.state[a].slice(0),n=this.state[i].slice(0),o=r.splice(s,1);n.push(o[0]),this.setState({selected_playlist:"available_playlist"===a?n:r,available_playlist:"selected_playlist"===i?r:n.sort(this["_"+this.state.sort])}),this._idList[e]="available_playlist"===a},_onFilter:function(e,t){var s={};s[e+"_filter"]=t.target.value.toLowerCase(),this.setState(s,function(){this._refreshScrollbar(e)}.bind(this))},_onChangeGenre:function(e){var t="object"==typeof e?e.target.value:e;if(window.countObject(this._idList)>0)return void this._onSave(!1,t);var s=this._splitPlaylistData(t);this.setState({genre:t,available_playlist:s.available,selected_playlist:s.selected,selected_filter:"",available_filter:""}),window.storage.set("playlist_edit_curator",{genre:t})},_onChangeSort:function(e){this.setState({sort:e,selected_playlist:this.state.selected_playlist.sort(this["_"+e]),available_playlist:this.state.available_playlist.sort(this["_"+e])})},_onSave:function(e,t){if(0===window.countObject(this._idList))return void(e&&this._onClose());var s=this.state.genre;api.call({method:"deezer.setPlaylistGenre",data:{id_list:this._idList,genre:s},success:function(a){if(a)for(var i in this._idList)if(this._idList.hasOwnProperty(i)){var r={};if("private"===s){if(r.STATUS=Number(this._hashPlaylist[i].STATUS),(1===r.STATUS||3===r.STATUS)&&this._idList[i])continue;if((0===r.STATUS||2===r.STATUS)&&!this._idList[i])continue;r.STATUS+=this._idList[i]?1:-1}else{if(!Array.isArray(this._hashPlaylist[i].GENRE))continue;var n=this._hashPlaylist[i].GENRE.indexOf(s);if(n>-1&&!this._idList[i])this._hashPlaylist[i].GENRE.splice(n,1);else{if(-1!==n||!this._idList[i])continue;this._hashPlaylist[i].GENRE.push(s)}r.GENRE=this._hashPlaylist[i].GENRE}userData.refreshPlaylistData(i,r)}this._idList={},e?this._onClose():this._onChangeGenre(t)}.bind(this)})},_onClose:function(){Events.trigger(Events.navigation.modal_close)},_idList:{},_hashPlaylist:{},_splitPlaylistData:function(e){for(var t=[],s=[],a=0;a<userData.data.PLAYLISTS.total;a++){var i=userData.data.PLAYLISTS.data[a];this._hashPlaylist[userData.data.PLAYLISTS.data[a].PLAYLIST_ID]=i;var r="private"===e&&(1===Number(i.STATUS)||4===Number(i.STATUS)),n="private"!==e&&Array.isArray(i.GENRE)&&i.GENRE.indexOf(e)>-1;r||n?s.push(i):("private"===e||gatekeeper.isAllowed("curator_edito")||gatekeeper.isAllowed("curator_local")||0===i.GENRE.length)&&t.push(i)}return{available:t,selected:s}},_refreshScrollbar:function(e){i(this.refs[e+"_scroll"]).nanoScroller()},_sortTitle:function(e,t){var s=e.TITLE.toLowerCase().trim(),a=t.TITLE.toLowerCase().trim();return s===a?0:s>a?1:-1},_sortDate:function(e,t){var s=e.DATE_ADD||"0000-00-00 00:00:00",a=t.DATE_ADD||"0000-00-00 00:00:00";return s===a?0:a>s?1:-1},_getDefaultGenre:function(){var e="playlist_edit_curator";return window.storage.isset(e)?window.storage.get(e).genre:this.props.data.length>0?this.props.data[0].GENRE_ID:0}});t.exports=l},{"../../../../core/i18n":243,"../../../common/Selectbox":125,jquery:"jquery",react:"react"}],125:[function(e,t,s){"use strict";var a=e("react"),i=e("../../core/i18n"),r=i.gettext,n=e("@deezer/components/common/DropDown"),o=a.createClass({displayName:"Selectbox",propTypes:{type:a.PropTypes.oneOf(["album","playlist","show","playlist_curator"]),position:a.PropTypes.oneOf(["right","left","center"]),saveOrder:a.PropTypes.bool,onChange:a.PropTypes.func},getDefaultProps:function(){return{type:"album",position:"right",saveOrder:!0,onChange:function(){}}},render:function(){var e=a.createElement("span",{className:"icon icon-list"});return a.createElement(n,{style:"mini","default-label":e,position:this.props.position},this._getElement().map(function(e,t){return a.createElement(n.Item,{key:t},a.createElement("a",{href:"#",onClick:this._onChange.bind(this,e.type)},e.label))}.bind(this)))},_onChange:function(e,t){if(t.preventDefault(),this._sortType=e,this.props.onChange(this._sortType),this.props.saveOrder){var s={};s["sort_panel_"+this.props.type]=this._sortType,userSetting.set({site:s})}},_sortType:"",_getElement:function(){var e={album:[{type:"ART_NAME",label:r("A - Z (artiste)")},{type:"ALB_TITLE",label:r("A - Z (album)")},{type:"DATE_CREATE",label:r("Ajouts rcemment")},{type:"TOP_ALBUM",label:r("Les plus couts")}],show:[{type:"SHOW_NAME",label:r("A - Z")},{type:"DATE_FAVORITE",label:r("Ajouts rcemment")}],playlist:[{type:"PLAYLIST_TITLE",label:r("A - Z")},{type:"DATE_UPDATE",label:r("Mises  jour rcemment")},{type:"DATE_CREATE",label:r("Ajoutes rcemment")},{type:"PLAYLIST_TYPE",label:r("Type")},{type:"TOP_PLAYLIST",label:r("Les plus coutes")}],playlist_curator:[{type:"sortTitle",label:r("A - Z")},{type:"sortDate",label:r("Mises  jour rcemment")}]};return e[this.props.type]?e[this.props.type]:[]}});t.exports=o},{"../../core/i18n":243,"@deezer/components/common/DropDown":117,react:"react"}],243:[function(e,t,s){"use strict";var a=e("i18next-client"),i={init:function(){var e=window.SETTING_LOCALE?window.SETTING_LOCALE.toLowerCase().substr(0,2):"en";a.init({debug:!1,resStore:window.translation,lng:e,fallbackLng:!1,useCookie:!1,lowerCaseLng:!0,keyseparator:"::",nsseparator:":::",postProcess:"sprintf"})},gettext:function(e,t){if(!arguments.length||!arguments[0])throw new Error("_() called with empty key");return t=t||{},a.t(e,t)},ngettext:function(e,t,s){if(!arguments.length||arguments.length<3)throw new Error("ngettext() called with incorrect number of arguments",arguments);if("undefined"==typeof s.count)throw new Error('ngettext() called with no "count" attribute',arguments);var i=parseInt(s.count,10);return"undefined"!=typeof s.sprintf?a.t(e,{count:i,postProcess:"sprintf",sprintf:s.sprintf}):a.t(e,{count:i})}};t.exports=i},{"i18next-client":"i18next-client"}],117:[function(e,t,s){"use strict";t.exports=e("./DropDown")},{"./DropDown":115}],115:[function(e,t,s){"use strict";var a=e("react"),i=e("classnames"),r=e("./_elements/Item"),n=a.createClass({displayName:"DropDown",propTypes:{position:a.PropTypes.oneOf(["right","left","center"]),style:a.PropTypes.oneOf(["mini"]),"default-label":a.PropTypes.node,selected:a.PropTypes.number,children:a.PropTypes.arrayOf(a.PropTypes.node).isRequired},getDefaultProps:function(){return{selected:0}},getInitialState:function(){return{label:this.props.children[this.props.selected].props.label||this.props["default-label"],isOpen:!1}},componentWillReceiveProps:function(e){this.setState({label:e.children[e.selected].props.label||e["default-label"]})},render:function(){var e=this._getClasses(),t=e.containerClasses,s=e.buttonClasses,i=e.iconClasses,r=this.state.label;return"object"!=typeof r&&(r=a.createElement("span",{className:"label"},r)),a.createElement("span",{className:t},a.createElement("button",{className:s,type:"button",onClick:this._toggle},r,a.createElement("span",{className:i})),a.createElement("ul",{className:"dropdown-menu"},this.props.children))},_onClose:function(){document.removeEventListener("click",this._onClose),this.setState({isOpen:!1})},_toggle:function(){var e=!this.state.isOpen;this.setState({isOpen:e}),e&&document.addEventListener("click",this._onClose)},_getClasses:function(){return{containerClasses:i({"selectbox dropdown":!0,opened:this.state.isOpen,"pull-right":"right"===this.props.position,"pull-left":"left"===this.props.position}),buttonClasses:i({"btn btn-default dropdown-toggle":!0,"btn-mini":"mini"===this.props.style}),iconClasses:i({"icon icon-sort-desc color-primary":!0,"icon-sort-desc":"mini"===this.props.style,"icon-chevron-down":"mini"!==this.props.style})}}});n.Item=r,t.exports=n},{"./_elements/Item":116,classnames:"classnames",react:"react"}],116:[function(e,t,s){"use strict";var a=e("react"),i=a.createClass({displayName:"Item",propTypes:{children:a.PropTypes.node.isRequired},render:function(){return a.createElement("li",null,this.props.children)}});t.exports=i},{react:"react"}],235:[function(e,t,s){"use strict";var a=e("babel-runtime/core-js/object/keys")["default"];!function(){var e=["image/jpeg","image/png"],s=function(t){this._element=t,this._imgTag=!("IMG"!==this._element.tagName),this._url=this._element.getAttribute(this._imgTag?"src":"data-blurred"),this._mimeType=e[0],this._blurStrength=5,this._imgContainer=null,this._loadError=!1,this._callback=function(){}};s.prototype.setBlurStrength=function(e){return this._blurStrength=parseInt(e,10),this},s.prototype.setMimeType=function(t){return this._mimeType=~e.indexOf(t)?t:this._mimeType,this},s.prototype.setUrl=function(e){return this._url=e,this},s.prototype.setCallback=function(e){return this._callback="function"==typeof e?e:this._callback,this},s.prototype.render=function(){var e=document.createElement("canvas");if(!(!e.getContext||!e.getContext("2d"))==!1)return this._imgTag?this._element.src=this._url:this._element.style.backgroundImage="url("+this._url+")",this._callback();var t=new Image;t.crossOrigin="Anonymous";var s=this;t.onerror=function(){return s._imgContainer=this,s._loadError=!0,e.parentNode&&document.body.removeChild(e),s._imgTag?s._element.src=s._url:s._element.style.backgroundImage="url("+s._url+")",s._callback()},t.onload=function(){s._imgContainer=this;var a=this.width,i=this.height;e.setAttribute("width",a),e.setAttribute("height",i),e.setAttribute("style","image-rendering: optimizeSpeed;image-rendering: -moz-crisp-edges;image-rendering: -webkit-optimize-contrast;image-rendering: optimize-contrast;-ms-interpolation-mode: nearest-neighbor;"),e=document.body.appendChild(e);var r=e.getContext("2d"),n=r.canvas.width,o=r.canvas.height;r.drawImage(t,n/2-a/2,o/2-i/2),r.globalAlpha=.5;for(var l=-s._blurStrength;l<=s._blurStrength;l+=2)for(var c=-s._blurStrength;c<=s._blurStrength;c+=2)r.drawImage(e,c,l),c>=0&&l>=0&&r.drawImage(e,-(c-2.5),-(l-2.5));r.globalAlpha=1;var p;try{p=r.canvas.toDataURL(s._mimeType)}catch(d){p=s._url}return document.body.removeChild(e),s._imgTag?s._element.src=p:s._element.style.backgroundImage="url("+p+")",s._callback()},t.src=this._url},s.prototype.getProps=function(e){if(this._element){e!==Object(e)&&(e=[(e||"").toString()]);var t={};for(var s in e)this.hasOwnProperty("_"+e[s])&&(t[e[s]]=this["_"+e[s]]);return 1===a(t).length&&1===e.length?t[e[0]]:t}},s.prototype.destroy=function(){this._element&&(this._imgTag?this._element.src=this._url:this._element.style.backgroundImage=this._url)},"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof t&&t&&"object"==typeof t.exports&&t.exports?t.exports=s:window.Blurred=s}()},{"babel-runtime/core-js/object/keys":285}],285:[function(e,t,s){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":298}],298:[function(e,t,s){e("../../modules/es6.object.keys"),t.exports=e("../../modules/$.core").Object.keys},{"../../modules/$.core":304,"../../modules/es6.object.keys":319}],319:[function(e,t,s){var a=e("./$.to-object");e("./$.object-sap")("keys",function(e){return function(t){return e(a(t))}})},{"./$.object-sap":313,"./$.to-object":316}],316:[function(e,t,s){var a=e("./$.defined");t.exports=function(e){return Object(a(e))}},{"./$.defined":307}],307:[function(e,t,s){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],313:[function(e,t,s){t.exports=function(t,s){var a=e("./$.def"),i=(e("./$.core").Object||{})[t]||Object[t],r={};r[t]=s(i),a(a.S+a.F*e("./$.fails")(function(){i(1)}),"Object",r)}},{"./$.core":304,"./$.def":306,"./$.fails":308}],308:[function(e,t,s){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],306:[function(e,t,s){var a=e("./$.global"),i=e("./$.core"),r="prototype",n=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t,s){var l,c,p,d,u=e&o.G,h=e&o.P,m=u?a:e&o.S?a[t]:(a[t]||{})[r],_=u?i:i[t]||(i[t]={});u&&(s=t);for(l in s)c=!(e&o.F)&&m&&l in m,c&&l in _||(p=c?m[l]:s[l],u&&"function"!=typeof m[l]?d=s[l]:e&o.B&&c?d=n(p,a):e&o.W&&m[l]==p?!function(e){d=function(t){return this instanceof e?new e(t):e(t)},d[r]=e[r]}(p):d=h&&"function"==typeof p?n(Function.call,p):p,_[l]=d,h&&((_[r]||(_[r]={}))[l]=p))};o.F=1,o.G=2,o.S=4,o.P=8,o.B=16,o.W=32,t.exports=o},{"./$.core":304,"./$.global":309}],309:[function(e,t,s){var a=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=a)},{}],304:[function(e,t,s){var a=t.exports={version:"1.2.3"};"number"==typeof __e&&(__e=a)},{}]},{},[]);;
require=function e(t,a,n){function r(i,o){if(!a[i]){if(!t[i]){var l="function"==typeof require&&require;if(!o&&l)return l(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=a[i]={exports:{}};t[i][0].call(u.exports,function(e){var a=t[i][1][e];return r(a?a:e)},u,u.exports,e,t,a,n)}return a[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({7:[function(e,t,a){"use strict";var n=e("../core/i18n");n.init(),window.gettext=n.gettext,window.ngettext=n.ngettext;var r=e("../widget/player"),s=e("../widget/HTML5Player"),i=e("../tools/waveformTrack"),o=e("../core/util"),l=e("../models/track");window.widget=r,window.HTML5Player=s,window.util=o,window.Track=l,window.WaveformTrack=i,window.DZ_WAVEFORM_API_CALLBACK=function(){}},{"../core/i18n":243,"../core/util":248,"../models/track":250,"../tools/waveformTrack":276,"../widget/HTML5Player":277,"../widget/player":278}],278:[function(e,t,a){"use strict";var n=e("react"),r=e("react-dom"),s=e("jquery"),i=e("../components/widget/Widget"),o={title:"Widget Deezer",lines:[],options:null,widget_type:null,TYPES:{SMART:"smart_radio",RADIO:"radio",PLAYLIST:"playlist",ALBUM:"album",USER_TOP:"user",CHARTS:"charts",FAVORITES:"favorites",SONGS:"songs"},app_id:1,nb_items:500,total_result:0,currentSongIndex:0,currentSongTime:0,currentSong:null,playerType:"mod",playerId:null,datagridTpl:null,swfLoaded:!1,HTML5PlayerLoaded:!1,tracksLoaded:!1,playerLoaded:!1,loadingTimeout:null,drawPlayer:!0,standAlone:!0,loadParams:[],widgetComponent:null,init:function(e){if(this.options=s.extend({width:e.widgetOptions.width,height:e.widgetOptions.height,drawPlayer:!0},e.widgetOptions),this.drawPlayer=this.options.drawPlayer,this.options.standAlone="undefined"==typeof e.channelUrl,"undefined"!=typeof e.widgetOptions.app_id&&(o.app_id=e.widgetOptions.app_id),this.drawPlayer){this.options.standAlone&&(this.loadingTimeout=window.setTimeout(function(){s("#loading_overlay").show()},300));var t=this.options,a=document.getElementById("widget-player");a&&(this.widgetComponent=r.render(n.createElement(i,t),a))}else Events.subscribe(Events.player.track_end,o.onPlayerTrackEnd);if(Events.subscribe(Events.player.playerLoaded,o.callbackSWFLoaded),Events.subscribe(Events.player.position,o.onPositionChanged),Events.subscribe(Events.player.displayCurrentSong,o.displayCurrentSong),loadFacebox=function(){},this.options.standAlone?("charts"===this.options.type&&(o.title=this.options.title,o.nb_items=25),Events.subscribe(Events.player.playerLoaded,o.loadTracksOption),o.options.app_type="widget"):o.options.app_type="app",o.options.app_id=o.app_id,window.MOBILE_PLATFORM===!1){dzPlayer.setApp({id:o.options.app_id,type:o.options.app_type});var l=dzPlayer.initSoPlayer("core_player");l===!1&&this.drawPlayer&&(s("#loading_overlay").hide(),s("#flash_overlay").show())}else o.loadHtml5Player();return!0},displayCurrentSong:function(){try{o.currentSongIndex=dzPlayer.getTrackListIndex(),o.currentSong=dzPlayer.getCurrentSong(),o.currentSongTime=0}catch(e){error.log(e)}},onPositionChanged:function(e,t){o.currentSongTime=t},onPlayerTrackEnd:function(){try{return dzPlayer.control.nextSong(!0),!0}catch(e){error.log(e)}},login:{loginButton:null,loginURL:SETTING_HOST_CONNECT+"/login.php?format=popup",addBtn:function(){o.login.loginButton=s("#login"),o.standAlone||o.login.loginButton.css("opacity",.2),"0"===USER.USER_ID&&o.standAlone?o.login.loginButton.click(o.login.popup):"0"!==USER.USER_ID&&o.login.loginButton.tipsy({gravity:"e",fallback:USER.BLOG_NAME})},popup:function(){var e="undefined"!=typeof window.screenX?window.screenX:window.screenLeft,t="undefined"!=typeof window.screenY?window.screenY:window.screenTop,a="undefined"!=typeof window.outerWidth?window.outerWidth:document.documentElement.clientWidth,n="undefined"!=typeof window.outerHeight?window.outerHeight:document.documentElement.clientHeight-22,r=645,s=385,i=e+a/2-r/2,l=t+n/2-s/2;return o.login.loginURL+="&app_id="+o.app_id+"&callbackmethod=widget.onlogin",window.open(o.login.loginURL,"login","top="+l+",left="+i+",width="+r+",height="+s+",location=no, scrollbars=no")}},onlogin:function(){return window.location.reload(),!0},song_filter:["ALB_ID","ALB_PICTURE","ALB_TITLE","ART_ID","ART_NAME","DATE_START","DATE_START_PREMIUM","DURATION","FAN_ONLY","FILESIZE","FILESIZE_MP3_128","FILESIZE_MP3_256","FILESIZE_MP3_320","MD5_ORIGIN","MEDIA_VERSION","RANK_SNG","SMARTRADIO","SNG_ID","SNG_TITLE","STATUS","S_MOD","S_PREMIUM","URL_REWRITING","TYPE","RIGHTS","FALLBACK","UPLOAD_ID","USER_ID"],loadTracksOption:function(){var e=0,t=0;"undefined"!=typeof o.options.popup&&o.options.popup&&(o.options.autoplay=!0,e=o.options.current_song_index,t=o.options.current_song_time);var a,n,r;switch(o.options.type){case"playlist":o.loadPlaylist(o.options.id,function(){},o.options.autoplay,e,t);break;case"album":o.loadAlbum(o.options.id,function(){},o.options.autoplay,e,t);break;case"tracks":case"songList":a=o.options.id.split(","),n=[];for(var s=0;s<a.length;s++)r=1*a[s],n.push(r);o.loadSongs(n,function(){},o.options.autoplay);break;case"radio":o.loadRadio(o.options.id,function(){},o.options.autoplay);break;case"charts":"user_"===o.options.id.substring(0,"user_".length)?(o.options.id=o.options.id.substring("user_".length),o.loadUserTop(o.options.id,function(){},o.options.autoplay,e,t)):o.loadCharts(o.options.id,function(){},o.options.autoplay,e,t);break;case"favorites":o.options.id=o.options.id.substring("user_".length),o.loadUserFavorites(o.options.id,function(){},o.options.autoplay,e,t)}},loadSongs:function(e,t,a,n,r,s){return 0===e.length?void o.callbackTracksError():(this.checkLoadParams(t,a,n,r,s),o.playerId=e.join("|"),o.widget_type=o.TYPES.SONGS,void api.call({method:"song.getListData",data:{array_default:o.song_filter,sng_ids:e,start:0,nb:o.nb_items,tags:!1,lang:SETTING_LANG},success:function(e,t){var a=o.lines.length;o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time,o.loadParams.queue,a)},error:o.callbackTracksError,callback_parameters:{type:"playTracks",index:o.loadParams.index,start_time:o.loadParams.start_time,queue:o.loadParams.queue}}))},loadAlbum:function(e,t,a,n,r){return isNaN(e)?o.callbackTracksError():(this.checkLoadParams(t,a,n,r),o.playerId=e,o.widget_type=o.TYPES.ALBUM,void api.call({method:"deezer.pageAlbum",data:{alb_id:e,lang:SETTING_LANG,header:!0,tab:12},success:function(e,t){o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:"playAlbum",callback:o.loadParams.callback,autoplay:o.loadParams.autoplay,index:o.loadParams.index}}))},loadPlaylist:function(e,t,a,n,r){return isNaN(e)?o.callbackTracksError():(this.checkLoadParams(t,a,n,r),o.playerId=e,o.widget_type=o.TYPES.PLAYLIST,void api.call({method:"deezer.pagePlaylist",data:{playlist_id:e,start:0,nb:o.nb_items,tags:!1,lang:SETTING_LANG},success:function(e,t){o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:"playPlaylist",index:o.loadParams.index,start_time:o.loadParams.start_time}}))},loadRadio:function(e,t,a,n,r){this.checkLoadParams(t,a,n,r);var s=e.split("-"),i=s[1];if(isNaN(i))return o.callbackTracksError();var l="radio"===s[0]?0:1;o.playerType=0===l?"radio":"smartRadio",o.playerId=i,o.widget_type=0===l?o.TYPES.RADIO:o.TYPES.SMART;var c=o.widget_type===o.TYPES.RADIO?"playRadio":"playSmartRadio";api.call({method:"deezer.pageRadio",data:{array_default:o.song_filter,ID:i,TYPE:0===l?"genre":"artist",SONGS:!0},success:function(e,t){e.ID=i,o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:c,index:0}})},loadUserTop:function(e,t,a,n,r){return isNaN(e)?o.callbackTracksError():(this.checkLoadParams(t,a,n,r),o.playerId=this.options.id,o.widget_type=o.TYPES.USER_TOP,void api.call({method:"charts.getUserSongs",data:{array_default:o.song_filter,user_id:e,nb:o.nb_items,start:0},success:function(e,t){o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:"playCharts",index:o.loadParams.index,start_time:o.loadParams.start_time}}))},loadCharts:function(e,t,a,n,r){return isNaN(e)?o.callbackTracksError():(this.checkLoadParams(t,a,n,r),o.widget_type=o.TYPES.CHARTS,void api.call({method:"charts.getTrack",data:{array_default:o.song_filter,nb:o.nb_items,start:0,tag_id:e},success:function(e,t){o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:"playCharts",index:0}}))},loadUserFavorites:function(e,t,a,n,r){return isNaN(e)?o.callbackTracksError():(this.checkLoadParams(t,a,n,r),o.playerId=this.options.id,o.widget_type=o.TYPES.FAVORITES,void api.call({method:"favorite.song_getList",data:{array_default:o.song_filter,user_id:e,nb:o.nb_items,start:0},success:function(e,t){o.callbackTracksLoaded(e,t),o.loadParams.callback(o.lines),o.playCallback(o.loadParams.autoplay,o.loadParams.index,o.loadParams.start_time)},error:o.callbackTracksError,callback_parameters:{type:"playFavorites",index:o.loadParams.index,start_time:o.loadParams.start_time}}))},checkLoadParams:function(e,t,a,n,r){o.loadParams={callback:"function"!=typeof e?function(){}:e,autoplay:t||!1,index:a||0,start_time:n||null,queue:"boolean"!=typeof r?!1:r}},playCallback:function(e,t,a,n,r){"boolean"!=typeof n&&(n=!1),"number"!=typeof r&&(r=0),t>o.lines.length&&(t=0),"undefined"!=typeof a&&null!==a&&0!==a&&t<o.lines.length&&(o.lines[t].OFFSET=a);var i=o.lines.slice(n?r:0);if(0===i.length)return o.drawPlayer&&o.standAlone&&s("#error_overlay").show(),Events.trigger(Events.player_widget.tracksLoaded,o.lines),!1;switch(o.widget_type){case o.TYPES.PLAYLIST:case o.TYPES.ALBUM:case o.TYPES.SONGS:case o.TYPES.CHARTS:case o.TYPES.FAVORITES:case o.TYPES.USER_TOP:n?dzPlayer.setTrackList({data:i},!0,!1):dzPlayer.play({data:i,index:t,autoplay:e});break;case o.TYPES.RADIO:dzPlayer.play({type:"radio",radio:!0,data:i,index:t,id:o.playerId,autoplay:e});break;case o.TYPES.SMART:dzPlayer.play({type:"artist",radio:!0,data:i,index:t,id:o.playerId,autoplay:e})}Events.trigger(Events.player_widget.tracksLoaded,o.lines)},callbackTracksError:function(){return o.drawPlayer&&o.standAlone&&(s("#error_overlay").show(),window.clearTimeout(o.loadingTimeout),s("#loading_overlay").hide()),!0},callbackTracksLoaded:function(e,t){var a=[],l="";switch(t.type){case"playAlbum":l=e.DATA.ALB_TITLE+" - "+e.DATA.ART_NAME,a=o.filterTracks(e.SONGS.data),this.options.currentPlay.cover="cover/"+e.DATA.ALB_PICTURE;break;case"playPlaylist":l=e.DATA.TITLE+" - "+e.DATA.PARENT_USERNAME,a=o.filterTracks(e.SONGS.data),this.options.currentPlay.cover=e.DATA.PICTURE_TYPE+"/"+e.DATA.PLAYLIST_PICTURE;break;case"playTracks":a=o.filterTracks(e.data),a.length>0&&(this.options.currentPlay.cover="cover/"+a[0].ALB_PICTURE);break;case"playSmartRadio":l="Radio - "+e.DATA.ART_NAME,a=o.filterTracks(e.SONGS.data),"undefined"!=typeof e.CUSTO&&"undefined"!=typeof e.CUSTO.BACKGROUND_PICTURE?this.options.currentPlay.cover="misc/"+e.CUSTO.BACKGROUND_PICTURE:a.length>0&&(this.options.currentPlay.cover="cover/"+a[0].ALB_PICTURE);break;case"playRadio":l="Radio - "+e.DATA.TITLE,a=o.filterTracks(e.SONGS.data),"undefined"!=typeof e.DATA&&"undefined"!=typeof e.DATA.RADIO_PICTURE&&(this.options.currentPlay.cover="misc/"+e.DATA.RADIO_PICTURE);break;case"playCharts":a=o.filterTracks(e.data),l=o.options.title+" top charts",a.length>0&&(this.options.currentPlay.cover="cover/"+a[0].ALB_PICTURE);break;case"playFavorites":a=o.filterTracks(e.data),l=o.options.title+" loved tracks",a.length>0&&(this.options.currentPlay.cover="cover/"+a[0].ALB_PICTURE)}if("boolean"==typeof t.queue&&t.queue){for(var c=o.lines.slice(),u={},d=0;d<c.length;d++)u["ID_"+c[d].SNG_ID]=!0;for(d=0;d<a.length;d++)"undefined"==typeof c["ID_"+a[d].SNG_ID]&&c.push(a[d]);o.lines=c}else o.lines=a;if(o.total_result=o.lines.length,o.title=l,o.drawPlayer&&window.MOBILE_PLATFORM===!1){this.options.tracks=o.lines,null!==this.widgetComponent&&(this.widgetComponent=null,r.unmountComponentAtNode(document.getElementById("widget-player")));var p=this.options,m=document.getElementById("widget-player");m&&(this.widgetComponent=r.render(n.createElement(i,p),m)),o.standAlone&&(window.clearTimeout(o.loadingTimeout),s("#loading_overlay").hide())}o.tracksLoaded=!0},filterTracks:function(e){for(var t=[],a=0;a<e.length;a++)"JINGLE"===e[a].TYPE&&(e[a].SNG_ID="JINGLE_"+a),"object"==typeof e[a].FALLBACK&&(e[a].FALLBACK.REPLACED_SNG_ID=e[a].FALLBACK.SNG_ID,e[a].FALLBACK.SNG_ID=e[a].SNG_ID,e[a]=e[a].FALLBACK),right.checkSongAvailable(e[a])===right.READABLE&&t.push(e[a]);return t},handlePlayPause:function(e,t,a){e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation());var n=dzPlayer.getPlayerType(),r=dzPlayer.isMuted(),s=dzPlayer.isFadeInProgress(),i=dzPlayer.isFadeOutProgress();a=a||dzPlayer.isPlaying(),a=a?!("radio"===n&&r):a,a||0!==dzPlayer.logListenId||DZPS||dzPlayer.logStartListen(),"radio"===n||"follower"===n?s||i||(dzPlayer.control.mute(a),a||dzPlayer.control.play()):dzPlayer.control[a?"pause":"play"]()},setVolume:function(e,t){isNaN(e)||(t=Boolean(t),dzPlayer.control.setVolume(e/100,t),t&&Events.trigger(Events.player.volume,e/100))},muteVolume:function(){dzPlayer.isFadeInProgress()||dzPlayer.isFadeOutProgress()||dzPlayer.control.mute(!dzPlayer.isMuted())},callbackSWFLoaded:function(){o.swfLoaded=!0,o.tracksLoaded===!0&&o.initPlayer(),restrict.init(),dzPlayer.initRestriction(),Events.trigger(Events.player_widget.loaded)},loadHtml5Player:function(){return dzPlayer.trigger=function(e,t){t=t||[],HTML5Player.callMethod(e,t)},right.checkSongAvailable=function(){return right.READABLE},HTML5Player.init(),o.HTML5PlayerLoaded=!0,o.tracksLoaded===!0&&o.initPlayer(),!0},initPlayer:function(){if("undefined"!=typeof o.options.popup&&o.options.popup){for(var e=o.options.current_song_id,t=0;t<o.lines.length;t++)if(o.lines[t].SNG_ID===e){o.lines[t].OFFSET=o.options.current_song_time;break}o.options.autoplay=!0}}};t.exports=o},{"../components/widget/Widget":217,jquery:"jquery",react:"react","react-dom":"react-dom"}],217:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("./_elements/player/Player"),i=e("./_elements/playlist/Playlist"),o=e("./_elements/Cover"),l=e("./_elements/Overlay"),c=e("../../widget/restrictMode"),u=e("../_mixins/widget/duration"),d=e("../_mixins/widget/resize"),p=e("../_mixins/widget/player/song"),m=n.createClass({displayName:"Widget",propTypes:{format:n.PropTypes.oneOf(["classic","square"]),size:n.PropTypes.oneOf(["small","medium","big"]),overlay:n.PropTypes.bool,playlist:n.PropTypes.bool,popup:n.PropTypes.bool},mixins:[u,d,p],getInitialState:function(){return{format:"classic",size:"medium",playlist:!1,layout:""}},componentWillMount:function(){var e=this.state;null!==e.width&&delete e.width;for(var t in e)this.props[t]&&(e[t]=this.props[t]);"undefined"!=typeof this.props.playlist&&this.props.playlist===!0&&"square"!==this.state.format&&"small"!==this.state.size&&(e.playlist=this.props.playlist),"undefined"!=typeof this.props.layout&&"dark"===this.props.layout&&(e.layout="dark"),"undefined"!=typeof this.props.popup&&this.props.popup===!0&&"undefined"!=typeof this.props.current_song_time&&(e.currentDuration=parseInt(this.props.current_song_time,10)),this.setState(e)},componentDidMount:function(){window.addEventListener("resize",this.handleResize),Events.subscribe(Events.live.simultaneousAccess,this._onSimultaneousAccess)},shouldComponentUpdate:function(e,t){return this.state.currentDuration!==t.currentDuration||this.state.progress!==t.progress||this.state.simultaneousAccess!==t.simultaneousAccess||this.state.overlayReason!==t.overlayReason||this.state.currentPlay.id!==t.currentPlay.id||this.state.forceUpdateResize!==t.forceUpdateResize},componentDidUpdate:function(){var e=Math.floor(dzPlayer.getPosition());if(c.isRestrictMode()===!0&&e>=c.restrictDuration){var t="restrictMode";c.isD4A()===!0&&(t="d4a",widget.handlePlayPause(null,null,!0)),this._handleOverlay(t)}},componentWillUnmount:function(){window.removeEventListener("resize",this.handleResize),Events.unsubscribe(Events.live.simultaneousAccess,this._onSimultaneousAccess)},render:function(){var e,t=r({widgets:!0,"widgets-small":"small"===this.state.size,"widgets-medium":"medium"===this.state.size||"big"===this.state.size&&"classic"===this.state.format,"widgets-big":"big"===this.state.size&&"classic"!==this.state.format,"widgets-dark":"dark"===this.state.layout}),a=r({"widgets-classic":"classic"===this.state.format,"widgets-square":"square"===this.state.format});"classic"===this.state.format&&(e=n.createElement(s,{format:this.state.format,size:this.state.size,currentPlay:this.state.currentPlay,handleOverlay:this._handleOverlay}));var c;return this.state.playlist===!0&&"radio"!==dzPlayer.getPlayerType()&&"radio"!==widget.options.type&&(c=n.createElement(i,{currentPlay:this.state.currentPlay,tracks:this.props.tracks,type:this.props.type,format:this.state.format})),n.createElement("div",{className:t},n.createElement(l,{reason:this.state.overlayReason,handleOverlay:this._handleOverlay,size:this.state.size}),n.createElement("div",{className:a,id:"widget-player-interaction"},n.createElement("section",{className:"widget"},n.createElement(o,{format:this.state.format,size:this.state.size,currentPlay:this.state.currentPlay,dimension:this.state.width,play:this.props.autoplay,handleOverlay:this._handleOverlay}),e)),c)},_onSimultaneousAccess:function(){widget.handlePlayPause(null,null,!0),this._handleOverlay("simultaneousAccess")},_handleOverlay:function(e){this.setState({overlayReason:e})}});t.exports=m},{"../../widget/restrictMode":279,"../_mixins/widget/duration":45,"../_mixins/widget/player/song":49,"../_mixins/widget/resize":52,"./_elements/Cover":218,"./_elements/Overlay":220,"./_elements/player/Player":222,"./_elements/playlist/Playlist":232,classnames:"classnames",react:"react"}],232:[function(e,t,a){"use strict";var n=e("react"),r=e("jquery"),s=e("classnames"),i=e("@deezer/components/widget/_elements/playlist/_elements/Info"),o=e("@deezer/components/widget/_elements/playlist/_elements/Track"),l=n.createClass({displayName:"Playlist",getDefaultProps:function(){return{format:"classic"}},getInitialState:function(){var e=[],t=0;return"undefined"!=typeof this.props.tracks&&this.props.tracks.length>0&&(this.props.tracks.map(function(e){t+=parseInt(e.DURATION,10)}),e=this.props.tracks),{tracks:e,totalDuration:t,tracklistHeight:"auto",tracklistOverflow:"none"}},componentDidMount:function(){window.addEventListener("resize",this._handleHeight),Events.subscribe(Events.player.tracklist_changed,this._onTracklistChanged),0===this.state.tracks.length&&dzPlayer.getTrackList().length>0&&this._onTracklistChanged(),Events.subscribe(Events.player.shuffle_changed,this._onShuffleChanged)},componentWillUnmount:function(){window.removeEventListener("resize",this._handleHeight),Events.unsubscribe(Events.player.tracklist_changed,this._onTracklistChanged),Events.unsubscribe(Events.player.shuffle_changed,this._onShuffleChanged)},render:function(){var e=s({"widgets-playlist":!0,"widgets-classic":"classic"===this.props.format,"widgets-square":"square"===this.props.format});if(this.state.tracks.length>1){var t=this.props.type;this._playlistTracks=this.state.tracks.map(function(e,a){return e.index=a,n.createElement(o,{track:e,type:t,key:"playlisttrack_"+a})})}var a;return"undefined"!=typeof this.props.currentPlay.user&&this.props.currentPlay.user===!0&&(a=n.createElement(i,{nbTracks:this.state.tracks.length,totalDuration:this.state.totalDuration,currentPlay:this.props.currentPlay})),n.createElement("div",{className:e,style:{display:this.state.tracks.length>1?"block":"none"},"aria-hidden":this.state.tracks.length<=1},a,n.createElement("ul",{className:"ul-playlist",style:{height:this.state.tracklistHeight,overflowY:this.state.tracklistOverflow},id:"playlist-track-list"},this._playlistTracks))},_playlistTracks:null,_onTracklistChanged:function(){dzPlayer.getTrackList().length>0&&(this.setState({tracks:dzPlayer.getTrackList(),totalDuration:dzPlayer.getTotalDuration()}),this._handleHeight())},_onShuffleChanged:function(){this.setState({tracks:dzPlayer.getTrackList()}),Events.trigger(Events.player.displayCurrentSong,dzPlayer.getCurrentSong())},_handleHeight:function(){var e=r("div#widget-player-interaction").height(),t=r("div#widget-playlist-info").height(),a=r(window).height(),n=r("ul#playlist-track-list").height(),s=a-e-t;if(s!==n){var i=n>s?"auto":"none";n=Math.max(s-1,0),this.setState({tracklistHeight:n,tracklistOverflow:i})}}});t.exports=l},{"@deezer/components/widget/_elements/playlist/_elements/Info":233,"@deezer/components/widget/_elements/playlist/_elements/Track":234,classnames:"classnames",jquery:"jquery",react:"react"}],234:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("jquery"),i=e("../../../../../core/i18n"),o=i.gettext,l=e("@deezer/components/_mixins/widget/player/song"),c=n.createClass({displayName:"PlaylistTrack",mixins:[l],getInitialState:function(){return{current:!1,playing:!1}},componentDidMount:function(){Events.subscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.subscribe(Events.player.playing,this._onResume)},shouldComponentUpdate:function(e,t){return this.state.current!==t.current||this.state.playing!==t.playing||this.props.track.SNG_ID!==e.track.SNG_ID},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.unsubscribe(Events.player.playing,this._onResume)},render:function(){var e=this.state.current&&this.state.playing,t=r({"track-number":!0,"play-icon":e}),a=this.props.track.index+1<10?"0"+(this.props.track.index+1):this.props.track.index+1;this.state.current&&(document.getElementById("playlist-track-list").scrollTop=33*this.props.track.index);var s="track-"+this.props.track.SNG_ID,i=" "+o("par")+" ";return n.createElement("li",{id:s,onClick:this._handlePlayTrack,"data-index":this.props.track.index},n.createElement("div",{className:t},n.createElement("span",{className:"track-index",style:{display:e?"none":null}},a),n.createElement("span",{className:"track-play"})),n.createElement("div",{className:"ellipsis track-title"},n.createElement("span",{className:"link-gray-dark"},this.props.track.SNG_TITLE)," ",i," ",n.createElement("span",{className:"link-primary"},this.props.track.ART_NAME)," - ",this.props.track.ALB_TITLE),n.createElement("div",{className:"track-duration"},this.parseDuration(this.props.track.DURATION,"m:s")))},_onDisplayCurrentSong:function(e,t){this.setState({current:this.props.track.SNG_ID===t.SNG_ID})},_onResume:function(){this.setState({playing:dzPlayer.isPlaying()})},_handlePlayTrack:function(e){if(e.preventDefault(),e.stopPropagation(),"radio"!==this.props.type){var t=s(e.target).closest("li").data("index");"undefined"!=typeof t&&null!==t&&dzPlayer.playTrackAtIndex(t)}}});t.exports=c},{"../../../../../core/i18n":243,"@deezer/components/_mixins/widget/player/song":49,classnames:"classnames",jquery:"jquery",react:"react"}],233:[function(e,t,a){"use strict";var n=e("react"),r=e("../../../../../core/i18n"),s=r.gettext,i=r.ngettext,o=e("@deezer/components/_mixins/widget/player/song"),l=n.createClass({displayName:"PlaylistInfo",shouldComponentUpdate:function(e){return this.props.nbTracks!==e.nbTracks||this.props.currentPlay.id!==e.currentPlay.id},render:function(){var e=i("titre","titres",{count:this.props.nbTracks}),t=" "+s("par")+" ";return n.createElement("div",{id:"widget-playlist-info"},n.createElement("div",{className:"profile-classic"},n.createElement("div",{className:"pull-left"},n.createElement("a",{className:"picture profile-picture",href:this.props.currentPlay.subtitle_href,target:"_blank"},n.createElement("img",{src:this.props.currentPlay.user_picture}))),n.createElement("div",{className:"pull-left"},n.createElement("p",{className:"profile-playlist"},n.createElement("a",{href:this.props.currentPlay.title_href,className:"link-gray-dark",title:this.props.currentPlay.title,target:"_blank"},this.props.currentPlay.title)),n.createElement("p",{className:"profile-user"},t," ",n.createElement("a",{href:this.props.currentPlay.subtitle_href,className:"link-gray",title:this.props.currentPlay.subtitle,target:"_blank"},this.props.currentPlay.subtitle))),n.createElement("div",{className:"pull-right"},n.createElement("p",{className:"profile-tracks"},this.props.nbTracks+" "+e),n.createElement("p",{className:"profile-time"},o.parseDuration(this.props.totalDuration)))),n.createElement("div",{className:"profile-small ellipsis"},n.createElement("a",{href:this.props.currentPlay.title_href,className:"link-gray-dark",title:this.props.currentPlay.title,target:"_blank"},this.props.currentPlay.title)," ",t," ",n.createElement("a",{href:this.props.currentPlay.subtitle_href,className:"link-gray",title:this.props.currentPlay.subtitle,target:"_blank"},this.props.currentPlay.subtitle)))}});t.exports=l},{"../../../../../core/i18n":243,"@deezer/components/_mixins/widget/player/song":49,react:"react"}],220:[function(e,t,a){"use strict";var n=e("react"),r=e("../../../core/i18n"),s=r.gettext,i=e("@deezer/components/_mixins/widget/player/control"),o=n.createClass({displayName:"Overlay",mixins:[i],getDefaultProps:function(){return{reason:null}},getInitialState:function(){return{overlay:!1,reason:null}},componentDidMount:function(){Events.subscribe(Events.player_widget.removeOverlay,this._onRemoveOverlay)},componentWillReceiveProps:function(e){this.state.overlay===!1&&null!==e.reason&&e.reason!==this.state.reason&&this.setState({overlay:!0,reason:e.reason})},shouldComponentUpdate:function(e,t){return this.state.overlay!==t.overlay||this.state.reason!==t.reason},componentWillUnmount:function(){Events.unsubscribe(Events.player_widget.removeOverlay,this._onRemoveOverlay)},render:function(){var e,t=this._gettextContent(),a=t[0],r=t[1];return this.state.overlay===!0&&(e=n.createElement("section",{className:"overlay",id:"overlay"},n.createElement("span",{className:"content"},n.createElement("span",{className:"wrapper"},n.createElement("span",{className:"message"},n.createElement("p",{className:"overlay-text"},a),n.createElement("button",{className:"btn btn-primary",type:"button",onClick:this._handleButtonClick},n.createElement("span",{className:"label"},r))))),n.createElement("a",{href:"#",className:"icon icon-cancel pull-right",role:"button",onClick:this._handleCloseClick}),n.createElement("a",{href:SETTING_HOST_SITE,target:"_blank"},n.createElement("span",{className:"icon logo"})))),n.createElement("span",null,e)},_onRemoveOverlay:function(){this.props.handleOverlay(null),this.setState({overlay:!1,reason:null})},_gettextContent:function(){var e=[];switch(this.props.reason){case"simultaneousAccess":var t=s("Votre compte Deezer est actuellement utilis sur un autre appareil. "),a=s("Pour relancer votre titre, cliquez ici");break;case"d4a":if("small"===this.props.size)var t=s("La musique illimite, cest par ici.");else var t=s("Profitez de toute la musique que vous aimez en illimit sur Deezer.");var a=s("Inscrivez-vous !");break;case"loveTrack":if("small"===this.props.size)var t=s("Pour faire ceci, connectez-vous ou inscrivez-vous.");else var t=s("Pour ajouter ce titre aux Coups de coeur, connectez-vous ou inscrivez-vous.");var a=s("Inscrivez-vous !");break;default:if("small"===this.props.size)var t=s("coute limite  30 secondes.");else var t=s("Vous tes limit  30 secondes dcoute par titre. La musique illimite, cest par ici.");var a=s("Inscrivez-vous !")}return e.push(t,a),e},_handleButtonClick:function(e){e.preventDefault(),e.stopPropagation(),"restrictMode"===this.state.reason||"userConnect"===this.state.reason||"loveTrack"===this.state.reason?widget.login.popup():(this.props.handleOverlay(null),this.setState({overlay:!1,reason:null}),widget.handlePlayPause())},_handleCloseClick:function(e){e.preventDefault(),e.stopPropagation(),this.props.handleOverlay(null),"restrictMode"===this.state.reason?this.handleNext():"d4a"===this.state.reason&&widget.handlePlayPause(),this.setState({overlay:!1,reason:null})}});t.exports=o},{"../../../core/i18n":243,"@deezer/components/_mixins/widget/player/control":48,react:"react"}],218:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("@deezer/components/widget/_elements/CoverSquare"),i=e("@deezer/components/widget/_elements/RestrictModeTimer"),o=e("../../../widget/restrictMode"),l=e("@deezer/components/_mixins/widget/play"),c=e("@deezer/components/_mixins/widget/player/song"),u=n.createClass({displayName:"Cover",mixins:[l,c],getInitialState:function(){return{format:"classic",size:"medium",dimension:80,currentCover:null,currentCoverPath:this._defaultCover}},componentWillMount:function(){var e=this.state;for(var t in this.state)"undefined"!=typeof this.props[t]&&(e[t]=this.props[t]);"auto"===e.dimension&&(e.dimension=80),e.dimension=this._calculateCoverDimension(e.dimension),"undefined"!=typeof this.props.currentPlay&&null===this.state.currentCover&&(e.currentCover=this.props.currentPlay.cover,e.currentCoverPath=this._getImgAbsolutePath(this.props.currentPlay.cover,e.dimension)),this.setState(e)},componentDidMount:function(){this._handleResize(),Events.subscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong)},componentWillReceiveProps:function(e){if(this.state.size!==e.size){var t=this._calculateCoverDimension(document.getElementById("widget-cover").offsetWidth);this.setState({size:e.size,dimension:t,currentCoverPath:this._getImgAbsolutePath("cover/"+this.state.currentCover,t)})}},shouldComponentUpdate:function(e,t){return this.state.currentCoverPath!==t.currentCoverPath||this.state.dimension!==t.dimension||this.state.size!==t.size||this.state.paused!==t.paused||this.state.playing!==t.playing},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong)},render:function(){var e,t=o.isD4A(),a=o.isRestrictMode(),l=r({play:!0,"play-32":"small"===this.state.size||"classic"===this.state.format,"play-restrict":a===!0&&t===!1,active:this.state.paused===!1&&this.state.playing===!0}),c=r({"icon-stack icon-stack-hover icon-stack-circle":!0,"icon-32":"small"===this.state.size||"classic"===this.state.format,"icon-64":"small"!==this.state.size&&"classic"!==this.state.format});"square"===this.state.format&&(e=n.createElement(s,{size:this.state.size,currentPlay:this.props.currentPlay,restrictMode:a,handleOverlay:this.props.handleOverlay}));var u=a&&t===!1&&"radio"!==dzPlayer.getPlayerType;return n.createElement("aside",{className:"visual",id:"widget-cover"},n.createElement("figure",{className:"thumbnail"},n.createElement("span",{className:"picture"},n.createElement("img",{className:"size-img",src:this.state.currentCoverPath})),n.createElement("span",{className:l,onClick:widget.handlePlayPause},n.createElement("span",{className:c,id:"play-controls"},u===!1?n.createElement("span",null,n.createElement("span",{className:"play-icon play-default",role:"button"},n.createElement("span",{className:"icon icon-play"})),n.createElement("span",{className:"play-icon play-hover",role:"button"},n.createElement("span",{className:"icon icon-pause"})),n.createElement("span",{className:"play-icon play-active"},n.createElement("span",{className:"equalizer equalizer-inverse equalizer-16"},n.createElement("span",{className:"equalizer-bar equalizer-bar-1"}),n.createElement("span",{className:"equalizer-bar equalizer-bar-2"}),n.createElement("span",{className:"equalizer-bar equalizer-bar-3"})))):n.createElement("span",null,n.createElement("span",{className:"play-icon play-default"},n.createElement(i,null)),n.createElement("span",{className:"play-icon play-hover"},n.createElement("span",{className:"icon icon-play",role:"button"}),n.createElement("span",{className:"icon icon-pause",role:"button"})),n.createElement("span",{className:"play-icon play-active"},n.createElement(i,null))))),e))},_onDisplayCurrentSong:function(e,t){var a=c.getCurrentSong().cover;if(null!==a&&this.state.currentCover!==a){if("number"==typeof t.TYPE&&1===t.TYPE)var n="misc/";else var n="cover/";this.setState({currentCover:a,currentCoverPath:this._getImgAbsolutePath(n+a)})}},_defaultCover:window.SETTING_STATIC+"/img/common/cover_500x500-v"+window.STATIC_VERSION+".jpg",_handleResize:function(){this.setState({dimension:this._calculateCoverDimension(document.getElementById("widget-cover").offsetWidth)})},_getImgAbsolutePath:function(e,t){return e?(t=t||this.state.dimension,t=this._calculateCoverDimension(t),"%1/%2/%3x%3-000000-100-1-1.jpg".replace("%1",SETTING_DOMAIN_IMG).replace("%2",e).replace(/\%3/g,t)):this._defaultCover},_calculateCoverDimension:function(e){return Math.max(Math.min(e,600),80)}});t.exports=u},{"../../../widget/restrictMode":279,"@deezer/components/_mixins/widget/play":47,"@deezer/components/_mixins/widget/player/song":49,"@deezer/components/widget/_elements/CoverSquare":219,"@deezer/components/widget/_elements/RestrictModeTimer":221,classnames:"classnames",react:"react"}],221:[function(e,t,a){"use strict";var n=e("react"),r=e("react-addons-pure-render-mixin"),s=e("../../../widget/restrictMode"),i=n.createClass({displayName:"RestrictModeTimer",mixins:[r],getInitialState:function(){return{duration:s.restrictDuration}},componentDidMount:function(){Events.subscribe(Events.player.position,this._onPlayerPosition)},componentWillUnmount:function(){Events.unsubscribe(Events.player.position,this._onPlayerPosition)},render:function(){return n.createElement("span",{className:"play-time"},this.state.duration,'"')},_onPlayerPosition:function(e,t){var a=Math.floor(t);a>0&&("radio"!==dzPlayer.getPlayerType()||window.MOBILE_PLATFORM===!0)&&this.setState({duration:Math.max(s.restrictDuration-a,0)})}});t.exports=i},{"../../../widget/restrictMode":279,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],219:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("@deezer/components/widget/_elements/player/Player"),i=e("@deezer/components/_mixins/widget/popup"),o=n.createClass({displayName:"CoverSquare",mixins:[i],render:function(){var e,t=r({"icon icon-time":!0,"icon-time-big":"big"===this.props.size});"small"!==this.props.size&&(e=n.createElement(s,{format:"square",size:this.props.size,currentPlay:this.props.currentPlay,handleOverlay:this.props.handleOverlay}));var a;return this.props.restrictMode===!0&&(a=n.createElement("div",{className:"square-button",role:"button",onClick:this.props.handleOverlay.bind(null,"userConnect")},n.createElement("span",{className:t}))),n.createElement("div",null,a,n.createElement("div",{className:"square-button square-button-resize hover"},n.createElement("a",{className:"icon icon-resize-up",role:"button",id:"popup-btn",href:"#",onClick:this.handlePopup})),e)}});t.exports=o},{"@deezer/components/_mixins/widget/popup":51,"@deezer/components/widget/_elements/player/Player":222,classnames:"classnames",react:"react"}],222:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("../../../../core/i18n"),i=s.gettext,o=e("../../../../widget/restrictMode"),l=e("./_elements/infos/Slider"),c=e("./_elements/infos/Waveform"),u=e("./_elements/share/Classic"),d=e("./_elements/share/Square"),p=e("@deezer/components/_mixins/widget/popup"),m=e("@deezer/components/_mixins/widget/player/song"),h=e("@deezer/components/_mixins/widget/player/control"),y=n.createClass({displayName:"Player",mixins:[p,m],getDefaultProps:function(){return{format:"classic",size:"medium"}},getInitialState:function(){return{format:null,size:null,isWaveformCompliant:!1}},componentWillMount:function(){var e={size:this.props.size,format:this.props.format};null===this.state.currentPlay.id&&(e.currentPlay=this.props.currentPlay,"undefined"==typeof e.currentPlay.id&&(e.currentPlay.id="")),this.setState(e)},componentDidMount:function(){Events.subscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.subscribe(Events.player.track_end,this._onTrackEnd)},componentWillReceiveProps:function(e){this.state.size!==e.size&&this.setState({size:e.size})},shouldComponentUpdate:function(e,t){return this.state.currentPlay.id!==t.currentPlay.id||this.state.size!==t.size},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.unsubscribe(Events.player.track_end,this._onTrackEnd)},render:function(){var e,t=r({info:!0,"info-small":"small"===this.state.size,"info-medium":"medium"===this.state.size,"info-big":"big"===this.state.size}),a=r({"link-gray-dark":"classic"===this.state.format,"link-white":"square"===this.state.format,ellipsis:!0}),s=o.isRestrictMode(),p=n.createElement(l,{format:this.state.format,size:this.state.size,currentPlay:this.state.currentPlay,restrictMode:s,handleOverlay:this.props.handleOverlay});e=this.state.isWaveformCompliant===!0?n.createElement(c,{format:this.state.format,size:this.state.size,currentPlay:this.state.currentPlay,restrictMode:s,handleOverlay:this.props.handleOverlay}):p;var m,h,y=i("Retirer des Coups de coeur"),f=i("Ajouter aux Coups de coeur"),g="auto";if("square"===this.state.format)m="big"===this.state.size?e:p,h="big"===this.state.size?n.createElement(d,{textDeleteFavorite:y,textAddFavorite:f,currentPlay:this.state.currentPlay,handleOverlay:this.props.handleOverlay}):null;else{m="small"===this.state.size?p:e,h="small"!==this.state.size?n.createElement(u,{textDeleteFavorite:y,textAddFavorite:f,textShare:i("Partager"),currentPlay:this.state.currentPlay,handleOverlay:this.props.handleOverlay}):null;var v=document.getElementById("widget-player-interaction"),P=document.getElementById("widget-cover");v&&P&&(g=v.innerWidth-P.innerWidth)}var _=" "+i("par")+" ",E=null;return"square"!==this.state.format&&"widget"===widget.options.app_type&&(E=n.createElement("a",{href:"#",id:"popup-btn",onClick:this.handlePopup,className:"icon icon-resize-up hover",role:"button"})),n.createElement("div",{className:"content"},n.createElement("article",{className:t},E,n.createElement("h1",{className:"heading-1",style:{width:g}},n.createElement("a",{href:this.state.currentPlay.title_href,className:a,target:"_blank",style:{display:"inline-block"}},this.state.currentPlay.title)),n.createElement("h2",{className:"heading-2",style:{display:""===this.state.currentPlay.subtitle?"none":"inline-block"}},_,n.createElement("a",{href:this.state.currentPlay.subtitle_href,className:"link-primary ellipsis",title:this.state.currentPlay.subtitle,target:"_blank"},this.state.currentPlay.subtitle)),m),h)},_onDisplayCurrentSong:function(){var e=m.getCurrentSong(),t="square"===this.state.format&&"big"===this.state.size||"classic"===this.state.format&&"small"!==this.state.size;if(t===!0&&"undefined"!=typeof e&&"string"==typeof e.md5){var a=new RegExp("(.mp3)","g"),n=e.md5.replace(a,"");WaveformTrack.trackMd5=n,WaveformTrack.data=[],WaveformTrack.loadWaveformData(!1);var r=this;window.setTimeout(function(){r.setState({currentPlay:e,isWaveformCompliant:WaveformTrack.getData().length>0})},400)}else this.setState({currentPlay:e,isWaveformCompliant:t})},_onTrackEnd:function(e){(o.isRestrictMode()===!1||o.isD4A())&&h.handleNext(e)}});t.exports=y},{"../../../../core/i18n":243,"../../../../widget/restrictMode":279,"./_elements/infos/Slider":225,"./_elements/infos/Waveform":226,"./_elements/share/Classic":227,"./_elements/share/Square":228,"@deezer/components/_mixins/widget/player/control":48,"@deezer/components/_mixins/widget/player/song":49,"@deezer/components/_mixins/widget/popup":51,classnames:"classnames",react:"react"}],228:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("../Volume"),i=e("@deezer/components/_mixins/widget/favorite"),o=e("@deezer/components/_mixins/widget/player/control"),l=n.createClass({displayName:"PlayerShareSquare",mixins:[i,o],render:function(){var e=r({selected:!0,active:this.isFavorite()}),t=r({"icon icon-repeat":!0,"icon-repeat-one":2===this.state.repeat,active:this.state.repeat>0}),a=this.isFavorite()?this.props.textDeleteFavorite:this.props.textAddFavorite;return n.createElement("footer",{className:"footer"},n.createElement("ul",{className:"clearfix"},n.createElement("li",null,n.createElement("a",{className:e,role:"button",id:"icon_loved",href:"#",title:a,onClick:this.onFavoriteClick.bind(null,this.props.handleOverlay),"data-id":this.state.favoriteData.id,"data-type":this.state.favoriteData.type},n.createElement("span",{className:"icon icon-love"}))),n.createElement("li",null,n.createElement("a",{href:"#",onClick:this.handleClickShuffle,role:"button"},n.createElement("span",{className:"icon icon-shuffle"+(this.state.isShuffle?" active":"")}))),n.createElement("li",null,n.createElement("a",{href:"#",onClick:this.handleClickRepeat,role:"button"},n.createElement("span",{className:t}))),n.createElement("li",{className:"pull-right"},n.createElement("a",{href:SETTING_HOST_SITE,target:"_blank"},n.createElement("span",{className:"icon logo"}))),n.createElement(s,null)))}});t.exports=l},{"../Volume":223,"@deezer/components/_mixins/widget/favorite":46,"@deezer/components/_mixins/widget/player/control":48,classnames:"classnames",react:"react"}],227:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("../Volume"),i=e("@deezer/components/_mixins/widget/favorite"),o=e("@deezer/components/_mixins/widget/player/control"),l=n.createClass({displayName:"PlayerShareClassic",mixins:[i,o],render:function(){var e=r({selected:!0,active:this.isFavorite()}),t=r({"icon icon-shuffle":!0,active:this.state.isShuffle}),a=r({"icon icon-repeat":!0,"icon-repeat-one":2===this.state.repeat,active:this.state.repeat>0}),i=this.isFavorite()?this.props.textDeleteFavorite:this.props.textAddFavorite;return n.createElement("footer",{className:"footer"},n.createElement("ul",{className:"clearfix"},n.createElement("li",null,n.createElement("a",{className:e,role:"button",id:"icon_loved",href:"#",title:i,onClick:this.onFavoriteClick.bind(null,this.props.handleOverlay),"data-id":this.state.favoriteData.id,"data-type":this.state.favoriteData.type},n.createElement("span",{className:"icon icon-love"}))),n.createElement("li",null,n.createElement("a",{href:"#",onClick:this.handleClickShuffle,role:"button"},n.createElement("span",{className:t}))),n.createElement("li",null,n.createElement("a",{href:"#",onClick:this.handleClickRepeat,role:"button"},n.createElement("span",{className:a}))),n.createElement("li",null,n.createElement("a",{href:"#",title:this.props.textShare,onClick:this._handleClickShare,role:"button"},n.createElement("span",{className:"icon icon-share hover"}))),n.createElement("li",{className:"pull-right height-logo"},n.createElement("a",{href:SETTING_HOST_SITE,target:"_blank"},n.createElement("span",{className:"icon logo"}))),n.createElement(s,null)))},_handleClickShare:function(e){e.preventDefault(),e.stopPropagation(),Events.trigger(Events.user.shareClick);var t=document.getElementById("input_share");t.focus(),t.select()}});t.exports=l},{"../Volume":223,"@deezer/components/_mixins/widget/favorite":46,"@deezer/components/_mixins/widget/player/control":48,classnames:"classnames",react:"react"}],223:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("react-addons-pure-render-mixin"),i=e("./VolumeSlider"),o=e("@deezer/components/_mixins/widget/player/volume"),l=n.createClass({displayName:"PlayerVolume",mixins:[o,s],getInitialState:function(){var e="web"===window.PLATFORM;return{display:!e,isWeb:e}},render:function(){var e=r({"icon icon-volume":!0,hover:this.state.isWeb}),t=this.state.display?"block":"none";return n.createElement("div",{id:"player-volume",className:"player-volume",onMouseEnter:this._handleVolumeDisplay,onMouseLeave:this._handleVolumeDisplay,style:{display:"block"}},n.createElement("li",{id:"volume-handle",className:"pull-right"},n.createElement("span",{className:e,title:"Volume"})),n.createElement("li",{id:"volume-slider",className:"pull-right",style:{display:t}},n.createElement("span",{className:"volume-slider",id:"volume-slider"},n.createElement(i,null))),n.createElement("li",{id:"volume-mute",className:"pull-right",style:{display:t}},n.createElement("a",{href:"#",title:"Mute",onClick:this.muteVolume},n.createElement("span",{className:"icon icon-volume-min",role:"button"}))))},_handleVolumeDisplay:function(e){e.preventDefault(),e.stopPropagation(),this.state.isWeb&&this.setState({display:!this.state.display})}});t.exports=l},{"./VolumeSlider":224,"@deezer/components/_mixins/widget/player/volume":50,classnames:"classnames",react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],224:[function(e,t,a){"use strict";var n=e("react"),r=e("react-addons-pure-render-mixin"),s=e("@deezer/components/_mixins/widget/player/volume"),i=n.createClass({displayName:"PlayerVolumeSlider",mixins:[s,r],getInitialState:function(){return{dragging:!1,originPosition:0}},componentDidMount:function(){Events.subscribe(Events.player.mute_changed,this._onMuteChanged),Events.subscribe(Events.player.volume_changed,this._onVolumeChanged)},componentWillUnmount:function(){Events.unsubscribe(Events.player.mute_changed,this._onMuteChanged),Events.unsubscribe(Events.player.volume_changed,this._onVolumeChanged)},render:function(){return n.createElement("span",{className:"volume-progress",id:"volume_progress"},n.createElement("span",{id:"player_volume_bar",className:"volume-bar",style:{width:this.state.volume+"%"}}),n.createElement("a",{id:"player_volume_handler",role:"button",className:"icon icon-handler icon-circle-full",style:{left:this.state.volume/100*32},onMouseDown:this._onMouseDown,onMouseUp:this._onMouseUp,onMouseLeave:this._onMouseUp,onMouseMove:this._onMouseMove}))},_onMuteChanged:function(e,t){this.setState({volume:t?0:100*dzPlayer.getVolume()})},_onMouseDown:function(e){e.preventDefault(),e.stopPropagation(),this.setState({dragging:!0,originPosition:document.getElementById("player_volume_bar").getBoundingClientRect().left})},_onMouseMove:function(e){if(e.preventDefault(),e.stopPropagation(),this.state.dragging===!0){var t=e.pageX-this.state.originPosition;this.calculateVolume(t,!1)}},_onMouseUp:function(e){if(e.preventDefault(),e.stopPropagation(),this.state.dragging===!0){var t=e.pageX-this.state.originPosition;this.calculateVolume(t,!0),this.setState({dragging:!1})}},_onVolumeChanged:function(e,t){this.setState({volume:t})}});t.exports=i},{"@deezer/components/_mixins/widget/player/volume":50,react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],50:[function(e,t,a){"use strict";var n={getInitialState:function(){return{volume:50}},calculateVolume:function(e,t){var a=e/document.getElementById("volume_progress").offsetWidth*100;a=Math.max(0,Math.min(a,100)),this.state.volume!==a&&(t=Boolean(t),widget.setVolume(a,t),a/100!==this.state.volume&&this.setState({volume:a}))},muteVolume:function(e){e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),widget.muteVolume(),this.setState({volume:dzPlayer.isMuted()?0:dzPlayer.getVolume()})}};t.exports=n},{}],46:[function(e,t,a){"use strict";var n=e("jquery"),r=e("../../../core/favorite"),s={getInitialState:function(){return{currentPlay:{id:null,type:"song"},favoriteData:{id:null,type:"song"}}},shouldComponentUpdate:function(e,t){return"undefined"!=typeof e.currentPlay&&e.currentPlay.id!==t.currentPlay.id||t.isShuffle!==this.state.isShuffle||t.repeat!==this.state.repeat},componentWillReceiveProps:function(e){this._setFavoriteData(e.currentPlay)},componentDidUpdate:function(){this.setState({currentPlay:this.props.currentPlay})},isFavorite:function(){return userData.isFavorite(this.state.favoriteData.type,this.state.favoriteData.id)},onFavoriteClick:function(e,t){t.preventDefault(),t.stopPropagation(),userData.isLoaded?this._canClickFavorite()&&null!==this.state.favoriteData.id&&(r.action(document.getElementById("#icon_loved"),this.state.favoriteData),n("a#icon_loved").toggleClass("active")):e("loveTrack")},_setFavoriteData:function(e){var t={id:null,type:"song"};if("string"==typeof e.id&&"string"==typeof e.type){if(e.id===this.state.favoriteData.id)return;t={id:e.id,type:e.type}}this.setState({favoriteData:t})},_canClickFavorite:function(){return null!==this.props.currentPlay.id&&"ads"!==dzPlayer.getPlayerType()&&"jingle"!==dzPlayer.getPlayerType()}};t.exports=s},{"../../../core/favorite":241,jquery:"jquery"}],226:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("react-addons-pure-render-mixin"),i=e("../../../../../../widget/restrictMode"),o=e("../waveform/Control"),l=e("@deezer/components/_mixins/widget/share"),c=n.createClass({displayName:"PlayerInfosWaveform",mixins:[l,s],getDefaultProps:function(){return{currentPlay:{title_href:""},format:"classic",restrictMode:i.isRestrictMode()}},render:function(){var e=r({"progress-bar progress-time":!0,"restrict-mode":this.props.restrictMode});return n.createElement("div",null,n.createElement("div",{className:"controls",style:{display:this.state.displayShare===!1?"block":"none"}},n.createElement("div",{className:e},n.createElement("a",{href:"#",className:"icon icon-time",role:"button",style:{display:"classic"===this.props.format&&this.props.restrictMode===!0?"":"none"},onClick:this.props.handleOverlay.bind(null,"userConnect")}),n.createElement(o,null))),n.createElement("div",{className:"share",style:{display:this.state.displayShare?"block":"none"}},n.createElement("input",{id:"input_share",type:"text",value:this.props.currentPlay.title_href,selected:"true",className:"form-control",style:{textOverflow:"ellipsis"},readOnly:!0})))}});t.exports=c},{"../../../../../../widget/restrictMode":279,"../waveform/Control":230,"@deezer/components/_mixins/widget/share":53,classnames:"classnames",react:"react","react-addons-pure-render-mixin":"react-addons-pure-render-mixin"}],230:[function(e,t,a){"use strict";var n=e("react"),r=e("./Waveform"),s=e("@deezer/components/_mixins/widget/duration"),i=e("@deezer/components/_mixins/widget/player/control"),o=n.createClass({displayName:"PlayerWaveformControl",mixins:[i,s],render:function(){return n.createElement("span",null,n.createElement("a",{href:"#",className:"icon icon-prev",role:"button",style:{display:this.prevButtonActive()===!0?"block":"none"},onClick:this.handlePrevious}),n.createElement(r,{onClick:this.handleProgressClick,onMouseDown:this.handleProgressMouseDown,onMouseUp:this.handleProgressMouseUp,onMouseLeave:this.handleProgressMouseUp,onMouseMove:this.handleProgressMouseMove}),n.createElement("a",{href:"#",className:"icon icon-next",role:"button",style:{opacity:this.nextButtonActive()===!0?1:.2},onClick:this.handleNext}))}});t.exports=o},{"./Waveform":231,"@deezer/components/_mixins/widget/duration":45,"@deezer/components/_mixins/widget/player/control":48,react:"react"}],231:[function(e,t,a){"use strict";var n=e("react"),r=e("../../../../../../widget/waveformTrackData"),s=e("@deezer/components/_mixins/widget/resize"),i=e("@deezer/components/_mixins/widget/duration"),o=n.createClass({displayName:"PlayerWaveform",mixins:[s,i],componentDidMount:function(){r.init("track-progress",null,window.widgetThemeColor),Events.subscribe(Events.player.position,this._onPlayerPositionWaveform)},componentWillUnmount:function(){r.destroy(),Events.unsubscribe(Events.player.position,this._onPlayerPositionWaveform)},render:function(){return n.createElement("div",{id:"track-progress",role:"button",style:{height:25,marginTop:-20,width:"100%"},onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onMouseLeave:this.props.onMouseLeave,onMouseMove:this.props.onMouseMove})},_onPlayerPositionWaveform:function(){null===r.track&&r.init("track-progress",null,window.widgetThemeColor),this.state.progress>0&&r.update(this.state.progress)}});t.exports=o},{"../../../../../../widget/waveformTrackData":280,"@deezer/components/_mixins/widget/duration":45,"@deezer/components/_mixins/widget/resize":52,react:"react"}],280:[function(e,t,a){"use strict";var n=(e("react"),e("react-dom")),r={track:null,init:function(e,t,a,n,s){var i=dzPlayer.getCurrentSong();if("string"!=typeof i.MD5_ORIGIN||null===i.MD5_ORIGIN)return!1;r.track=WaveformTrack;var o=new RegExp("(.mp3)","g"),l=i.MD5_ORIGIN.replace(o,"");r.track.init(l,e,t,a,n,s)},hasData:function(){return r.track.getData().length>0},update:function(e){null!==r&&r.track.update(e)},destroy:function(){n.unmountComponentAtNode(document.getElementById(r.track.containerId)),r.track.containerId=null,r.track.waveform=null,r.track.data=[]}};t.exports=r},{react:"react","react-dom":"react-dom"}],225:[function(e,t,a){"use strict";var n=e("react"),r=e("classnames"),s=e("../../../../../../widget/restrictMode"),i=e("../slider/Control"),o=e("@deezer/components/_mixins/widget/share"),l=n.createClass({displayName:"PlayerInfosSlider",mixins:[o],getDefaultProps:function(){return{format:"classic",restrictMode:s.isRestrictMode()}},shouldComponentUpdate:function(e,t){return this.state.displayShare!==t.displayShare||this.props.restrictMode!==e.restrictMode||this.props.format!==e.format||this.props.currentPlay.id!==e.currentPlay.id},render:function(){var e=r({"track progress-time":!0,"restrict-mode":this.props.restrictMode});return n.createElement("div",null,n.createElement("div",{className:e,style:{display:this.state.displayShare===!1?"block":"none"}},n.createElement("span",{className:"icon icon-time",role:"button",style:{display:"square"===this.props.format||this.props.restrictMode===!1?"none":""},onClick:this.props.handleOverlay.bind(null,"userConnect")}),n.createElement(i,null)),n.createElement("div",{className:"share",style:{display:this.state.displayShare?"block":"none"}},n.createElement("input",{id:"input_share",type:"text",value:this.props.currentPlay.title_href,selected:"true",className:"form-control",style:{textOverflow:"ellipsis"},readOnly:!0})),n.createElement("a",{href:SETTING_HOST_SITE,target:"_blank"},n.createElement("span",{className:"icon logo",style:{display:"classic"===this.props.format?"none":null}})))}});t.exports=l},{"../../../../../../widget/restrictMode":279,"../slider/Control":229,"@deezer/components/_mixins/widget/share":53,classnames:"classnames",react:"react"}],279:[function(e,t,a){"use strict";var n={restrictDuration:30,isRestrictMode:function(){return dzPlayer.isLimited()&&"radio"!==dzPlayer.getPlayerType()||window.MOBILE_PLATFORM===!0},isD4A:function(){var e=dzPlayer.getCurrentSong();return dzPlayer.isLimited()&&null!==e&&parseInt(e.SNG_ID,10)<0&&right.checkSongAvailable(e)===right.READABLE}};t.exports=n},{}],229:[function(e,t,a){"use strict";var n=e("react"),r=(e("jquery"),e("@deezer/components/_mixins/widget/duration")),s=e("@deezer/components/_mixins/widget/player/control"),i=n.createClass({displayName:"PlayerSliderControl",mixins:[s,r],render:function(){var e=0,t=document.getElementById("track-progress");return t&&(e=t.offsetWidth),n.createElement("span",{className:"track-slider"},n.createElement("a",{href:"#",className:"icon icon-prev",role:"button",style:{display:this.prevButtonActive()===!0?"block":"none"},onClick:this.handlePrevious}),n.createElement("div",{className:"track-progress",role:"button",id:"track-progress",onClick:this.handleProgressClick},n.createElement("span",{id:"player_track_bar",className:"track-bar",style:{width:this.state.progress+"%"}}),n.createElement("a",{href:"#",className:"icon icon-circle-full hover",style:{left:this.state.progress/100*e},onMouseDown:this.handleProgressMouseDown,onMouseUp:this.handleProgressMouseUp,onMouseLeave:this.handleProgressMouseUp,onMouseMove:this.handleProgressMouseMove})),n.createElement("a",{href:"#",className:"icon icon-next",role:"button",style:{display:this.nextButtonActive()===!0?"block":"none"},onClick:this.handleNext}))}});t.exports=i},{"@deezer/components/_mixins/widget/duration":45,"@deezer/components/_mixins/widget/player/control":48,jquery:"jquery",react:"react"}],53:[function(e,t,a){"use strict";var n={getInitialState:function(){return{displayShare:!1}},componentDidMount:function(){Events.subscribe(Events.user.shareClick,this._onShareClick)},componentWillUnmount:function(){Events.unsubscribe(Events.user.shareClick,this._onShareClick)},_onShareClick:function(){this.setState({displayShare:!this.state.displayShare})}};t.exports=n},{}],48:[function(e,t,a){"use strict";var n=e("jquery"),r={getInitialState:function(){return{dragging:!1,originPosition:0,isShuffle:dzPlayer.isShuffle(),repeat:0}},prevButtonActive:function(){return"mod"===dzPlayer.getPlayerType()&&(dzPlayer.getIndexSong()>0||dzPlayer.getRepeat()>0)},nextButtonActive:function(){return("mod"===dzPlayer.getPlayerType()||dzPlayer.isRadio()&&dzPlayer.skipRadioAllowed())&&(!dzPlayer.isLastSong()||dzPlayer.getRepeat()>0)},handlePrevious:function(e){return e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),this.prevButtonActive()?void(dzPlayer.isRadio()||dzPlayer.control.prevSong()):!0},handleNext:function(e){var t=!1;e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation(),"PLAYER.track_end"===e.namespace&&dzPlayer.isRadio()&&!dzPlayer.skipRadioAllowed()&&(t=!0)),(this.nextButtonActive()||t!==!1)&&dzPlayer.control.nextSong(t)},handleProgressMouseDown:function(e){if(0!==e.button)return!0;var t=document.getElementById("track-progress");t&&this.setState({dragging:!0,originPosition:t.getBoundingClientRect().left})},handleProgressMouseMove:function(e){if(this.state.dragging===!0){var t=e.pageX-this.state.originPosition;this._calculateProgress(t)}},handleProgressClick:function(e){var t=document.getElementById("track-progress");if(t){var a=e.pageX-t.getBoundingClientRect().left;this._calculateProgress(a)}},handleProgressMouseUp:function(){this.state.dragging===!0&&this.setState({dragging:!1})},handleClickShuffle:function(e){e.preventDefault(),e.stopPropagation();var t=!dzPlayer.isShuffle();dzPlayer.control.setShuffle(t,!0),this.setState({isShuffle:t})},handleClickRepeat:function(e){e.preventDefault(),e.stopPropagation();var t=2===dzPlayer.getRepeat()?0:dzPlayer.getRepeat()+1;dzPlayer.control.setRepeat(t),this.setState({repeat:t})},doAction:function(e,t){try{switch(e){case"play":widget.handlePlayPause(null,null,!1);break;case"pause":widget.handlePlayPause(null,null,!0);break;case"prev":this.handlePrevious();break;case"next":this.handleNext();break;case"volume":widget.setVolume(t[0]);break;case"mute":widget.muteVolume()}}catch(a){error.log(a)}},_calculateProgress:function(e){var t=(e+4)/document.getElementById("track-progress").offsetWidth*100;t=Math.max(0,Math.min(t,100)),this._setProgress(t)},_setProgress:function(e){isNaN(e)||"mod"!==dzPlayer.getPlayerType()||(dzPlayer.control.seek(e/100),dzPlayer.isPlaying()===!1&&dzPlayer.control.play(),dzPlayer.isPaused()&&n("#play-controls").hasClass("active")===!1&&n("#play-controls").addClass("active"))}};t.exports=r},{jquery:"jquery"}],51:[function(e,t,a){"use strict";var n=e("jquery"),r={componentDidMount:function(){window.opener&&window.addEventListener("unload",this._closePopup,!0)},componentWillUnmount:function(){window.opener&&window.removeEventListener("unload",this._closePopup)},handlePopup:function(e){e.preventDefault(),e.stopPropagation(),null===window.opener?this._openPopup():this._closePopup()},_openPopup:function(){if(null===window.opener){widget.handlePlayPause(null,null,!0);var e=window.document.location.href.replace(/#/gi,""),t="%1&popup=true&current_song_index=%2&current_song_time=%3&autoplay=false&playing=%4",a="resizable='no', location='no', width=%1, height=%2, menubar=0, status=0, scrollbars=0, menubar=0",r=t.replace("%1",e).replace("%2",dzPlayer.getTrackListIndex()).replace("%3",Math.floor(dzPlayer.getPosition())).replace("%4",dzPlayer.isPlaying()?"true":"false"),s=a.replace("%1",widget.options.width).replace("%2",widget.options.height);window.open(r,"widgetpopup",s),n("#popup-btn").hide()}},_closePopup:function(){window.opener&&(window.opener.widget.options.current_song_index=dzPlayer.getTrackListIndex(),window.opener.widget.options.current_song_time=Math.floor(dzPlayer.getPosition()),window.close(),window.opener.widget.playCallback(!0,window.opener.widget.options.current_song_index,window.opener.widget.options.current_song_time),window.opener.$("#popup-btn").show(),window.opener.Events.trigger(Events.player_widget.removeOverlay))}};t.exports=r},{jquery:"jquery"}],47:[function(e,t,a){"use strict";var n={getInitialState:function(){return{playing:!1,paused:!1}},componentDidMount:function(){Events.subscribe(Events.player.playing,this._onPlaying),Events.subscribe(Events.player.play,this._onPlay),Events.subscribe(Events.player.paused,this._onPaused),Events.subscribe(Events.player.mute_changed,this._onMuteChanged),Events.subscribe(Events.player.finish,this._onFinish)},componentWillUnmount:function(){Events.unsubscribe(Events.player.playing,this._onPlaying),Events.unsubscribe(Events.player.play,this._onPlay),Events.unsubscribe(Events.player.paused,this._onPaused),Events.unsubscribe(Events.player.mute_changed,this._onMuteChanged),Events.unsubscribe(Events.player.finish,this._onFinish)},_onPlaying:function(e,t){this.setState({playing:t})},_onPlay:function(){this.setState({playing:!0,paused:!1})},_onPaused:function(e,t){this.setState({paused:t})},_onMuteChanged:function(e,t){"radio"===dzPlayer.getPlayerType()&&this.setState({paused:t})},_onFinish:function(){this.setState({playing:!1,paused:!1})}};t.exports=n},{}],52:[function(e,t,a){"use strict";var n={getInitialState:function(){return{width:null}},handleResize:function(){var e=window.innerWidth,t={forceUpdateResize:!0,size:this.state.size,width:e};if("square"===this.state.format){var a=window.innerHeight;e>a&&(t.width=a-16),t.width<200?(t.size="small",t.width=80):t.width>200&&t.width<=300?t.size="medium":t.size="big"}else t.width>200&&t.width<=350?t.size="small":t.width>350&&(t.size="medium");this.setState(t)}};t.exports=n},{}],49:[function(e,t,a){"use strict";var n,r={getInitialState:function(){return{currentPlay:{id:null}}},getCurrentSong:function(){var e=dzPlayer.getCurrentSong();if(null!==e){if(n&&n.id===e.SNG_ID)return n;var t=e.SNG_ID,a=e.SNG_TITLE,r=SETTING_HOST_SITE+"/track/"+e.SNG_ID,s=e.ART_NAME,i=SETTING_HOST_SITE+"/artist/"+e.ART_ID,o="undefined"==typeof e.ALB_PICTURE?"":e.ALB_PICTURE,l=e.MD5_ORIGIN,c="song"}var u="--";return n={id:t||null,title:a||u,title_href:r||u,subtitle:s||u,subtitle_href:i||u,type:c||u,md5:l||null,cover:o||null}},parseDuration:function(e,t){"undefined"==typeof t&&(t="h:m:s");var a=t.split(":"),n=parseInt(e,10),r={};r.h=Math.floor(n/3600),r.m=Math.floor((n-3600*r.h)/60),r.s=n-3600*r.h-60*r.m;for(var s=[],i=0;i<a.length;i++){var o=r[a[i]];10>o&&(o="0"+o),s.push(o)}return s.join(":")}};t.exports=r},{}],45:[function(e,t,a){"use strict";var n={getInitialState:function(){return{progress:0,currentDuration:0,simultaneousAccess:!1}},componentDidMount:function(){Events.subscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.subscribe(Events.player.position,this._onPlayerPositionDuration)},componentWillUnmount:function(){Events.unsubscribe(Events.player.displayCurrentSong,this._onDisplayCurrentSong),Events.unsubscribe(Events.player.position,this._onPlayerPositionDuration)},_onDisplayCurrentSong:function(){this.setState({currentDuration:0,progress:0})},_onPlayerPositionDuration:function(e,t){var a=Math.floor(t);if(a>0){var n=dzPlayer.getDuration();dzPlayer.isLimited()&&"radio"!==dzPlayer.getPlayerType()&&(n=30);var r=Math.round(a/n*100);this.setState({currentDuration:a,progress:r})}}};t.exports=n},{}],277:[function(e,t,a){"use strict";var n=e("jquery"),r={player:null,sngpath:null,playing:!1,canPlay:!1,songLoaded:!1,position:0,duration:0,jingle:!1,currentVolume:.5,isMuted:!1,init:function(){if("object"==typeof window.USER&&"object"==typeof window.USER.OPTIONS){for(var e in window.USER.OPTIONS)if(window.USER.OPTIONS.hasOwnProperty(e)){var t=e.replace("mobile_","");window.USER.OPTIONS[t]=window.USER.OPTIONS[e]}r.sendProp("user_status",window.USER.OPTIONS)}return r.override_webkit()?s.init():(r.player=new Audio,r.player.controls="controls",r.player.preload="none",r.player.type="audio/mpeg",r.player.addEventListener("error",r.errorCallback,!0),r.player.addEventListener("progress",r.evt_progress,!0),r.player.addEventListener("canplay",r.evt_canplay,!0),r.player.addEventListener("canplaythrough",r.evt_canplaythrough,!0),r.player.addEventListener("timeupdate",r.evt_timeupdate,!0),r.player.addEventListener("ended",r.evt_ended,!0),r.sendProp("playerLoaded",!0),!0)},override_webkit:function(){return"undefined"!=typeof window.AudioContext&&"undefined"!=typeof AudioBufferSourceNode?(r=s,!0):!1},errorCallback:function(e){var t="";switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:t="You aborted the audio playback.";break;case e.target.error.MEDIA_ERR_NETWORK:t="A network error caused the audio download to fail.";break;case e.target.error.MEDIA_ERR_DECODE:t="The audio playback was aborted due to a corruption problem or because the audio used features your browser did not support.";break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:t="The song can not be loaded, either because the server or network failed or because the format is not supported.";break;default:t="An unknown error occurred."}Events.trigger(Events.player_widget.notify,"widgetError"),DZ.displayException(t),dzPlayer.control.nextSong()},loadSong:function(){r.player.src=r.sngpath,r.player.load(),r.sendProp("pourcentLoaded",0),r.sendProp("loading",!0),r.songLoaded=!0},getSongPath:function(e){if("undefined"!=typeof e.TYPE&&"JINGLE"===e.TYPE)var t=e.URL;else var t=SOUND_PREVIEW_GATEWAY.replace("{0}",e.MD5_ORIGIN.substr(0,1)).replace("{1}",e.MD5_ORIGIN).replace("{2}",e.MEDIA_VERSION);return t},sendProp:function(e,t){dzPlayer.setPropValue(e,t,"HTML5Player")},callMethod:function(e,t){"undefined"!=typeof e&&"undefined"!=typeof r[e]&&(t=t||null,r[e](t))},setAudioJingle:function(e){var t=[[{TYPE:"JINGLE",URL:e[0].audio.url}],null,!0];r.audioPlayer_playTracks(t),r.jingle=!0},audioPlayer_setVolume:function(e){r.player.volume=e[0]},audioPlayer_mute:function(e){r.isMuted=e[0],r.isMuted?(r.currentVolume=r.player.volume,r.player.volume=0):r.player.volume=r.currentVolume},audioPlayer_playTracks:function(e){r.sngpath=r.getSongPath(e[0][0]),r.songLoaded=!1,r.canPlay=!1,r.position=0,r.duration=30,r.sendProp("position",0),r.sendProp("duration",30),e[2]&&r.audioPlayer_play(),window.setTimeout(function(){r.sendProp("duration",30)},0)},audioPlayer_play:function(){r.playing=!0,r.songLoaded||r.loadSong(),r.player.play(),r.sendProp("paused",!1),r.sendProp("playing",!0)},audioPlayer_pause:function(e){r.player.pause(),r.sendProp("paused",!0),r.sendProp("playing",!1)},audioPlayer_seek:function(e){var t=e[0]*r.duration;r.player.currentTime=Math.floor(t),r.position=Math.floor(t),r.sendProp("position",r.position)},evt_play:function(){},evt_paused:function(){},evt_progress:function(){},evt_canplay:function(){r.canPlay=!0,r.playing&&r.audioPlayer_play(),r.sendProp("pourcentLoaded",5),r.sendProp("loading",!0)},evt_canplaythrough:function(){r.sendProp("pourcentLoaded",100),r.sendProp("loading",!1)},evt_timeupdate:function(){var e=Math.floor(r.player.currentTime);r.position!==e&&(r.position=e,r.sendProp("position",r.position))},evt_ended:function(){r.sendProp("playing",!1),r.sendProp("position",0),r.sendProp("duration",0),r.sendProp("finish",!0),r.jingle&&(r.sendProp("finishJingle",!0),r.jingle=!1),r.playing=!1}},s=n.extend({},r,{context:null,source:null,gainNode:null,panner:null,audioBuffer:null,timerPlayProgress:null,currentDuration:0,firstSongLoaded:!1,init:function(){return"undefined"==typeof window.AudioContext?!1:(r.initSound(),r.sendProp("playerLoaded",!0),!0)},initSound:function(){null===r.context&&(r.context=new window.AudioContext),r.context.createGain||(r.context.createGain=r.context.createGainNode),r.gainNode=r.context.createGain(),r.gainNode.gain.value=r.currentVolume,r.sendProp("volume",r.currentVolume),r.source=r.context.createBufferSource(),r.source.connect(r.gainNode,0),r.gainNode.connect(r.context.destination,0),r.initBuffer()},initBuffer:function(){null!==r.source&&null!==r.context&&null!==r.audioBuffer&&(r.source.buffer=r.audioBuffer,r.source.loop=!1,r.source.connect(r.context.destination,0))},resetPlayer:function(){r.source.disconnect(0),r.playing=!1,r.songLoaded=!1,r.currentDuration=0,clearInterval(r.timerPlayProgress),r.timerPlayProgress=null},play:function(){return r.playing===!0||r.songLoaded===!1||"undefined"!=typeof r.source.playbackState&&r.source.playbackState===AudioBufferSourceNode.PLAYING_STATE?!1:(r.initSound(),r.source.start||(r.source.start=r.source.start.noteOn),r.source.start(0,r.currentDuration),r.playing=!0,r.duration=30,r.sendProp("position",r.currentDuration),r.sendProp("duration",30),r.sendProp("paused",!1),r.sendProp("playing",!0),window.setTimeout(function(){r.sendProp("duration",30)},0),void(null===r.timerPlayProgress&&(r.timerPlayProgress=setInterval(function(){r.onProgress()},1e3))))},loadSong:function(e){if(r.songLoaded)return!0;var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){null!==r.context&&r.sngpath===e&&r.context.decodeAudioData(t.response,function(t){return r.audioBuffer=t,r.songLoaded=!0,r.play(),null!==r.sngpath&&r.sngpath!==e&&(r.audioPlayer_pause(),r.resetPlayer(),r.initSound()),!0},function(){return!1})},t.send()},audioPlayer_playTracks:function(e){var t=r.getSongPath(e[0][0]);r.playing===!0&&r.audioPlayer_pause(),r.resetPlayer(),r.initSound(),r.sngpath=t,e[2]&&r.audioPlayer_play(t)},audioPlayer_play:function(e){r.songLoaded?r.play():r.loadSong(e)},audioPlayer_pause:function(){return r.source.stop||(r.source.stop=r.source.start.noteOff),r.source.stop(0),r.playing=!1,r.sendProp("paused",!0),r.sendProp("playing",!1),!0},audioPlayer_setVolume:function(e){var t=parseInt(100*e[0],10)/100;0===t&&(t=-1),r.gainNode.gain.value=t},audioPlayer_mute:function(e){r.isMuted=e[0],r.isMuted?(r.currentVolume=r.gainNode.gain.value,r.gainNode.gain.value=-1):r.gainNode.gain.value=r.currentVolume},audioPlayer_seek:function(e){var t=e[0]*r.duration;r.currentDuration=Math.floor(t),r.playing===!0&&(r.audioPlayer_pause(),r.play(r.currentDuration)),r.source.onended=function(){r.play()}},onProgress:function(){r.playing&&(r.currentDuration++,r.position=r.currentDuration,r.sendProp("position",r.position),null!==r.audioBuffer&&r.currentDuration>=30&&r.onEnd())},onEnd:function(){r.sendProp("paused",!0),r.sendProp("playing",!1),r.sendProp("position",0),r.sendProp("duration",0),r.sendProp("finish",!0),r.jingle&&(r.sendProp("finishJingle",!0),r.jingle=!1),r.resetPlayer()}});t.exports=r},{jquery:"jquery"}],276:[function(e,t,a){"use strict";var n={trackMd5:null,containerId:"track-waveform",waveform:null,data:[],bgColor:"transparent",frontColor:"#3A373C",progressColor:"#007FEB",init:function(e,t,a,n,r,s){this.waveform=null,this.trackMd5=e,this.data=[],"undefined"!=typeof t&&null!==t&&(this.containerId=t),"undefined"!=typeof n&&null!==n&&(this.progressColor=n),"undefined"!=typeof r&&null!==r&&(this.frontColor=r),"undefined"!=typeof s&&null!==s&&(this.bgColor=s),this.loadWaveformData(),"undefined"!=typeof a&&null!==a&&this.update(parseInt(a,10)),window.addEventListener("resize",this.resize)},resize:function(){n.loadWaveformData()},update:function(e){if(null!==this.waveform){var t=this;e*=1e4,this.waveform.innerColor=function(a,n){if(a=Math.round(1e6*a),a>e)var r=t.frontColor;else var r=t.progressColor;return a%2===0?r:t.bgColor},this.waveform.update({data:t.data})}else this.init()},loadWaveformData:function(e){if("undefined"!=typeof this.trackMd5&&null!==this.trackMd5&&""!==this.trackMd5){"undefined"==typeof e&&(e=!0);try{var t=this;$.ajax({url:SETTING_DOMAIN_IMG+"/waveform/"+t.trackMd5+"-0.jsonp",crossDomain:!0,contentType:"application/json",dataType:"JSONP",jsonpCallback:"DZ_WAVEFORM_API_CALLBACK",type:"GET",success:function(a){if("undefined"!=typeof a.waveform){var n=Math.max.apply(null,a.waveform);for(var r in a.waveform)t.data.push(a.waveform[r]/n);e===!0&&t.createWaveform()}}})}catch(a){this.data=[]}}},createWaveform:function(){if(null!==document.getElementById(this.containerId)){document.getElementById(this.containerId).innerHTML="";var e=this;this.waveform=new Waveform({container:document.getElementById(e.containerId),data:e.data,innerColor:function(t,a){return Math.round(1e4*t)%2===0?"#333333":e.bgColor}})}},getData:function(){return this.data}};t.exports=n},{}]},{},[7]);;
if(typeof platform=='undefined'){var platform={init:function(){if(typeof PLATFORM_OBJ!=='object'){PLATFORM_OBJ={name:'web'};}
if(PLATFORM_OBJ.name===false){PLATFORM_OBJ.name='web';}
platform.data=PLATFORM_OBJ;},get:function(){return platform.data;}}};
var error={i:0,not_loged_error:{VALID_TOKEN_REQUIRED:true,NEED_USER_AUTH_REQUIRED:true},display:function(e){console.log('ERROR API:',e);console.log(e.name);},log:function(e){if(typeof e!=='object'){return false;}
if(typeof error.not_loged_error[e.name]!=='undefined'){return false;}
error.i+=1;var err={name:'',message:'',description:'',payload:'',stack:''};if(typeof e.name!=='undefined'){err.name=e.name;}
if(typeof e.message!=='undefined'){err.message=e.message;}
if(typeof e.description!=='undefined'){err.description=e.description;}
if(typeof e.payload!=='undefined'&&e.payload!==null){err.payload=e.payload;}
if(typeof e.stack!=='undefined'){err.stack=e.stack;}
live.log.send('app_error',{error:err,nb:error.i});console.log('Error #'+error.i);console.log(err.name);console.log(err.message);console.log(err.description);console.log(err.payload);console.log(err.stack);console.log('');return true;},handle:function(e){error.log(e);error.display(e);return true;}};function dzError(obj){this.name=obj.name||'dzError';this.message=obj.message||'';this.description=obj.description||'';this.payload=obj.payload||null;var e=new Error();this.stack=e.stack;};
(function(){var api_error_handler={'playlist.addSongs':function(e){if(e.name==='ERROR_DATA_EXISTS'){notification.display(null,{message:gettext('Ce titre a dj t ajout  la playlist')});return true;}
if(e.name==='QUOTA_ERROR'){modal.open('/lightbox/api_error?type=PLAYLIST_ADDSONGS_QUOTA_ERROR',true);return true;}
return false;},'playlist.create':function(e){if(e.name==='ERROR_QUOTA'){modal.open('/lightbox/api_error?type=PLAYLISTS_ERROR_QUOTA',true);return true;}
return false;}};window.api={uniqId:0,callParameters:{method:'',data:{},success:function(){},error:null,callback_parameters:{},retry:0},getUniqId:function(){if(api.uniqId===0){api.uniqId=util.uniqid();}
return api.uniqId;},call:function(options){if(arguments.length>1){options={method:arguments[0]||'',data:arguments[1]||{},success:arguments[2]||function(){},callback_parameters:arguments[3]||{},retry:arguments[5]||0}}
if(!Array.isArray(options)){options=[options];}
var post_values=[];for(var i=0;i<options.length;i++){options[i]=$.extend({},api.callParameters,options[i]);if(options[i].method===''){throw'Missing method_name in api.call';}
if(options[i].retry>=4){return false;}
post_values.push({method:options[i].method,params:options[i].data});}
var url='/ajax/gw-light.php?api_version=1.0&api_token='+encodeURIComponent(checkForm)+'&input=3&cid='+api.getUniqId();sendRequest(url,'text',JSON.stringify(post_values),true,function(xhr){api.callback(xhr.responseText,options);},null);return true;},callback:function(request,options){try{var methods=[];for(var i=0;i<options.length;i++){methods.push(options[i].method);}
if(request==''){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:{methods:methods.join('|')}});}
request=JSON.parse(request);if(!Array.isArray(request)){throw new dzError({name:'BAD_REQUEST',message:'Api error',description:'BAD_REQUEST',payload:{methods:methods.join('|')}});}
var errors=[];var exception_payload;for(var i=0;i<request.length;i++){exception_payload={method:options[i].method,methods:methods.join('|')};try{var result=api.getResult(request[i],exception_payload);options[i].success(result,options[i].callback_parameters);}catch(e){if(e.name==='VALID_TOKEN_REQUIRED'||e.name==='NEED_USER_AUTH_REQUIRED'){api.ping(options.slice(i));return false;}
if(typeof options[i].error==='function'&&options[i].error(e,options[i].callback_parameters)){continue;}
if(typeof api_error_handler[options[i].method]==='function'&&api_error_handler[options[i].method](e)){continue;}
errors.push(e);}}
for(var i=0;i<errors.length;i++){error.log(errors[i]);if(i===0){error.display(errors[i]);}}
if(errors.length>0){return false;}
return true;}catch(e){error.handle(e);}},getResult:function(request,exception_payload){exception_payload=exception_payload||null;if(typeof request!='object'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
if(typeof request.results==='undefined'||typeof request.error==='undefined'){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
for(var i in request.error){if(!request.error.hasOwnProperty(i)){continue;}
throw new dzError({name:i,message:'Api error',description:request.error[i],payload:request.payload||null});}
if(countObject(request.results)===0){throw new dzError({name:'REQUEST_EMPTY',message:'Api error',description:'REQUEST_EMPTY',payload:exception_payload});}
return request.results;},ping:function(options){api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;modal.open('/lightbox/no_session.php');return false;}
USER.USER_ID=result.USER_ID;SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;options.retry+=1;api.call(options);}
return true;},{},'ping',options.retry+1);return true;}};}());;
if(typeof storage=='undefined'){var storage={init:function(){if(document.cookie.indexOf('USER_CHECKSUMS_'+USER.USER_ID)>-1){var c=document.cookie.split('; ');for(var i in c){setCookie(c[i],'',-1);}
window.location='';}},formatKey:function(key){return key+'_'+USER.USER_ID;},get:function(key,default_value){var value;if(!storage.isset(key)){return(typeof default_value!=='undefined'?default_value:false);}
key=storage.formatKey(key);if(Modernizr.localstorage){value=window.localStorage.getItem(key);}else if(getCookie(key)!==''){value=getCookie(key);}else{return false;}
return JSON.parse(value);},set:function(key,value,fallback,expiredays){key=storage.formatKey(key);value=JSON.stringify(value);if(typeof fallback!=='boolean'){fallback=true;}
if(Modernizr.localstorage){try{window.localStorage.setItem(key,value);}catch(e){window.error.log(e);}}else if(fallback){if(typeof expiredays==='undefined'){expiredays=365;}
setCookie(key,value,expiredays);}
return true;},isset:function(key){key=storage.formatKey(key);if(Modernizr.localstorage){if(typeof window.localStorage[key]==='undefined'||window.localStorage[key]===null){return false;}
return true;}
if(getCookie(key)===''){return false;}
return true;}};};
if(typeof Events==='undefined'){var Events={evts:{},deferredObjects:[],ready:function(evt,callback){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].done(callback);},resolve:function(evt,args){if(typeof Events.deferredObjects[evt]==='undefined'){Events.deferredObjects[evt]=$.Deferred();}
Events.deferredObjects[evt].resolve(args);},subscribe:function(evt,callback,group){if(typeof group==='string'){return Events.addEvent(group,evt,callback);}
$(document).unbind(evt,callback).bind(evt,callback);},addEvent:function(group,evt,callback){if(typeof group!=='string'||typeof evt!=='string'||typeof callback!=='function'){return false;}
if(typeof Events.evts[group]==='undefined'){Events.evts[group]=[];}
Events.evts[group].push({fct:callback,evt:evt});Events.subscribe(evt,callback);},unsubscribeAll:function(group){if(typeof group!=='string'||typeof Events.evts[group]==='undefined'){return false;}
for(var i=0;i<Events.evts[group].length;i++){var evt=Events.evts[group][i];Events.unsubscribe(evt.evt,evt.fct);}
Events.evts[group]=null;delete Events.evts[group];},subscribeOnce:function(evt,callback,group){if(typeof group!=='string'){group=null;}
Events.subscribe(evt,function(event,args){if(typeof callback==='function'){callback(event,args);}
Events.unsubscribe(evt,event.handleObj.handler);},group);},unsubscribe:function(evt,handler){$(document).unbind(evt,handler);},trigger:function(evt,args){if(typeof args=='undefined'){args=null;}
$(document).trigger(evt,[args]);},player:{playerLoaded:'EVENT.PLAYER.playerLoaded',playerReady:'DEFERRED.PLAYER.playerReady',playing:'EVENT.PLAYER.playing',fading:'EVENT.PLAYER.fading',play:'EVENT.PLAYER.play',resume:'EVENT.PLAYER.resume',paused:'EVENT.PLAYER.pause',displayNextSong:'EVENT.PLAYER.displayNextSong',displayCurrentSong:'EVENT.PLAYER.displayCurrentSong',displayEmptyPlayer:'EVENT.PLAYER.displayEmptyPlayer',duration:'EVENT.PLAYER.duration',position:'EVENT.PLAYER.position',seek:'EVENT.PLAYER.seek',prcPosition:'EVENT.PLAYER.prcPosition',pourcentLoaded:'EVENT.PLAYER.pourcentLoaded',loading:'EVENT.PLAYER.loading',log:'EVENT.PLAYER.log',log_offline:'EVENT.PLAYER.log_offline',track_end:'EVENT.PLAYER.track_end',finish:'EVENT.PLAYER.finish',finishPreview:'EVENT.PLAYER.finishPreview',finishAds:'EVENT.PLAYER.finishAds',finishJingle:'EVENT.PLAYER.finishJingle',finishTrackList:'EVENT.PLAYER.finishTrackList',setTrackList:'EVENT.PLAYER.setTrackList',fade:'EVENT.PLAYER.fade',changePlayerType:'EVENT.PLAYER.changePlayerType',hq:'EVENT.PLAYER.hq',volume:'EVENT.PLAYER.volume',volume_changed:'EVENT.PLAYER.volume_changed',refreshSoundBar:'EVENT.PLAYER.refreshSoundBar',forceCloseMix:'EVENT.PLAYER.forceCloseMix',notify:'EVENT.PLAYER.notify',repeat_changed:'EVENT.PLAYER.repeat_changed',shuffle_changed:'EVENT.PLAYER.shuffle_changed',mute_changed:'EVENT.PLAYER.mute_changed',error:'EVENT.PLAYER.error',order_changed:'EVENT.PLAYER.order_changed',user_status:'EVENT.PLAYER.user_status',updateRestrictTime:'EVENT.PLAYER.updateRestrictTime',adsVastPlaying:'EVENT.PLAYER.adsVastPlaying',preloadComplete:'EVENT.PLAYER.preloadComplete',preloadAborted:'EVENT.PLAYER.preloadAborted',tracklist_changed:'EVENT.PLAYER.tracklist_changed',blind_test_mode_changed:'EVENT.PLAYER.blind_test_mode_changed',seekCompleted:'EVENT.PLAYER.seekCompleted',setBookmark:'EVENT.PLAYER.setBookmark'},player_widget:{loaded:'EVENT.PLAYER_WIDGET.loaded',tracksLoaded:'EVENT.PLAYER_WIDGET.tracksLoaded',notify:'EVENT.PLAYER_WIDGET.notify',displayLayer:'EVENT.PLAYER_WIDGET.displayLayer',removeOverlay:'EVENT.PLAYER_WIDGET.removeOverlay'},flow:{playerDisplay:'DEFERRED.FLOW.playerDisplay'},menu:{contextMenu:'EVENT.MENU.contextMenu',contextMenuOpen:'EVENT.MENU.contextMenuOpen',contextMenuClose:'EVENT.MENU.contextMenuClose',resize:'EVENT.MENU.resize',panel_mounted:'EVENT.MENU.panel_mounted',closeAllPanels:'EVENT.MENU.closeAllPanels',openPanel:'EVENT.MENU.openPanel',togglePanel:'EVENT.MENU.togglePanel'},user:{initialized:'DEFERRED.USER.initialized',loaded:'DEFERRED.USER.loaded',clickFavorite:'EVENT.USER.clickFavorite',addFavorite:'EVENT.USER.addFavorite',deleteFavorite:'EVENT.USER.deleteFavorite',shareClick:'EVENT.USER.shareClick',login:'EVENT.USER.login',logout:'EVENT.USER.logout',userReady:'DEFERRED.USER.userReady',dataStoreReady:'DEFERRED.USER.dataStoreReady',settingChanged:'EVENT.USER.settingChanged',blockFriend:'EVENT.USER.blockFriend',unblockFriend:'EVENT.USER.unblockFriend',updatePicture:'EVENT.USER.updatePicture',uploadPicture:'EVENT.USER.uploadPicture',updateName:'EVENT.USER.updateName',updateSearchHistory:'EVENT.USER.updateSearchHistory',userLoadData:'EVENT.USER.userLoadData',updateEpisodeBookmark:'EVENT.USER.updateEpisodeBookmark',addPersonalSong:'EVENT.USER.addPersonalSong',updatePersonalSong:'EVENT.USER.updatePersonalSong',sendPersonalSong:'EVENT.USER.sendPersonalSong',progressPersonalSong:'EVENT.USER.progressPersonalSong'},genre:{loaded:'EVENT.GENRE.loaded'},live:{connected:'EVENT.LIVE.connected',simultaneousAccess:'EVENT.LIVE.simultaneousAccess',newMessage:'EVENT.LIVE.newMessage',newFriendInvitation:'EVENT.LIVE.newFriendInvitation',newFriendship:'EVENT.LIVE.newFriendship',newNotif:'EVENT.LIVE.newNotif',readNotif:'EVENT.LIVE.readNotif',ready:'EVENT.LIVE.ready',feed:'EVENT.LIVE.feed',limitation:'EVENT.LIVE.limitation',device_sync:'EVENT.LIVE.device_sync',pagefeed:'EVENT.LIVE.pagefeed',events:'EVENT.LIVE.events'},offline:{reminder:'EVENT.OFFLINE.reminder'},playlist:{addSong:'EVENT.PLAYLIST.addSong',removeSong:'EVENT.PLAYLIST.removeSong',created:'EVENT.PLAYLIST.created',removed:'EVENT.PLAYLIST.removed',updated:'EVENT.PLAYLIST.updated',trackListUpdated:'EVENT.PLAYLIST.trackListUpdated',seen:'EVENT.PLAYLIST.seen',uploadPicture:'EVENT.PLAYLIST.uploadPicture',updatePicture:'EVENT.PLAYLIST.updatePicture',assistantValidation:'EVENT.PLAYLIST.assistantValidation',assistantSuggestFinish:'EVENT.PLAYLIST.assistantSuggestFinish',assistantSuggestEmpty:'EVENT.PLAYLIST.assistantSuggestEmpty',assistantToggleValidation:'EVENT.PLAYLIST.assistantToggleValidation',assistantAddedTrack:'EVENT.PLAYLIST.assistantAddedTrack'},profile:{allCoverLoaded:'EVENT.PROFILE.allCoverLoaded'},layout:{width_type:'EVENT.LAYOUT.width_type',scroll:'EVENT.LAYOUT.scroll',infiniteScroll:'EVENT.LAYOUT.infiniteScroll',resize:'EVENT.LAYOUT.resize',adsBackground:'EVENT.LAYOUT.adsBackground',adsBanner:'EVENT.LAYOUT.adsBanner'},navigation:{page_changed:'EVENT.NAVIGATION.page_changed',page_loaded:'EVENT.NAVIGATION.page_loaded',page_displayed:'EVENT.NAVIGATION.page_displayed',modal_displayed:'EVENT.NAVIGATION.modal_displayed',modal_open:'EVENT.NAVIGATION.modal_open',modal_close:'EVENT.NAVIGATION.modal_close',context_menu_close:'EVENT.NAVIGATION.context_menu_close',tab_displayed:'EVENT.NAVIGATION.tab_displayed',page_updated:'EVENT.NAVIGATION.page_updated',page_initialized:'DEFERRED.NAVIGATION.page_initialized'},datagrid:{displayed:'EVENT.DATAGRID.displayed',onAirPosition:'EVENT.DATAGRID.onAirPosition',allTracksDisplayed:'EVENT.DATAGRID.allTracksDisplayed',allTracksSelected:'EVENT.DATAGRID.allTracksSelected',removedTrack:'EVENT.DATAGRID.removedTrack',replacedTrack:'EVENT.DATAGRID.replacedTrack'},album:{checkReplace:'EVENT.ALBUM.checkReplace',noReplaceNeed:'EVENT.ALBUM.noReplaceNeed'},radio:{start:'EVENT.RADIO.start'},lightbox:{close:'EVENT.LIGHTBOX.close'},search:{loaded:'EVENT.SEARCH.loaded',suggestDisplayed:'EVENT.SEARCH.suggestDisplayed',suggestClicked:'EVENT.SEARCH.suggestClicked'},tabs:{open:'EVENT.TABS.open'},modal:{close:'EVENT.MODAL.close'},googleplus:{ready:'EVENT.GOOGLEPLUS.ready'},facebook:{user_status:'EVENT.FACEBOOK.user_status'},chromecast:{status:'EVENT.CHROMECAST.status',removeFocus:'EVENT.CHROMECAST.removeFocus',closeIntro:'EVENT.CHROMECAST.closeIntro'},lyrics:{load:'EVENT.LYRICS.load',seek:'EVENT.LYRICS.seek'},gigs:{display:'EVENT.GIGS.display'},copy:{after:'EVENT.COPY.after'},tag:{select:'EVENT.TAG.select'},talk:{bookmarkSet:'EVENT.TALK.bookmarkSet'},tips:{close:'EVENT.TIPS.close',draw:'EVENT.TIPS.draw'},tooltip:{show:'EVENT.TOOLTIP.show',hide:'EVENT.TOOLTIP.hide'}};};
if(typeof tracking==='undefined'){var tracking={initialized:false,random_id:0,events_options:{mobile_session:{sampling:5},mobile_install:{sampling:5},unlogged_home_display:{sampling:5},navigation:{sampling:0,websocket:true},search_trigger:{sampling:5},search_results:{sampling:5},add_to_favorite:{sampling:5},headermenu_click:{sampling:5},menu_click:{sampling:5,websocket:true},usermenu_click:{sampling:5},player_click:{sampling:5},context_menu_click:{sampling:5},panel_click:{sampling:5},flow_click:{sampling:5},chromecast_open_menu_click:{sampling:5},chromecast_menu_choice_click:{sampling:5},add_to_playlist:{sampling:5},playlist_create:{sampling:5},upgrade_ui_box_display:{sampling:5},upgrade_ui_box_click:{sampling:5},backstage_landing_elite:{sampling:5},display_page:{sampling:5},landing_display:{sampling:5},unlogged_home_click:{sampling:5},soon_display:{sampling:5},soon_click:{sampling:5},top_playlists_click:{sampling:5},newhome_box_display:{sampling:5},telco_offer_lb_display:{sampling:100,websocket:true},telco_offer_lb_click:{sampling:100,websocket:true},sonos_bundle_display:{sampling:100,websocket:true},sonos_bundle_learnmore_click:{sampling:100,websocket:true},sonos_bundle_subscribe_click:{sampling:100,websocket:true},artist_page_click:{sampling:5},discography_click:{sampling:5}},double_tag:{menu_click:{properties:{type:'offers_subscribe'},tracking:{event_name:'offers_subscribe_click',properties:{origin:'menu_push_subscription'}}}},init:function(){Events.ready(Events.user.loaded,tracking.register);Events.subscribe(Events.user.logout,tracking.unregister);Events.subscribe(Events.user.addFavorite,function(evt,params){if(params.type==='disliked_song'){return false;}
var props={type:params.type,id:params.id};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_favorite',props);mixpanel.people.increment('add_favorite');});Events.subscribe(Events.playlist.created,function(evt,params){tracking.track('playlist_create',{id:params.id});mixpanel.people.increment('playlist_create');});Events.subscribe(Events.playlist.addSong,function(evt,params){var props={id:params.playlist_id,position:params.position||-1};tracking.addFavoriteContext(props,params.context);tracking.track('add_to_playlist',props);});Events.subscribe(Events.navigation.page_changed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{page:params.path}});});Events.subscribe(Events.navigation.modal_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{modal:params.modal}});});Events.subscribe(Events.navigation.tab_displayed,function(evt,params){tracking.track('navigation',{event:'onDisplay',properties:{tab:params.type}});});tracking.random_id=Math.floor(Math.random()*10000);tracking.registerABTest();tracking.initialized=true;return true;},check_mixpanel:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return true;}
var sampling_value=tracking.events_options[event_name].sampling;var id=USER.USER_ID===0?tracking.random_id:USER.USER_ID;if(id%100<sampling_value){return true;}
return false;},check_websocket:function(event_name){if(typeof tracking.events_options[event_name]==='undefined'){return false;}
if(typeof tracking.events_options[event_name].websocket!=='undefined'&&tracking.events_options[event_name].websocket){return true;}
return false;},track:function(event_name,properties,callback){if(typeof mixpanel==='undefined'){return false;}
if(typeof callback!=='function'){callback=function(){};}
if(typeof properties==='undefined'){properties={};}
if(tracking.check_websocket(event_name)){live.log.send(event_name,properties);}
if(typeof SESSION_DURATION==='number'){properties.session_duration=SESSION_DURATION;}
if(typeof tracking.double_tag[event_name]==='object'){var intersect_properties=intersectObject(properties,tracking.double_tag[event_name].properties);if(compareObject(intersect_properties,tracking.double_tag[event_name].properties)){var re_track=tracking.double_tag[event_name].tracking;tracking.track(re_track.event_name,re_track.properties);}}
if(tracking.check_mixpanel(event_name)){if(typeof tracking.events_options[event_name]==='object'){if(USER.USER_ID===0){properties.sampled_unique_id=tracking.events_options[event_name].sampling;}else{properties.sampled=tracking.events_options[event_name].sampling;}}
mixpanel.track(event_name,properties,callback);}else{callback();}
return true;},register:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={USER_ID:USER.USER_ID,USER_AGE:USER.USER_AGE,USER_GENDER:USER.USER_GENDER,FB_USER_ID:USER.FACEBOOK.UID,DZ_COUNTRY:COUNTRY,TWITTER:(typeof USER.TWITTER.TOKEN==='string'),OFFER_ID:OFFER_ID,TRY_AND_BUY:USER.TRY_AND_BUY.ACTIVE};mixpanel.register(data);mixpanel.people.identify(USER.USER_ID.toString());mixpanel.people.set({$last_login:timestampToDate(SERVER_TIMESTAMP,true),$created:USER.INSCRIPTION_DATE,$country_code:COUNTRY,offer_id:[OFFER_ID],age:USER.USER_AGE,gender:USER.USER_GENDER});return true;}catch(e){error.log(e);}},unregister:function(){var data=['USER_ID','USER_AGE','USER_GENDER','FB_USER_ID','TWITTER'];for(var i=0;i<data.length;i++){mixpanel.unregister(data[i]);}
return true;},trackCampaign:function(){try{if(location.search.length===0){return false;}
var query_string=location.search.substr(1);var allowed_tags=['ref','utm_source','utm_medium','utm_term','utm_content','utm_campaign'];var nb_tags=allowed_tags.length;var query_params={};var query_buffer=query_string.split('&');while(typeof query_buffer[0]!=='undefined'){var param=query_buffer.shift().split('=');query_params[param[0]]=param[1];}
for(var i=0;i<nb_tags;i++){var tag=allowed_tags[i];if(typeof query_params[tag]!=='undefined'&&query_params[tag]!==''){var tracking_info={url:location.protocol+'//'+location.hostname+location.pathname,query_string:query_string};var mixpanel_data={};for(var j=0;j<nb_tags;j++){var _tag=allowed_tags[j];if(typeof query_params[_tag]!=='undefined'&&query_params[_tag]!==''){mixpanel_data[_tag]=query_params[_tag];}}
if(countObject(mixpanel_data)>0){mixpanel.register(mixpanel_data);tracking.track('display_page',$.extend(tracking_info,mixpanel_data));}
break;}}
return true;}catch(e){error.log(e);}},registerABTest:function(){try{if(typeof mixpanel==='undefined'){return false;}
var data={};for(var i in USER.ABTEST){if(!USER.ABTEST.hasOwnProperty(i)){continue;}
data[USER.ABTEST[i].id]=USER.ABTEST[i].option;}
mixpanel.register(data);}catch(e){error.log(e);}},addFavoriteContext:function(data,context){try{context=context||naboo.getCurrentClass();if(context==='profile'){context=(profile.tab==='loved')?profile.tab:context;context=(profile.id==USER.USER_ID?'my_':'other_')+context;}
if(context==='playlist'){context=(playlist.isPersonal?'my_':'other_')+context;}
if(context==='artist'&&data.type==='artist'){data.main_artist=(data.id==artist.id);}
data.context=context;}catch(e){error.log(e);}},trackFormEvent:function($element,event,error){var properties=tracking.createFormFieldProperties($element);properties.event='on'+ucfirst(event);if(error){properties.error=error;}
tracking.track('navigation',properties);},createFormFieldProperties:function($field){var properties={};properties.id=$field.attr('id')||'';properties.type=$field.prop('tagName');properties.attributes={};$.each($field.get(0).attributes,function(){properties.attributes[this.name]=this.value;});return properties;}};};
(function(){'use strict';if(typeof window.EventsDelegation!=='undefined'){return;}
var tooltipDelayId;var EventsDelegation={mousedDownFired:false,excludeTracking:{play:true},initMouseClickEvents:function(){try{$(document).on('click','.evt-click',function(e){e.stopPropagation();e.preventDefault();var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(OFFLINE){if(typeof data.play!=='undefined'){dzoffline.display();}
return false;}
var action_list=['play','playNext','share','favorite','curator','link','close','tabs','deletePicture','changePicture','loginFacebook','registerFacebook','modal','redirect','userBlock','connect','login','register'];if(typeof $this.attr('href')!=='undefined'){data.link=$this.attr('data-link')||1;}
Events.ready(event_name,function(){for(var a in action_list){if(!action_list.hasOwnProperty(a)){continue;}
var action=action_list[a];if(typeof data[action]!=='undefined'&&parseInt(data[action],10)!==0){EventsDelegation[action]($this,data);}}
delete Events.deferredObjects[event_name];});EventsDelegation.tracking($this,data,event_name);});return true;}catch(e){error.log(e);}},initMouseOverEvents:function(){try{$(document).on('mouseenter','.evt-over',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&!$(this).is('.active')){var tooltip_data={fallback:data.tooltipFallback||$.fn.tipsy.defaults.fallback,gravity:data.tooltipGravity||$.fn.tipsy.defaults.gravity,trigger:data.tooltipTrigger||'manual',offset:(typeof data.tooltipOffset!=='undefined')?parseInt(data.tooltipOffset,10):$.fn.tipsy.defaults.offset,force_top:(typeof data.tooltipForceTop!=='undefined')?Boolean(parseInt(data.tooltipForceTop,10)):$.fn.tipsy.defaults.force_top};$(this).tipsy(tooltip_data);if(typeof data.tooltipDelay!=='undefined'){var element=$(this);tooltipDelayId=setTimeout(function(){element.tipsy('show');},data.tooltipDelay);}else{$(this).tipsy('show');}}
if(typeof data.hovercard!=='undefined'){hovercard.init($(this));}
return true;});return true;}catch(e){error.log(e);}},initMouseOutEvents:function(){try{$(document).on('mouseleave','.evt-out',function(e){e.stopPropagation();e.preventDefault();var data=$(this).data();if(typeof tooltipDelayId!=='undefined'&&tooltipDelayId>0){clearTimeout(tooltipDelayId);tooltipDelayId=0;}
if(typeof data.tooltip!=='undefined'&&data.tooltip===1&&typeof $(this).data('tipsy')!=='undefined'){$(this).tipsy('hide');}
if(typeof data.hovercard!=='undefined'){hovercard.remove();}
if(typeof data.cancelHover!=='undefined'){$(this).removeClass('evt-out evt-over cancel-hover');}
if(typeof data.play!=='undefined'&&data.play===1){clearTimeout(preview.timer);if(preview.active){preview.stop();}}
return true;});return true;}catch(e){error.log(e);}},initMouseDownEvents:function(){try{$(document).on('mousedown','.evt-click',function(e){if(e.button===2){return false;}
var $this=$(this);var data=$this.data();var event_name='evt-click-'+util.uniqid();if(typeof data.play!=='undefined'&&data.play===1&&data.enablePreview){preview.timer=window.setTimeout(function(){if(typeof data.tracking!=='undefined'){data.trackingTag='preview';EventsDelegation.tracking($this,data,event_name);EventsDelegation.mousedDownFired=true;}else{Events.resolve(event_name);}
preview.init($this);if(!$this.is('.active')){$this.tipsy('hide');}},500);}
return false;});return true;}catch(e){error.log(e);}},play:function($this,data){try{if(typeof data.type==='undefined'){return false;}
clearTimeout(preview.timer);if(preview.active){preview.stop();return true;}
if(preview.naturalFinish){preview.naturalFinish=false;return true;}
var params={type:data.type,context:{TYPE:'unknow',ID:0}};if(typeof data.id!=='undefined'){params.id=data.id;}
if(typeof data.playAuto==='boolean'){params.autoplay=data.playAuto;}
if(typeof data.radio==='boolean'){params.radio=data.radio;}
if(typeof data.playIndex==='number'){params.index=data.playIndex;}
if(typeof data.playSongList==='object'){params.data=data.playSongList;}
if(typeof data.playContext==='string'){params.context={TYPE:data.playContext,ID:data.id};}
if(typeof data.playContextId!=='undefined'){params.context.CONTEXT_ID=data.playContextId;}
var currentContext=dzPlayer.getContext();if((currentContext!==null&&LOG_CONTEXT[currentContext.TYPE]===LOG_CONTEXT[params.context.TYPE]&&currentContext.ID==params.context.ID&&typeof params.index==='undefined')||(Number(dzPlayer.getCurrentSong('MEDIA_ID'))===params.id)){EventsDelegation.toggleTrackingStatus(data);dzPlayer.control.togglePause();return true;}
if(params.type==='song'){params.type='track';}
if(typeof window.feed==='object'&&window.feed.is_webview===true){var type=((params.radio===true)?'radio/':'')+data.type;window.location='dzr://'+type+'/'+data.id+'?action=play';return true;}
dzPlayer.play(params);EventsDelegation.setSentToMobile($this,data);return true;}catch(e){error.log(e);}},setSentToMobile:function($this,data){if(data.isSentToMobile){if(thumbnails.push_mobile%3===0){$this.parent().find('[data-sent-to-mobile="1"]').addClass('active');}
thumbnails.push_mobile+=1;}
return true;},toggleTrackingStatus:function(data){if(typeof data.tracking==='undefined'){return false;}
data.tracking=(typeof data.tracking==='string')?'':!data.tracking;},playNext:function($this,data){try{if(typeof data.id==='undefined'){return false;}
api.call('song.getData',{SNG_ID:data.id,COUNTRY:COUNTRY},function(result){dzPlayer.addNextTracks([result]);return true;});return true;}catch(e){error.log(e);}},share:function($this,data){return sharebox.load(data.type,data.id);},favorite:function($this,data){try{if(typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
Events.trigger(Events.user.clickFavorite,$.extend({},data));if(typeof data.favoriteDelegate!=='undefined'){window[data.favoriteDelegate].favoriteAction($this,$.extend({},data));}else{favorite.action($this,$.extend({},data));}
return true;}catch(e){error.log(e);}},changePicture:function($this,data){try{Events.trigger(Events[data.type].uploadPicture);return true;}catch(e){error.log(e);}},userBlock:function($this,data){try{user[(data.blocked===0)?'block':'unblock']($this,data.id,null);return true;}catch(e){error.log(e);}},deletePicture:function($this,data){try{var post={};if(typeof data.id!=='undefined'){post[data.type+'_id']=data.id;}
api.call({method:data.type+'.deletePicture',data:post,success:function(){Events.trigger(Events[data.type].updatePicture,{md5:'',type:''});}});}catch(e){error.log(e);}},curator:function($this,data){try{if(typeof data.curatorAction==='undefined'||typeof data.type==='undefined'||typeof data.id==='undefined'){return false;}
switch(data.curatorAction){case'push_album':if(data.type==='album'){modal.open('/lightbox/curators/push_album/'+data.id);}
break;case'genre_album':if(data.type==='album'){modal.open('/lightbox/curators/update_genre/'+data.id);}
break;default:break;}
return true;}catch(e){error.log(e);}},modal:function($this,data){try{if(data.modal==='/close'){modal.close();return true;}
var force=data.modalForce||false;modal.open(data.modal,force);return true;}catch(e){error.log(e);}},connect:function(){www.goToConnection();},login:function(){www.goToLogin();},register:function(){www.goToRegister();},loginFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=data.loginRedirect||'';var login_only=true;if(typeof data.loginOnly!=='undefined'){login_only=Boolean(data.loginOnly);}
tracking.trackFormEvent($this,'click');facebook.login({login_only:login_only,redirect:redirect});if(PLATFORM==='web'){modal.close();}
return true;}catch(e){error.log(e);}},registerFacebook:function($this,data){try{if(typeof data.loginRedirect==='string'&&data.loginRedirect.length>=4&&data.loginRedirect.substr(0,4)==='http'){window.location.href=data.loginRedirect;return true;}
var redirect=((data.loginRedirect)?data.loginRedirect:'')||'';if(PLATFORM!=='web'&&redirect!==''){window.location.href=redirect;return true;}
if(redirect!==Object(redirect)){redirect='';}
tracking.trackFormEvent($this,'click');window.auth.register.create_account_fb_click(redirect);return true;}catch(e){error.log(e);}},redirect:function($this,data){try{var redirect=data.redirect.toString();if(redirect.substr(0,1)==='/'||redirect.substr(0,4)==='http'){window.location.href=redirect;return true;}
var href=$this.attr('href');if(typeof href!=='string'||href.indexOf('javascript:')>-1||href===''){return false;}
window.location.href=href;return true;}catch(e){error.log(e);}},link:function($this,data){try{var href=$this.attr('href');var target=$this.attr('target');var is_webview=(typeof window.feed==='object'&&window.feed.is_webview===true);if(OFFLINE){return false;}
if(href.indexOf('javascript:')>-1||href===''){return false;}
if(href.substr(0,4)==='http'){var in_deezer=href.indexOf(SETTING_HOST)>-1;if(is_webview||in_deezer){if(in_deezer){href=href.replace(RegExp('https?://'+SETTING_HOST+'/'),'');href=is_webview?('dzr://'+href):('/'+href);}else{href='dzr://'+href;}
window.location=href;return true;}
window.open(href);return true;}
if(target==='_blank'){window.open(href);return true;}
if(href.charAt(0)==='/'&&!data.redirect){if(is_webview){window.location='dzr:/'+href;return true;}
loadBox(href);return true;}
return false;}catch(e){error.log(e);}},tabs:function($this){try{return tabs.navClick($this);}catch(e){error.log(e);}},close:function($this){try{$this.parents('[data-target="close"]').remove();return true;}catch(e){error.log(e);}},tracking:function($this,data,event_name){try{if(EventsDelegation.mousedDownFired===true||data.tracking===0||typeof data.trackingTag==='undefined'){EventsDelegation.mousedDownFired=false;Events.resolve(event_name);return false;}
if(typeof data.tracking==='string'&&typeof window[data.tracking]!=='undefined'&&typeof window[data.tracking].tracking==='function'&&typeof data.trackingId!=='undefined'){return window[data.tracking].tracking(data.trackingTag,data.trackingId,function(){Events.resolve(event_name);});}
var tracking_params={};if(typeof data.trackingParams!=='undefined'&&typeof data.trackingParams==='string'){tracking_params=$.extend(tracking_params,JSON.parse(data.trackingParams.replace(/'/g,'"')));}
Events.resolve(event_name);if(typeof EventsDelegation.excludeTracking[data.trackingTag]!=='undefined'){return false;}
tracking.track(data.trackingTag,tracking_params,function(){if(typeof data.trackingCallback==='string'){eval(data.trackingCallback);}});}catch(e){error.log(e);}}};EventsDelegation.initMouseOverEvents();EventsDelegation.initMouseOutEvents();EventsDelegation.initMouseDownEvents();EventsDelegation.initMouseClickEvents();window.EventsDelegation=EventsDelegation;})();;
(function(){'use strict';var FBApi=function(){this.app_ready=false;this.app_id=0;this.app_namespace='';this.app_scope='';this.api_version='';this.channel='';this.fb_uid='';this.access_token='';this.user_scopes=null;};FBApi.prototype.setFBUid=function(fb_uid){this.fb_uid=String(fb_uid||'');return this;};FBApi.prototype.setAccessToken=function(access_token){this.access_token=String(access_token||'');return this;};FBApi.prototype.getFBUid=function(){return this.fb_uid;};FBApi.prototype.getAccessToken=function(){return this.access_token;};FBApi.prototype.setAppData=function(data){if(this.app_ready){error.log(new Error('FBApi :: setAppData - App is already configured'));return this;}
if(data!==Object(data)||Array.isArray(data)){error.log(new Error('FBApi :: setAppData - data is not a valid object'));return;}
this.app_id=data.id||this.app_id;this.app_namespace=String(data.namespace||this.app_namespace);this.app_scope=String(data.scope||this.app_scope);this.api_version='v'+String(data.version||this.api_version);this.channel=String(data.channel||this.channel);this.app_ready=true;return this;};FBApi.prototype.unsetUserData=function(){this.fb_uid='';this.access_token='';};FBApi.prototype.getAppData=function(){return{id:this.app_id,namespace:this.app_namespace,scope:this.app_scope,version:this.api_version,channel:this.channel};};FBApi.prototype.getUserScopes=function(callback,force){if(typeof FB==='undefined'){error.log(new Error('FBApi :: getUserScopes - FB is undefined'));return;}
if(typeof callback!=='function'){error.log(new Error('FBApi :: getUserScopes - callback is not a valid function'));return;}
if(!this.fb_uid){error.log(new Error('FBApi :: getUserScopes - fb_uid is missing'));return;}
if(!this.access_token){error.log(new Error('FBApi :: getUserScopes - access_token is missing'));return;}
if(this.user_scopes!==null&&!force){setTimeout(callback.bind(this,this.user_scopes),0);return;}
FB.api('/'+this.fb_uid+'/permissions?access_token='+this.access_token,function(res){res=res.data||null;if(res===null){return callback();}
var parsed={};for(var i=0,l=res.length;i<l;++i){parsed[res[i].permission]=res[i].status==='granted';}
this.user_scopes=parsed;callback(this.user_scopes);}.bind(this));};FBApi.prototype.checkUserScopes=function(requested,callback,force){if(typeof callback!=='function'){error.log(new Error('FBApi :: checkUserScopes - callback is not a valid function'));return;}
requested=String(requested||'');force=Boolean(force);if(!requested.length||requested==='*'){requested=this.getAppData().scope;}
requested=requested.split(',');this.getUserScopes(function(scope){if(!scope||scope!==Object(scope)){return callback();}
var res={};for(var i=0,l=requested.length;i<l;++i){var current=requested[i].toLowerCase();res[current]=Boolean(scope[current]);}
callback(res);},force);};FBApi.prototype.isScopeAllowed=function(scope){scope=String(scope||'');if(this.user_scopes===null){return false;}
return Boolean(this.user_scopes[scope]);};FBApi.prototype.allowExternalScope=function(scope){var user_scopes=this.user_scopes===Object(this.user_scopes)?this.user_scopes:{};user_scopes[String(scope||'')]=true;this.user_scopes=user_scopes;};window.FBApi=FBApi;})();;
(function(){'use strict';var FBAuth=function(api){this.api=api;this.login_only=false;this.skip_onboarding=false;this.auto_login=true;this.redirect=null;this.facebook_logged=false;};FBAuth.prototype.setUserStatus=function(status,trigger){this.facebook_logged=Boolean(status);trigger=Boolean(trigger);if(trigger){Events.trigger(Events.facebook.user_status,{status:this.facebook_logged});}
return this;};FBAuth.prototype.setAutoLogin=function(bool){this.auto_login=Boolean(bool);return this;};FBAuth.prototype.isLoginOnly=function(){return this.login_only;};FBAuth.prototype.isAutoLoginAllowed=function(){return this.auto_login;};FBAuth.prototype.login=function(parameters){if(typeof FB==='undefined'){error.log(new Error('FBAuth :: login - FB is undefined'));return;}
parameters=parameters||{};if(parameters!==Object(parameters)||Array.isArray(parameters)){error.log(new Error('FBAuth :: login - parameters is not a valid object'));return;}
var scopes=String(parameters.scopes||'*');var scopes_mandatory=Boolean(parameters.scopes_mandatory);if(scopes==='*'){scopes=this.api.getAppData().scope;}
this.redirect=null;this.login_only=Boolean(parameters.login_only);this.skip_onboarding=Boolean(parameters.skip_onboarding);if(parameters.redirect===Object(parameters.redirect)){this.setRedirect(parameters.redirect.type,parameters.redirect.link);}
FB.login(function(auth){if(!auth.authResponse||auth.status!=='connected'){return;}
if(scopes_mandatory){if(!this.api.getFBUid()){this.api.setFBUid(auth.authResponse.userID);}
if(!this.api.getAccessToken()){this.api.setAccessToken(auth.authResponse.accessToken);}
this.api.checkUserScopes(scopes,function(res){if(!res){return;}
scopes=scopes.split(',');for(var i=0,l=scopes.length;i<l;++i){if(!res[scopes[i]]&&scopes[i]!=='email'){return;}}
this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}.bind(this),true);}else{this.connect(auth.authResponse.userID,auth.authResponse.accessToken);}}.bind(this),{scope:scopes});};FBAuth.prototype.connect=function(fb_uid,access_token){fb_uid=String(fb_uid||'');access_token=String(access_token||'');if(!fb_uid||!access_token){error.log(new Error('FBAuth :: connect - Missing mandatory parameters'));return;}
api.call({method:'facebook.auth',data:{fb_user_id:fb_uid,access_token:access_token,login_only:this.login_only,skip_onboarding:this.skip_onboarding},success:function(res){var status=(!res||!res.status)?null:res.status;switch(status){case'success':user.refreshPageAfterLogin(this.redirect);break;case'link':if(this.redirect===null){this.setRedirect('modal','/lightbox/facebook/link');}
user.refreshPageAfterLogin(this.redirect);break;case'register':user.refreshPageAfterLogin(this.redirect);break;default:modal.open('/lightbox/facebook/error',true);break;}
return true;}.bind(this),error:function(err){var payload=!(err||!err.payload)?{}:err.payload;var status=!payload.status?'error':payload.status;var email=window.getObjDeepKey(payload,'user_data.EMAIL');switch(status){case'missing_email':modal.open('/lightbox/register.php?reason=fb_missing_email',true);break;default:modal.open('/lightbox/facebook/error?reason='+status+(email?'&email='+encodeURIComponent(email):''));break;}
return true;}});};FBAuth.prototype.setRedirect=function(type,link){type=String(type||'page');link=String(link||'/');if(link.charAt(0)!=='/'){link='/'+link;}
this.redirect={type:type,link:link};return this;};window.FBAuth=FBAuth;})();;
(function(){'use strict';var FBMethod=function(api,auth){this.api=api;this.auth=auth;this.fb_ready=false;this.events_ready=false;this.init_get_status=true;};FBMethod.prototype.initFB=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initFB - FB is undefined'));return;}
try{if(this.fb_ready){error.log(new Error('FBMethod :: initFB - FB was already initialized'));return;}
FB.init({appId:this.api.getAppData().id,channelUrl:this.api.getAppData().channel,version:this.api.getAppData().version,status:true,cookie:true,oauth:true,music:true,xfbml:false});this.fb_ready=true;if(!this.init_get_status){return;}
FB.getLoginStatus(function(res){this.auth.setUserStatus(res.status==='connected'||res.status==='not_authorized',true);if(res.status==='connected'){if(!user.current()){if(this.auth.isAutoLoginAllowed()){this.auth.connect(res.authResponse.userID,res.authResponse.accessToken);}}else{if(this.api.getFBUid()!==String(res.authResponse.userID)){this.api.unsetUserData();}else{this.api.getUserScopes(function(){user.setLogType('facebook');this.initEvents();}.bind(this),true);}}}}.bind(this));}catch(e){error.log(e);}};FBMethod.prototype.shouldGetStatus=function(bool){this.init_get_status=Boolean(bool);return this;};FBMethod.prototype.initEvents=function(){try{if(this.events_ready){error.log(new Error('FBMethod :: initEvents - Events were already initialized'));return;}
Events.subscribe(Events.player.play,function(evt,parameters){this.bridgeAction('play',parameters);}.bind(this));Events.subscribe(Events.player.resume,function(evt,parameters){this.bridgeAction('resume',parameters);}.bind(this));Events.subscribe(Events.player.paused,function(){this.bridgeAction('pause',dzPlayer.getCurrentSong());}.bind(this));Events.subscribe(Events.player.error,function(evt,parameters){this.bridgeAction('error',parameters);}.bind(this));if(typeof FB==='undefined'){error.log(new Error('FBMethod :: initEvents - FB is undefined'));return;}
FB.Event.subscribe('fb.music.PLAY',function(parameters){this.playerCallback('play',parameters);}.bind(this));FB.Event.subscribe('fb.music.RESUME',function(parameters){this.playerCallback('resume',parameters);}.bind(this));FB.Event.subscribe('fb.music.PAUSE',function(parameters){this.playerCallback('pause',parameters);}.bind(this));FB.Event.subscribe('fb.music.STATUS',function(){this.sendStatus();}.bind(this));FB.Event.subscribe('fb.music.USER_MISMATCH',function(){this.bridgeAction('close');}.bind(this));this.events_ready=true;}catch(e){error.log(e);}};FBMethod.prototype.unlinkAccount=function(){if(!confirm(gettext('tes-vous sr de vouloir dissocier vos comptes Deezer et %1$s ?','Facebook'))){return;}
api.call({method:'facebook.unlinkAccount',success:function(status){if(status){this.closeBridge(window.location.reload.bind(window.location));}}.bind(this)});};FBMethod.prototype.isActionEnabled=function(action){action=String(action||'');if(typeof USER.SETTING.facebook==='undefined'){error.log(new Error('FBMethod :: isActionEnabled - Missing facebook key in user\'s settings'));return false;}
return Boolean(USER.SETTING.facebook['share_'+action]);};FBMethod.prototype.closeBridge=function(callback){callback=typeof callback==='function'?callback:function(){return;};this.bridgeAction('close',callback);};FBMethod.prototype.bridgeAction=function(action,parameters,callback){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: bridgeAction - FB is undefined'));return;}
action=String(action||'');if(typeof parameters==='function'){callback=parameters;parameters={};}
if(parameters!==Object(parameters)||Array.isArray(parameters)){parameters={};}
if(typeof callback!=='function'){callback=function(){};}
var status={};var context=null;switch(action){case'close':status={offline:true};break;case'play':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(Math.floor(Date.now()/1000)),expires_in:parameters.DURATION};break;case'pause':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID};context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
break;case'resume':if(!parameters.SNG_ID||parameters.TYPE===1){return;}
context=this.getSongContext();status={playing:true,song:SETTING_HOST_SITE+'/track/'+parameters.SNG_ID,created_time:timestampToIso8601(),expires_in:parseInt(parameters.DURATION,10)-parseInt(dzPlayer.getPosition(),10)};if(Object.keys(context).length){status[context.type]=context.url;}
break;case'error':status={playing:false,song:SETTING_HOST_SITE+'/track/'+parameters.songId};switch(parameters.dzErrorCode){case right.NOT_ENCODED:status.error_code=4;break;case right.PREMIUM_ONLY:case NOT_RELEASE_FREE:status.error_code=102;break;case right.MP3_FRIEND:case right.LOCALITY:status.error_code=103;break;default:status.error_code=0;}
break;default:error.log(new Error('FBMethod :: bridgeAction - Unknown "'+action+'" action'));return;}
status.user_id=this.api.getFBUid();FB.Music.send('STATUS',status);return callback();};FBMethod.prototype.playerCallback=function(command,parameters){command=String(command||'');parameters=parameters||{};if(parameters!==Object(parameters)){error.log(new Error('FBMethod :: playerCallback - parameters is not a valid object'));return;}
switch(command){case'resume':dzPlayer.control.play();break;case'pause':dzPlayer.control.pause();break;case'play':var context_keys=['album','radio_station','playlist','musician','song'];var context=null;for(var i=0,l=context_keys.length;i<l;++i){if(typeof parameters[context_keys[i]]!=='undefined'){context=context_keys[i];}}
if(context===null){return;}
var path=parameters[context].split('/').reverse();var ctx_id=parseInt(path[0],10);var ctx_type=String(path[1]);var radio_type=context==='radio_station'?(String(path[2])==='artist'?'artist':'radio'):null;dzPlayer.loadTracks({id:ctx_id,type:radio_type?radio_type:ctx_type,radio:Boolean(radio_type)});if(parameters[context]!==document.location.href){loadBox('/'+(radio_type?String(path[2])+'/':'')+ctx_type+'/'+ctx_id);}
break;default:error.log(new Error('FBMethod :: playerCallback - Unknown "'+command+'" command'));return;}};FBMethod.prototype.sendStatus=function(){if(typeof FB==='undefined'){error.log(new Error('FBMethod :: sendStatus - FB is undefined'));return;}
var status={playing:dzPlayer.isPlaying(),user_id:this.api.getFBUid()};if(!status.user_id){return;}
if(dzPlayer.getCurrentSong()!==null){status.song=SETTING_HOST_SITE+'/track/'+dzPlayer.getCurrentSong('SNG_ID');}
var context=this.getSongContext();if(Object.keys(context).length){status[context.type]=context.url;}
FB.Music.send('STATUS',status);};FBMethod.prototype.getSongContext=function(){var context_keys={album:['album_page','explore_picks_album','explore_region_album','tops_album','feed_album','profile_top_albums','artist_discography','profile_albums','ticker_album','menu_panel_album','suggest_album'],radio_station:['smartradio_page','feed_smartradio','artist_smartradio','profile_radios','radio_page','feed_radio'],playlist:['playlist_page','feed_playlist','tops_playlist','profile_playlists','player_default_playlist','loved_page','ticker_playlist','menu_panel_playlist','suggest_playlist'],musician:['artist_top','search_page']};var context=dzPlayer.getContext();var url=SETTING_HOST_SITE+'/';var type=null;if(context===null||!context.TYPE){return{};}
for(var ctx in context_keys){if(type!==null){break;}
if(!context_keys.hasOwnProperty(ctx)){continue;}
for(var i=0,l=context_keys[ctx].length;i<l;++i){if(context_keys[ctx][i]===context.TYPE){type=ctx;break;}}}
if(type===null){return{};}
url+=type==='radio_station'?'mixes/'+dzPlayer.getRadioType():type;url+='/'+parseInt(context.ID,10);return{type:type,url:url};};window.FBMethod=FBMethod;})();;
(function(){'use strict'
var FBWrapper=function(){this.api=new FBApi();this.auth=new FBAuth(this.api);this.method=new FBMethod(this.api,this.auth);};FBWrapper.prototype.setFBUid=function(fb_uid){return this.api.setFBUid(fb_uid);},FBWrapper.prototype.setAccessToken=function(access_token){return this.api.setAccessToken(access_token);},FBWrapper.prototype.isScopeAllowed=function(scope){return this.api.isScopeAllowed(scope);},FBWrapper.prototype.setAppData=function(data){return this.api.setAppData(data);},FBWrapper.prototype.getAppData=function(){return this.api.getAppData();},FBWrapper.prototype.checkUserScopes=function(requested,callback,force){return this.api.checkUserScopes(requested,callback,force);},FBWrapper.prototype.allowExternalScope=function(scope){return this.api.allowExternalScope(scope);},FBWrapper.prototype.setAutoLogin=function(auto_login){return this.auth.setAutoLogin(auto_login);},FBWrapper.prototype.isLoginOnly=function(){return this.auth.isLoginOnly();},FBWrapper.prototype.login=function(parameters){return this.auth.login(parameters);},FBWrapper.prototype.initFB=function(){return this.method.initFB();},FBWrapper.prototype.shouldGetStatus=function(bool){return this.method.shouldGetStatus(bool);},FBWrapper.prototype.unlinkAccount=function(){return this.method.unlinkAccount();},FBWrapper.prototype.isActionEnabled=function(action){return this.method.isActionEnabled(action);},FBWrapper.prototype.closeBridge=function(callback){return this.method.closeBridge(callback);}
window.facebook=new FBWrapper();})();;
var notification={delayTimeOut:0,delayDefault:5000,content:null,notifyTrad:{no_log:gettext('L\'coute est limite  30 secondes. Pour couter en illimit, connectez-vous ou inscrivez-vous gratuitement.'),discovery_used_tb:gettext('Il vous reste moins d\'1 heure d\'coute gratuite. Abonnez-vous ! '),discovery_with_tb:gettext('Offre spciale : la musique illimite gratuite. Essayez ! '),expired_cc:gettext('Votre carte est sur le point d\'expirer. Modifiez vos coordonnes bancaires ds aujourd\'hui pour continuer  profiter de votre abonnement.'),flash_update:gettext('Tlchargez la dernire version de Flash Player pour pouvoir utiliser Deezer.'),limit30sec:gettext('L\'coute est limite  30 secondes. Dcouvrez Deezer Premium !'),mobile_only:gettext('Votre offre Deezer Mobile ne vous donne pas accs  l\'coute illimit  la demande sur le site Deezer.'),facebook_publish_action:gettext('Cliquez ici pour partager vos dcouvertes musicales avec vos amis !'),ie8_support:gettext('Votre navigateur internet est trop ancien pour profiter pleinement de l\'experience Deezer. Cliquez ici pour le mettre  jour.'),ie_warning:gettext('Deezer n\'est pas compatible avec Internet Explorer 7. Cliquez ici pour mettre  jour votre navigateur.'),win8_push:gettext('Tlchargez l\'appli Deezer pour Windows 8 et accdez directement  votre musique !'),flow_skip_push:gettext('Abonnez-vous  Premium+ pour pouvoir zapper en illimit.'),limit0s_free:gettext('Vous ne profitez pas de cette fonctionnalit, abonnez-vous pour en profiter'),flash_not_installed:gettext('Flash Player n\'est pas install ou dsactiv. Veuillez installer puis activer la version la plus rcente de Flash Player pour pouvoir utiliser Deezer.'),flash_blocked:gettext('Il semble qu\'un paramtre ou une extension bloque Flash Player. Veuillez le ou la dsactiver pour pouvoir utiliser Deezer.')},init:function(){Events.subscribe(Events.playlist.addSong,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.user.settingChanged,function(evt,data){if(data.notify===true){notification.display(evt,data);}});Events.subscribe(Events.player.tracklist_changed,function(evt,data){if(data.type==='addNext'||data.type==='addToQueue'){notification.display(evt,data);}});Events.subscribe(Events.copy.after,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.user.shareClick,function(evt,data){notification.display(evt,data);});Events.subscribe(Events.playlist.created,notification.display);Events.subscribe(Events.playlist.assistantSuggestFinish,notification.display);},display:function(evt,data){if(notification.content===null){notification.content=$('#notification');}
evt=evt||{};var delay=data.delay||notification.delayDefault;var wording=data.message;switch(evt.namespace){case'USER.settingChanged':wording=gettext('Sauvegard');break;case'PLAYLIST.addSong':wording=ngettext('Le titre a bien t ajout  la playlist.','Les titres ont bien t ajouts  la playlist.',{count:data.song.length});break;case'PLAYER.tracklist_changed':wording=ngettext('Le titre a bien t ajout  la file d\'attente.','Les titres ont bien t ajouts  la file d\'attente.',{count:data.song.length});break;case'PLAYLIST.assistantSuggestFinish':wording=ngettext('Le titre a bien t ajout  la playlist.','Les titres ont bien t ajouts  la playlist.',{count:data.count});break;case'PLAYLIST.created':wording=gettext('La playlist "%s" a bien t cre.',{sprintf:[data.TITLE]});break;}
$('h2',notification.content).text(wording);notification.content.show();setTimeout(function(){$('> div',notification.content).addClass('active');},0);if(notification.delayTimeOut>0){window.clearTimeout(notification.delayTimeOut);}
notification.delayTimeOut=setTimeout(notification.hide,delay);},hide:function(){notification.content.hide().children('div').removeClass('active');}};var notificationBar={init:function(){Events.subscribe(Events.player.notify,function(){notificationBar.check('start');});Events.subscribe(Events.player.finish,function(){notificationBar.check('end');});Events.subscribe(Events.offline.reminder,function(){notificationBar.display('drive_download_push',{replaceText:BrowserDetect.OS});});},check:function(type){try{if(typeof USER==='undefined'||dzPlayer.getPlayerType()!=='mod'){return false;}
if(www.getCurrentPageType()==='landing'){return false;}
if(type==='start'){if(USER.USER_ID===0&&dzPlayer.getMediaType()===dzPlayer.MEDIA_TYPE_SONG){notificationBar.display('no_log',{origin:'no_log'});}
if(USER.USER_ID>0&&!DZPS){if(USER.OPTIONS.web_streaming===false){notificationBar.display('limit30sec',{origin:'limit30sec'});}
if(dzPlayer.isLimited()){if(dzPlayer.user_status.preview===false){notificationBar.display('limit0s_free',{origin:'headband_30sec'});}else{notificationBar.display('discovery_limited',{origin:'headband_30sec',replaceText:(restrict.object.time_left+restrict.object.time_used)/3600});}}}}
if(type==='end'){if(USER.USER_ID===0){if(USER.OPTIONS.web_streaming===true){if(dzPlayer.isLimited()&&$('#facebox:visible').length===0){www.goToConnection();}}else if($('#facebox:visible').length===0){www.goToConnection();}}}}catch(e){error.log(e);}},notifyAllreadyDisplayed:{},display:function(msg,param){param=param||{};try{if(typeof notificationBar.notifyAllreadyDisplayed[msg]!=='undefined'){return false;}
if(storage.isset('NOTIFY_'+msg)){return false;}
var message;if(msg==='discovery_limited'){message=gettext('Vous avez cout vos %s heures gratuites ce mois-ci. L\'coute est limite  30 secondes.',{sprintf:[param.replaceText]});}else if(msg==='drive_download_push'){message=gettext('Maintenant que vous tes de retour, cliquez ici pour tlcharger Deezer pour %s.',{sprintf:[param.replaceText]});}else{message=notification.notifyTrad[msg];}
var link='';var save_already_displayed=true;switch(msg){case'expired_cc':return false;case'facebook_publish_action':link='facebook.login("publish_actions");';break;case'ie_warning':tracking.track('header_dld_ie7_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie7_click");';break;case'ie8_support':tracking.track('header_dld_ie8_display');link='modal.open("/lightbox/browser_update.php");tracking.track("header_dld_ie8_click");';break;case'no_log':link='www.goToConnection();';break;case'win8_push':link='window.open("http://apps.microsoft.com/windows/app/deezer/e48b595e-b20a-4eb3-968c-c20b2cadaa1e");';storage.set('NOTIFY_'+msg,true);break;case'flow_skip_push':link='window.open("/offers");';save_already_displayed=false;break;case'drive_download_push':link='window.location.href = "'+(BrowserDetect.OS==='Windows'?WIN8_APP_DOWNLOAD:DEEZER_DRIVE_DOWNLOAD)+'";';storage.set('offline_reminder',false);break;default:link='window.open("/offers"); tracking.track("offers_subscribe_click", {origin: "'+(param.origin||1)+'"});';}
$('#notify').show().children('.message').attr('onClick',link+'notificationBar.hide(); return false;').text(message);if(save_already_displayed){notificationBar.notifyAllreadyDisplayed[msg]=true;}
return true;}catch(e){error.log(e);}},hide:function(){$('#notify').hide();}};;
var premium={drawPlaylistInapp:function(obj){try{if(typeof obj.country==='undefined'||typeof obj.offer_id==='undefined'){return false;}
api.call('operator.getPlaylistInappsData',{COUNTRY:obj.country,OFFER_ID:obj.offer_id},function(result){if(result===false){return false;}
if(result.playlist_id!=0){api.call('playlist.getData',{PLAYLIST_ID:result.playlist_id},function(result){userData.addFavorite({type:'playlist',id:result.PLAYLIST_ID,PLAYLIST_ID:result.PLAYLIST_ID,TITLE:result.TITLE,PARENT_USERNAME:result.PARENT_USERNAME});});}
$.each(result.inapps,function(idx){api.call('application.getData',{APP_ID:result.inapps[idx]},function(result){userData.addFavorite({type:'application',id:result.APP_ID,APP_ID:result.APP_ID,NAME:result.NAME,INAPP_ALIAS:result.INAPP_ALIAS,APP_PICTURE_16x16:result.APP_PICTURE_16x16});});});});}catch(e){error.log(e);}},checkCodeValidity:function(){try{$('#input_subscribe_confirm').hide();$('#href_register_submit > .img_loading').show();var errorMsg=gettext('Votre code n\'est pas reconnu. Merci de ressayer ou contacter le fournisseur du code.');var gift_code=$('#gift_code').val();if(gift_code==''){$('#gift_error').html(errorMsg).show();return false;}
var gift_previous_store=$('#gift_previous_store').val();if(gift_previous_store!=null&&gift_previous_store!=''){gift_previous_store_url='&previous_store='+gift_previous_store;}else{var gift_previous_store_url='';}
api.call({method:'premium.checkCodeValidity',data:{CODE:gift_code},success:function(result){var pathname=document.location.pathname;if(pathname.match(/\/gift/gi)===null){pathname='/gift';}
var link=pathname+'?screen=connect&connect='+$('#gift_connect').val()+'&code='+gift_code+gift_previous_store_url;if(USER.USER_ID>0){window.location.href=link;}else{modal.open(link,true);}
return true;},error:function(error){if('GIFT_CODE_ERROR'in error.payload){errorMsg=error.payload['GIFT_CODE_ERROR'];}
$('#gift_error').html(errorMsg).show();$('#input_subscribe_confirm').show();$('#href_register_submit > .img_loading').hide();return true;}});}catch(e){error.log(e);}},test_phone:function(tracking_params,successCallback,errorCallback){var errorMsg=gettext('Une erreur est survenue. Merci de vous assurer de la validit de votre numro avant de ritrer votre demande.');try{var trackingTag='senttomobile_lb_click';var tracking_params=tracking_params||{type:'smssubmit'};if(typeof tracking_params.type==='undefined'){tracking_params.type='smssubmit';}
$input=$('#tester_phone_number');if(typeof $input=='undefined'||$input.length==0){return false;}
phone_number=$input.val().trim();if(phone_number==''){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'empty_phone'});}else{premium.displayMobileMessage(errorMsg,'error');}
return false;}
$input.val('');api.call({method:'sms.sendAppUrl',data:{PHONE:phone_number},success:function(){if(USER.USER_ID===0){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);return true;}
api.call({method:'user.update',data:{USER_DATA:{PHONE:phone_number}},success:function(){premium.testPhoneSuccess(trackingTag,tracking_params,successCallback);},error:function(error){if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:'error'});}else{premium.displayMobileMessage(errorMsg,'error');}
return true;}});},error:function(error){var error_status='error';var type='error';if(error.message=='already_send'){errorMsg=gettext('Un SMS vous a dj t envoy  ce numro. Vous pouvez nanmoins vous rendre via le navigateur de votre mobile sur %s pour tester la compatibilit de votre mobile.',{sprintf:['http://www.deezer.com']});error_status='already_send';type='';}
if(typeof errorCallback==='function'){errorCallback({text:errorMsg,status:error_status});}else{premium.displayMobileMessage(errorMsg,type);}
if(typeof tracking_params==='object'){tracking_params.status=error_status;tracking.track(trackingTag,tracking_params);}
return true;}});}catch(e){error.log(e);}},displayMobileMessage:function(text,type){var type=type||false;$('#tester_phone_msg').removeClass('alert-danger').addClass('alert-success').html(text).fadeIn();if(type=='error'){$('#tester_phone_msg').removeClass('alert-success').addClass('alert-danger');}},testPhoneSuccess:function(trackingTag,tracking_params,successCallback){try{if(typeof successCallback==='function'){successCallback();}else{premium.displayMobileMessage(gettext('Le SMS a bien t envoy. Vous allez le recevoir d\'ici quelques instants.'));}
if(typeof tracking_params==='object'){tracking_params.status='success';tracking.track(trackingTag,tracking_params);}
return true;}catch(e){error.log(e);}}};
if(typeof userData==='undefined'){var userData={data:{},dataStore:{},isLoaded:false,isLoadedRadio:false,checksums:{},searchHistoryLimit:10,conf:{FAVORITES_ARTISTS:{primary_key:'ART_ID',hash:true},FAVORITES_ALBUMS:{primary_key:'ALB_ID',hash:true},FAVORITES_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},FAVORITES_APPLICATIONS:{primary_key:'APP_ID',hash:true},FAVORITES_RADIOS:{primary_key:'RADIO_ID',hash:true},FAVORITES_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_DISLIKED_SONGS:{primary_key:'SNG_ID',hash:true},FAVORITES_GENRES:{primary_key:'GENRE_ID',hash:true},PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:false,clear:true},FAVORITES_SHOWS:{primary_key:'SHOW_ID',hash:true},EPISODE_BOOKMARKS:{primary_key:'EPISODE_ID',hash:true},TOP_PLAYLISTS:{primary_key:'PLAYLIST_ID',hash:true},TOP_ALBUMS:{primary_key:'ALB_ID',hash:true},TOP_GENRES:{skip:false,hash:true},TOP_TAGS:{skip:false,hash:false},USER_TAGS:{skip:false,hash:false},FRIENDS:{primary_key:'USER_ID',hash:true},MESSAGE_UNREAD:{primary_key:'AUTHOR',hash:true},TOTAL_STORE_TRACKS:{skip:true,hash:false},MARKETING_PUSH:{skip:false,hash:false},SEARCH_HISTORY:{skip:false,hash:false},DEFAULT_APPLICATIONS:{skip:false,primary_key:'APP_ID',hash:true}},init:function(){try{if(USER.USER_ID===0){Events.ready(Events.user.loaded,userData.init);Events.resolve(Events.user.initialized,{authenticated:false});return false;}
if(PLATFORM!='web'){return true;}
try{if(storage.isset('USER_CHECKSUMS')){userData.checksums=storage.get('USER_CHECKSUMS');for(var c in userData.checksums){if(!userData.checksums.hasOwnProperty(c)){continue;}
if(!storage.isset(c)){console.log(c,' : localStorage not found');delete userData.checksums[c];}}}}catch(e){error.log(e);}
api.call({method:'deezer.userMenu',data:{checksum:true,checksums:userData.checksums},success:userData.loadCallbackInit});return true;}catch(e){error.log(e);}},fillData:function(key,result,conf){if(typeof result==='undefined'){result={data:[],total:0,count:0};}
if(result==='Not modified'){if(storage.isset(key)){result=storage.get(key);}}
if(conf.clear){for(var j=result.count;j>=0;j--){if(typeof result.data[j]==='object'&&parseInt(result.data[j].TYPE,10)===4){result.data.splice(j,1);}}
result.count=result.total=result.data.length;}
return result;},fillDataHashes:function(result,conf){var hashes={};if(conf.hash!==false){for(var j=0;j<result.count;j++){var id=result.data[j][conf.primary_key];hashes[id]=j;}}
return hashes;},store:function(key,data){storage.set(key,data,false);},refreshData:function(key,result){var conf=userData.conf[key];var data=userData.fillData(key,result,conf);var hashes=userData.fillDataHashes(data,conf);userData.data[key]=data;userData.data[key+'_HASH']=hashes;if(typeof userData.data[key].checksum!=='undefined'){userData.store(key,userData.data[key]);userData.checksums[key]=userData.data[key].checksum;}},loadCallbackInit:function(result){try{for(var key in userData.conf){if(!userData.conf.hasOwnProperty(key)||userData.conf[key].skip){continue;}
userData.refreshData(key,result[key]);}
if(typeof result.TOTAL_STORE_TRACKS!=='undefined'){userData.dataStore={};if(storage.isset('storeTrack')){userData.dataStore=storage.get('storeTrack');}
if(countObject(userData.dataStore)<result.TOTAL_STORE_TRACKS){api.call('store.getList',{start:countObject(userData.dataStore),nb:result.TOTAL_STORE_TRACKS-countObject(userData.dataStore)},userData.storeListCallback);}else{Events.resolve(Events.user.dataStoreReady);}}
if(typeof result.MARKETING_PUSH!=='undefined'&&typeof result.MARKETING_PUSH==='string'&&result.MARKETING_PUSH!==''){setTimeout(function(){modal.open(result.MARKETING_PUSH);},500);}
userData.isLoaded=true;userData.saveChecksums(userData.checksums);Events.resolve(Events.user.userReady);Events.resolve(Events.user.initialized,{authenticated:true,userData:userData});return true;}catch(e){error.log(e);}},saveChecksums:function(checksums){userData.store('USER_CHECKSUMS',checksums);},loadData:function(type){try{var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S';if(typeof userData.conf[key]==='undefined'){return;}
api.call({method:'favorite.'+type+'_getList',success:function(results){if(results.count===0){return false;}
userData.refreshData(key,results);userData.saveChecksums(userData.checksums);Events.trigger(Events.user.userLoadData,{type:type});}});}catch(e){error.log(e);}},isFavorite:function(type,id){try{if(!userData.isLoaded){return false;}
var key=(type==='friend')?'FRIENDS_HASH':'FAVORITES_'+type.toUpperCase()+'S_HASH';return typeof userData.data[key]!=='undefined'&&typeof userData.data[key][id]!=='undefined';}catch(e){error.log(e);}},isDisliked:function(id){try{return userData.isFavorite('disliked_song',id);}catch(e){error.log(e);}},getTopGenre:function(){return!userData.isLoaded||userData.data.TOP_GENRES.count==0?0:userData.data.TOP_GENRES.data[0];},getUnseenPlaylistCount:function(){var unseenPlaylistCount=0;userData.data.FAVORITES_PLAYLISTS.data.forEach(function(playlist){if(playlist.UNSEEN_TRACK_COUNT>0){++unseenPlaylistCount;}});return unseenPlaylistCount;},getUnseenTrackCount:function(playlist_id){var data=userData.data.FAVORITES_PLAYLISTS.data;for(var i=0,length=data.length;i<length;++i){if(data[i].PLAYLIST_ID==playlist_id){return data[i].UNSEEN_TRACK_COUNT||0;}}},setPlaylistSeen:function(playlist_id){userData.data.FAVORITES_PLAYLISTS.data.forEach(function(playlist){if(playlist.PLAYLIST_ID==playlist_id){playlist.UNSEEN_TRACK_COUNT=0;}});},addFavorite:function(data){try{if(PLATFORM!=='web'){Events.trigger(Events.user.addFavorite,data);return true;}
if(typeof data!=='object'){return false;}
var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';userData.data[key+'_HASH'][data.id]=true;if(countObject(userData.data[key])===0){userData.data[key]={data:[],total:0,count:0};}
data.DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);data.DATE_FAVORITE=timestampToDate(SERVER_TIMESTAMP,true,'-',true);userData.data[key].data.push(data);userData.data[key].count++;userData.data[key].total++;Events.trigger(Events.user.addFavorite,data);return true;}catch(e){error.log(e);}},deleteFavorite:function(data){try{if(typeof data!=='object'){return false;}
var id_name={album:'ALB_ID',show:'SHOW_ID',playlist:'PLAYLIST_ID',artist:'ART_ID',radio:'RADIO_ID',friend:'USER_ID',application:'APP_ID',song:'SNG_ID',disliked_song:'SNG_ID'};var id=id_name[data.type];var key=(data.type==='friend')?'FRIENDS':'FAVORITES_'+data.type.toUpperCase()+'S';delete userData.data[key+'_HASH'][data.id];for(var a=0;a<userData.data[key].count;a++){if(userData.data[key].data[a][id]==data.id){userData.data[key].data.splice(a,1);userData.data[key].total-=1;userData.data[key].count-=1;break;}}
Events.trigger(Events.user.deleteFavorite,data);return true;}catch(e){error.log(e);}},createPlaylist:function(data,callback){try{data=$.extend(true,{},{title:'',description:'',status:0,songs:false,tags:[]},data);api.call({method:'playlist.create',data:data,success:function(id){if(typeof id==='number'){var current_date=timestampToDate(SERVER_TIMESTAMP,true,'-',true);var newPlaylist={CHECKSUM:'',PARENT_USER_ID:USER.USER_ID.toString(),PLAYLIST_ID:id.toString(),STATUS:data.status,TITLE:data.title,PLAYLIST_PICTURE:'',PICTURE_TYPE:'cover',NB_SONG:Array.isArray(data.songs)?data.songs.length:0,DATE_ADD:current_date,DATE_CREATE:current_date,GENRE:[]};if(countObject(userData.data.PLAYLISTS.data)===0){userData.data.PLAYLISTS={count:0,total:0,data:[]};}
userData.data.PLAYLISTS.data.push(newPlaylist);userData.data.PLAYLISTS.count+=1;userData.data.PLAYLISTS.total+=1;if(typeof callback==='function'){callback(newPlaylist.PLAYLIST_ID);}
Events.trigger(Events.playlist.created,newPlaylist);}}});}catch(e){error.log(e);}},updatePlaylist:function(data,callback){api.call({method:'playlist.update',data:data,success:function(){userData.refreshPlaylistData(data.playlist_id,{TITLE:data.title,STATUS:data.status,DATE_ADD:timestampToDate(SERVER_TIMESTAMP,true,'-',true)});Events.trigger(Events.playlist.updated,data);if(typeof callback==='function'){callback(data);}}});},refreshPlaylistData:function(playlist_id,data){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){for(var key in data){userData.data.PLAYLISTS.data[p][key]=data[key];}
break;}}},removePlaylist:function(data){try{api.call({method:'playlist.delete',data:{playlist_id:data.id},success:function(result){if(result){for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==data.id){userData.data.PLAYLISTS.data.splice(p,1);userData.data.PLAYLISTS.count-=1;userData.data.PLAYLISTS.total-=1;break;}}
if(naboo.getCurrentPath()==='/playlist/'+data.id){loadBox('/');}
Events.trigger(Events.playlist.removed,{type:'playlist',id:data.id});}}});}catch(e){error.log(e);}},addPlaylistSong:function(playlist_id,song_list,data){try{api.call({method:'playlist.addSongs',data:{playlist_id:playlist_id,songs:song_list},success:function(result){if(result===true){var all_playlist=$.merge($.merge([],userData.data.PLAYLISTS.data),userData.data.FAVORITES_PLAYLISTS.data);for(var p=0;p<all_playlist.length;p++){if(all_playlist[p].PLAYLIST_ID==playlist_id){all_playlist[p].DATE_ADD=timestampToDate(SERVER_TIMESTAMP,true,'-',true);all_playlist[p].NB_SONG+=song_list.length;break;}}
Events.trigger(Events.playlist.addSong,{playlist_id:playlist_id,song:song_list,context:data.context,position:data.position,notify:typeof data.notify==='boolean'?data.notify:true});}}});}catch(e){error.log(e);}},removePlaylistSong:function(playlist_id,song_list){try{for(var p=0;p<userData.data.PLAYLISTS.count;p++){if(userData.data.PLAYLISTS.data[p].PLAYLIST_ID==playlist_id){userData.data.PLAYLISTS.data[p].NB_SONG-=song_list.length;break;}}
Events.trigger(Events.playlist.removeSong,{playlist_id:playlist_id,song:song_list});}catch(e){error.log(e);}},storeListCallback:function(result){try{for(var j=0;j<result.count;j++){userData.dataStore[result.data[j].ISRC]=true;}
storage.set('storeTrack',userData.dataStore,false);Events.resolve(Events.user.dataStoreReady);}catch(e){error.log(e);}},storeList:function(isrcList){try{if(typeof isrcList!=='object'){return false;}
for(var j=0;j<isrcList.length;j++){userData.dataStore[isrcList[j]]=true;}}catch(e){error.log(e);}},addEpisodeBookmark:function(bookmark){if(typeof bookmark!=='object'||USER.USER_ID===0){return false;}
try{if(countObject(userData.data.EPISODE_BOOKMARKS)===0){userData.data.EPISODE_BOOKMARKS={data:[],total:0,count:0};}
bookmark={EPISODE_ID:bookmark.EPISODE_ID,OFFSET:bookmark.OFFSET.toString(),IS_HEARD:bookmark.ISHEARD};userData.data.EPISODE_BOOKMARKS.data.push(bookmark);userData.data.EPISODE_BOOKMARKS_HASH[bookmark.EPISODE_ID]=userData.data.EPISODE_BOOKMARKS.count;userData.data.EPISODE_BOOKMARKS.count++;userData.data.EPISODE_BOOKMARKS.total++;Events.trigger(Events.user.updateEpisodeBookmark,bookmark);}catch(e){error.log(e);}},addSearchHistory:function(query,result,index){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID',show:'SHOW_ID'};if(query===''){return;}
var entry={query:query,result:result||null};api.call({method:'user.addEntryInSearchHistory',data:{ENTRY:{query:query,type:result?result.__TYPE__:'query',id:result?result[types[result.__TYPE__]]:null,rank:(typeof index!=='undefined')?index:null}}});userData._insertSearchHistoryEntry(userData.data.SEARCH_HISTORY,entry);Events.trigger(Events.user.updateSearchHistory);},clearSearchHistory:function(){api.call({method:'user.clearSearchHistory',data:{USER_ID:USER.USER_ID}});userData.data.SEARCH_HISTORY.data.length=0;userData.data.SEARCH_HISTORY.total=0;Events.trigger(Events.user.updateSearchHistory);return true;},_insertSearchHistoryEntry:function(searchHistory,entry){var types={song:'SNG_ID',album:'ALB_ID',artist:'ART_ID',playlist:'PLAYLIST_ID',show:'SHOW_ID'};var i;var storedEntry;var storedResult;var result=entry.result;for(i=0;i<searchHistory.data.length;i++){storedEntry=searchHistory.data[i];storedResult=storedEntry.result;if((result&&storedResult&&result.__TYPE__===storedResult.__TYPE__&&result[types[result.__TYPE__]]===storedResult[types[result.__TYPE__]])||(entry.query===storedEntry.query&&!storedResult)){searchHistory.data.splice(i,1);break;}}
searchHistory.data.unshift(entry);searchHistory.data.splice(userData.searchHistoryLimit);searchHistory.total=searchHistory.data.length;}};};
var js_init={init:function(){if(typeof window.JS_INIT==='undefined'){return false;}
var index_of_jqueryaddress=window.JS_INIT.indexOf('_jqueryAddress');if(index_of_jqueryaddress!==-1){js_init.initLibs(['_jqueryAddress']);window.JS_INIT.splice(index_of_jqueryaddress,1);}
$(document).ready(function(){if(typeof window.JS_INIT==='object'){js_init.initLibs(window.JS_INIT);}});return true;},initLibs:function(js_init){if(typeof js_init!=='object'){return false;}
for(var i=0;i<js_init.length;i++){var _f=js_init[i];if(typeof window[_f]==='undefined'){continue;}
if(typeof window[_f].init==='function'){window[_f].init();continue;}
if(typeof window[_f]==='function'){window[_f]();}}
return true;}};;
if(typeof(right)=='undefined'){var right={READABLE:0,NOT_ENCODED:1,LOCALITY:2,MP3_FRIEND:3,PREMIUM_ONLY:4,NOT_RELEASE_FREE:5,NOT_RELEASE_PREMIUM:6,EXPLICIT_LYRICS:7,FAN_ONLY:8,checkSongAvailable:function(currentData){try{if(typeof(currentData)!=='object'){return right.READABLE;}
if(typeof(currentData.ISRC)!='undefined'&&currentData.ISRC!=''&&userData.dataStore[currentData.ISRC]==true){return right.READABLE;}
if(typeof(currentData.EXTERNAL)!='undefined'){return right.READABLE;}
if(typeof(currentData.RIGHTS)=='undefined'){currentData.RIGHTS={};}
if(parseInt(currentData.SNG_ID,10)<0){if(countObject(currentData.RIGHTS)==0){return(parseInt(currentData.ART_ID,10)==0)?right.MP3_FRIEND:right.LOCALITY;}
if(parseInt(currentData.FAN_ONLY,10)==1&&(!userData.isLoaded||!userData.isFavorite('artist',currentData.ART_ID))){return right.FAN_ONLY;}}
if(USER.USER_ID>0&&typeof(USER.SETTING.global.filter_explicit_lyrics)!=='undefined'&&typeof(currentData.RIGHTS.EXPLICIT_LYRICS)==='boolean'&&currentData.RIGHTS.EXPLICIT_LYRICS===true){return right.EXPLICIT_LYRICS;}else if(!DZPS&&typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='string'){return right.PREMIUM_ONLY;}else if(typeof(currentData.RIGHTS.STREAM_ADS)=='undefined'&&typeof(currentData.RIGHTS.STREAM_SUB)=='undefined'){return right.LOCALITY;}else if(!DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_ADS)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_FREE;}else if(DZPS&&(dateToTimestamp(currentData.RIGHTS.STREAM_SUB)>SERVER_TIMESTAMP)){return right.NOT_RELEASE_PREMIUM;}else if(currentData.MD5_ORIGIN==''||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&!DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0&&USER.SETTING.site.player_hq==false)||(parseInt(currentData.FILESIZE_MP3_128,10)===0&&parseInt(currentData.FILESIZE_MP3_256,10)===0&&parseInt(currentData.FILESIZE_MP3_320,10)===0&&DZPS&&parseInt(currentData.SNG_ID,10)>0)||(parseInt(currentData.SNG_ID,10)===0&&parseInt(currentData.FILESIZE_MP3_MISC,10)===0)){return right.NOT_ENCODED;}
return right.READABLE;}catch(e){error.log(e);}},getMessage:function(unavailable_code){try{switch(unavailable_code){case right.NOT_ENCODED:return gettext('Ce titre n\'est pas encore encod');case right.LOCALITY:return gettext('Ce titre n\'est pas disponible dans votre pays.');case right.MP3_FRIEND:return gettext('Ce titre est un mp3 perso d\'un autre utilisateur');case right.PREMIUM_ONLY:return gettext('A la demande des ayants droit, ce titre est disponible uniquement pour les abonns Premium et Premium+.');case right.NOT_RELEASE_FREE:return gettext('Ce titre n\'est pas encore disponible.');case right.NOT_RELEASE_PREMIUM:return gettext('Ce titre n\'est pas encore disponible.');case right.EXPLICIT_LYRICS:return gettext('Ce titre contient des paroles pouvant choquer.');case right.FAN_ONLY:return gettext('Ajoutez l\'artiste  vos favoris pour couter ce titre');default:return'';}}catch(e){error.log(e);}}};};
if(typeof restrict=='undefined'){var restrict={statusExclamationMark:80,object:null,type:'no_restriction',init:function(){try{if(USER.USER_ID<=0||DZPS){return false;}
if(USER.OPTIONS.web_streaming&&USER.OPTIONS.web_streaming_duration===0){return false;}
api.call('restriction.get',{},function(result){if(result==false){return;}
restrict.object=result;var now=Math.round(new Date().getTime()/1000);if(now<restrict.object.date_end_discover){restrict.type='discovery_unlimited';}else{restrict.type='discovery';Events.subscribe(Events.player.updateRestrictTime,restrict.updateRestrictTime);}});return true;}catch(e){error.log(e);}},updateRestrictTime:function(e,time){try{restrict.object.time_left-=time;restrict.object.time_used+=time;restrict.object.percent=((restrict.object.time_used*100)/(restrict.object.time_used+restrict.object.time_left));restrict.object.percent=Math.min(restrict.object.percent,100);restrict.gaugeUpdatePercent(restrict.object.percent);return true;}catch(e){error.log(e);}},gaugeUpdatePercent:function(percent){try{percent=parseFloat(percent).toFixed(3);percent=Math.min(percent,100);if(percent>=restrict.statusExclamationMark){$('#header_content_restriction > a > .warning').css('display','inline-block');}
$('#header_content_restriction > a > .progress > .bar').css('width',percent+'%');return true;}catch(e){error.log(e);}},gaugeEnable:function(){try{$('#push_abo').hide();$('#header_content_profil_user_data').removeClass('limit_off').addClass('limit_on');$('#header_content_restriction').show().bind('mouseover',restrict.gaugeMouseOver).bind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeDisable:function(){try{$('#push_abo').show();$('#header_content_profil_user_data').removeClass('limit_on').addClass('limit_off');$('#header_content_restriction').hide().unbind('mouseover',restrict.gaugeMouseOver).unbind('mouseout',restrict.gaugeMouseOut);}catch(e){error.log(e);}},gaugeMouseOver:function(){try{if($('#header_content_restriction_hovercard').is(':visible')==false){sendRequest('/lightbox/hovercard_restriction.php','text','type='+restrict.type+'&time_used='+restrict.object.time_used+'&time_left='+restrict.object.time_left,true,restrict.gaugeMouseOverCallback);}}catch(e){error.log(e);}},gaugeMouseOverCallback:function(response){try{response=response.responseText;$('#header_content_restriction_hovercard').html(response).show();}catch(e){error.log(e);}},gaugeMouseOut:function(e){try{if($(e.relatedTarget).parents('#header_content_restriction').length==1){return false;}
$('#header_content_restriction_hovercard').hide();}catch(e){error.log(e);}}}};
if(typeof user=='undefined'){var user={check_username_active:false,createChild:function(new_user,cb){api.call({method:'user.createChild',data:{blog_name:new_user.blog_name,is_kid:new_user.is_kid},success:function(result){cb(true);}});},deleteChild:function(child_id,cb){api.call({method:'user.deleteChild',data:{child_id:child_id},success:function(result){cb(true);}});},loginMulti:function(user_id,redirect){if(user_id===USER.USER_ID){user.refreshPageAfterLogin(redirect);return;}
api.call({method:'user.loginMulti',data:{account_id:user_id},success:function(){user.refreshPageAfterLogin(redirect);}});},login:function(email,password){var response={success:0,instant_auth:0,has_multi_account:0};try{if(typeof email!=='string'||typeof password!=='string'){return response;}
email=email.trim();password=password.trim();if(email===''||password===''){return response;}
var res=sendRequest('/ajax/action.php','text','type=login&mail='+encodeURIComponent(email)+'&password='+encodeURIComponent(password));if(res==='error_and_instant_auth'){response.instant_auth=1;}else if(res==='success'){response.success=1;}else if(res==='success_multi_account'){response.success=1;response.has_multi_account=1;}}catch(e){error.log(e);}
return response;},current:function(){var user_id=Number(USER.USER_ID);return user_id>0?user_id:0;},getLogType:function(){return LOG_TYPE;},setLogType:function(type){LOG_TYPE=String(type||'internal');},ping:function(){try{api.call('deezer.ping',{},function(result){if(typeof result.CHECKFORM!=='undefined'){if(USER.USER_ID>0&&result.USER_ID===0){modal.open('/lightbox/no_session.php');}else{USER.USER_ID=result.USER_ID;}
SESSION_ID=result.SESSION;checkForm=result.CHECKFORM;}});return true;}catch(e){error.log(e);}},refreshSession:function(){return sendRequest('/ajax/action.php','text','type=refresh_session');},refreshPageAfterLogin:function(redirect){try{if(Object(redirect)!==redirect){window.location.reload();return true;}
var url=document.location.protocol+'//'+SETTING_HOST;if(redirect.link.charAt(0)!=='/'&&redirect.link.substr(0,4)!=='http'){error.log({message:'path not valid',description:'user.refreshPageAfterLogin: / is missing in your path'+redirect.link});redirect.link='/'+redirect.link;}
if(redirect.type=='refresh'){return document.location.href=redirect.link;}
if(redirect.type=='modal'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='facebox'){return document.location.href=url+www.getCurrentPath()+'?lb='+encodeURIComponent(redirect.link);}
if(redirect.type=='page'){return document.location.href=url+unescape(redirect.link);}
if(redirect.type=='link'){return document.location.href='/?lb='+encodeURIComponent(redirect.link);}
return false;}catch(e){error.log(e);}},logout:function(redirect){try{redirect=redirect||null;if(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast'){chromecast.stopReceiver();}
Events.trigger(Events.user.logout);window.location='//'+SETTING_HOST+'/logout.php'+(redirect?'?redirect='+encodeURIComponent(redirect):'');return true;}catch(e){error.log(e);}
return false;},register:function(redirect,data){try{if(typeof data.tracking_data==='undefined'){data.tracking_data={};}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).hide();$(data.validButton).next().show();}
var blogname='';if(typeof data.blogname!='undefined'&&data.blogname!==''){blogname=data.blogname;}
var email='';if(typeof data.email!='undefined'&&data.email.trim()!==''){email=data.email.trim();}
var password='';if(typeof data.password!='undefined'&&data.password!==''){password=data.password;}
var birthday_day='';if(typeof data.birthday_day!='undefined'&&data.birthday_day!==''){birthday_day=data.birthday_day;}
var birthday_month='';if(typeof data.birthday_month!='undefined'&&data.birthday_month!==''){birthday_month=data.birthday_month;}
var birthday_year='';if(typeof data.birthday_year!='undefined'&&data.birthday_year!==''){birthday_year=data.birthday_year;}
var gender='';if(typeof data.gender!='undefined'){gender=data.gender;}
var checkForm='';if($('#checkForm').val()){checkForm=$('#checkForm').val();}else if(typeof window.checkForm!=='undefined'){checkForm=window.checkForm;}
var request=sendRequest('/ajax/action.php','text','type=register&email='+encodeURIComponent(email)+'&password='+encodeURIComponent(password)+'&blogname='+encodeURIComponent(blogname)+'&gender='+encodeURIComponent(gender)+'&birthday_day='+encodeURIComponent(birthday_day)+'&birthday_month='+encodeURIComponent(birthday_month)+'&birthday_year='+encodeURIComponent(birthday_year)+'&checkForm='+encodeURIComponent(checkForm));if(request=='error'){register.track(data.tracking_data,'error_checkform');user.ping();return false;}
var result=JSON.parse(request);if(typeof result[0]=='number'||result[0]>0){var login_result=user.login(email,password);if(login_result.success==true){register.track(data.tracking_data,'success',function(){user.refreshPageAfterLogin(redirect);});}
return true;}else{register.track(data.tracking_data,'error_input');}
if(typeof data.callBackError!='undefined'&&data.callBackError!==''){data.callBackError(result);}
if(typeof data.validButton!='undefined'&&data.validButton!==''){$(data.validButton).show();$(data.validButton).next().hide();}
return false;}catch(e){error.log(e);}},checkPassword:function(password,callback){api.call({method:'user_checkPassword',data:{password:password},success:callback});},resetPassword:function(email){try{if(typeof email!=='string'||email.trim()===''){return false;}
email=email.trim();var request=sendRequest('/ajax/action.php','text','type=reset_password&reset_mail='+encodeURIComponent(email));if(request=='success'){$('#reset_error').hide();$('#reset_first').hide();$('#reset_second').show();$('#reset_second_mail').html(email);$('#foot_step3').show();$('#foot_step2').hide();return true;}else if(request=='error'){$('#reset_error').html(gettext('<b>Adresse e-mail invalide</b><br />Merci de vrifier le format de votre adresse e-mail.'));$('#reset_error').show();return false;}else{$('#reset_error').html(gettext('<b>Adresse email inconnue</b><br />Cette adresse email ne correspond  aucun compte.<br />Merci de saisir votre email  nouveau.'));$('#reset_error').show();return false;}}catch(e){error.log(e);}},resetPasswordConfirm:function(){try{var password='';if($('#reset_new_password').length==1){password=$('#reset_new_password').val();password=password.trim();}
var password_confirm='';if($('#reset_new_confirm').length==1){password_confirm=$('#reset_new_confirm').val();password_confirm=password_confirm.trim();}
var key='';if($('#key').length==1){key=$('#key').val();}
var email='';if($('#email').length==1){email=$('#email').val();email=email.trim();}
var request=sendRequest('/ajax/action.php','text','type=reset_passwordConfirm&password='+encodeURIComponent(password)+'&password_confirm='+encodeURIComponent(password_confirm)+'&key='+encodeURIComponent(key)+'&email='+encodeURIComponent(email)+'&checkForm='+encodeURIComponent(checkForm));if(request!=='success'){$('#reset_error').show();return false;}
$('#reset_error').hide();$('#reset_first').hide();$('#foot_step2').hide();$('#reset_confirm').show();$('#foot_step2_login').show();return true;}catch(e){error.log(e);}},deleteAccountConfirm:function(md5){try{var password='';if($('#delete_account_password').length==1){password=$('#delete_account_password').val();password=password.trim();}
var checkForm='';if($('#checkForm').length==1){checkForm=$('#checkForm').val();}
var data='&password='+encodeURIComponent(password)+'&md5='+encodeURIComponent(md5)+'&checkForm='+encodeURIComponent(checkForm);var request=sendRequest('/ajax/action.php','text','type=user_deleteConfirm'+data);var result=JSON.parse(request);if(result.error.length>0){www.drawFormResult('delete_result','form_error',gettext('Veuillez vrifier votre mot de passe.'));}else{www.drawFormResult('delete_result','form_success',gettext('Votre compte vient d\'tre supprim.'));user.logout();}
return true;}catch(e){error.log(e);}},block:function($div,friend_id,data){if(USER.USER_ID===0){modal.open('/lightbox/login.php');}
api.call('friend.block',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',1).text(gettext('Dbloquer'));}
Events.trigger(Events.user.blockFriend,{id:friend_id});}});return true;},unblock:function($div,friend_id,data){api.call('friend.unblock',{friend_id:friend_id},function(result){if(result===true){if($div){$div.data('blocked',0).text(gettext('Bloquer'));}
Events.trigger(Events.user.unblockFriend,{id:friend_id});}});return true;}};};
if(typeof userSetting=="undefined"){var userSetting={set:function(data,notify){try{if(USER.USER_ID==0){return false;}
var newSetting=$.extend(true,{},USER.SETTING,data);if(JSON.stringify(newSetting)!=JSON.stringify(USER.SETTING)){var notify=notify||false;USER.SETTING=newSetting;api.call({method:'user.setSettings',data:{settings:data},success:function(){Events.trigger(Events.user.settingChanged,{notify:notify});}});}
return true;}catch(e){error.log(e);}}}};
if(typeof live==='undefined'){var live={initialized:false,socket:null,channels:[],connected:false,ticker_nb:0,server_timestamp:0,online_count:0,lastFeed:'',ws_close_codes:{normal:1000},ws_ready_state:{connecting:0,open:1,closing:2,closed:3},init:function(){if(Modernizr.websockets===false){return true;}
live.initialized=true;live.checkConnectionScheduler();limitation.init();live.log.init();return true;},checkConnectionScheduler:function(){live.checkConnection();window.setTimeout(live.checkConnectionScheduler,1000);},checkConnection:function(){if(typeof USER_TOKEN==='undefined'){return;}
if(live.socket!==null&&live.socket.readyState!=live.ws_ready_state.closed){return;}
live.connect();},connect:function(){if(live.socket!==null){live.close();delete live.socket;}
live.socket=new WebSocket(PROTOCOL_WS+SETTING_HOST_LIVE+'/ws/'+USER_TOKEN+'?version='+STATIC_VERSION);live.socket.onopen=function(evt){live.connected=true;for(var channel in live.channels){if(!live.channels.hasOwnProperty(channel)){continue;}
live.subscribe(channel);}
Events.trigger(Events.live.connected);};live.socket.onclose=function(evt){live.connected=false;};live.socket.onmessage=function(evt){live.onMsg(evt.data);};live.socket.onerror=function(evt){};return true;},disconnect:function(){if(!live.connected){return true;}
live.channels=[];live.connected=false;live.close();return true;},close:function(){try{live.socket.close(live.ws_close_codes.normal);}catch(e){error.log(e);}},addChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.addInternalChannel(channel);live.subscribe(channel);return true;},addInternalChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
live.channels[channel]=true;return true;},deleteChannel:function(channel){if(typeof channel==='undefined'||channel===''){return false;}
if(typeof live.channels[channel]==='undefined'){return false;}
delete live.channels[channel];return live.unsubscribe(channel);},subscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sub',channel]));},unsubscribe:function(channel){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['unsub',channel]));},publish:function(channel,data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['send',channel,data]));},sendlog:function(data){if(!live.initialized){return false;}
if(!live.connected){return false;}
return live.socket.send(JSON.stringify(['sendlog',data]));},onMsg:function(data){try{if(typeof data==='undefined'||data.length===0){return false;}
data=JSON.parse(data);if(data[0]!=='msg'){return false;}
live.dispatch([data[2],0]);return true;}catch(e){error.log(e);}},dispatch:function(message){try{if(typeof message!=='object'||message.length===0||typeof message[0].APP==='undefined'){error.log({message:'live.dispatch: Message not valid',description:message||null});return false;}
var app=message[0].APP.toLowerCase();if(typeof Events.live[app]!=='string'){return false;}
Events.trigger(Events.live[app],message);return true;}catch(e){error.log(e);}}};};
live.log={data:[],init:function(){Events.subscribe(Events.live.connected,function(){for(var line in live.log.data){if(!live.log.data.hasOwnProperty(line)){continue;}
live.sendlog(live.log.data[line]);}
live.log.data=[];});},send:function(event_name,properties){var data={event_name:event_name,properties:properties,platform:platform.get(),usr:USER.USER_ID,uniq_id:getCookie('dzr_uniq_id'),cty:COUNTRY,path:live.log.getPath(),session_duration:typeof SESSION_DURATION==='number'?SESSION_DURATION:null};if(!live.connected){live.log.data.push(data);return true;}
try{live.sendlog(data);}catch(e){live.log.data.push(data);}
return;},getPath:function(){var path=window.location.href;if(window.location.pathname==='/'){path+='homepage';}
return path;}};;
if(typeof limitation=="undefined"){var limitation={chan:null,uniqid:0,init:function(){Events.ready(Events.user.loaded,function(){limitation.uniqid=new Date().getTime();limitation.chan=USER.USER_ID+'_'+USER.USER_ID+'_STREAM';live.addInternalChannel(limitation.chan);Events.subscribe(Events.player.play,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.resume,function(evt,params){if(typeof params.value=='undefined'){return false;}
limitation.sendAction('PLAY',params.value.SNG_ID);});Events.subscribe(Events.player.seek,function(evt,params){limitation.sendAction('PLAY',dzPlayer.getCurrentSong('MEDIA_ID'));});Events.subscribe(Events.live.limitation,function(evt,params){limitation.execAction(params);});});},reset:function(){limitation.chan=null;limitation.uniqid=0;return true;},sendAction:function(action,value){if(USER.USER_ID===0||(typeof dzPlayer!=='undefined'&&dzPlayer.getPlayerType()==='chromecast')){return false;}
if(action!='PLAY'){return false;}
var param={APP:'LIMITATION',ACTION:action,VALUE:{USER_ID:USER.USER_ID,UNIQID:limitation.uniqid,SNG_ID:value}};live.publish(limitation.chan,param);return true;},execAction:function(message){if(typeof message!='object'||countObject(message)!=2){return false;}
var data=message[0];var time=message[1];if(data.VALUE.USER_ID===0){return false;}
if(data.VALUE.USER_ID==USER.USER_ID&&data.VALUE.UNIQID==limitation.uniqid){return false;}
if((live.server_timestamp-time)>5){return false;}
if(data.ACTION!='PLAY'){return false;}
Events.trigger(Events.live.simultaneousAccess,{});return true;}};};